<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Impossible ABG Tutor - Master Edition</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Master arterial blood gas interpretation through 75 progressive cases across 5 difficulty levels. Systematic ABG training by Dr. Amir Fadhel, Specialist in Anesthesiology & Critical Care.">
    <meta name="keywords" content="ABG, arterial blood gas, medical education, anesthesiology, critical care, ABG interpretation, medical training, Dr. Amir Fadhel">
    <meta name="author" content="Dr. Amir Fadhel">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="The Impossible ABG Tutor - Master Edition">
    <meta property="og:description" content="Master arterial blood gas interpretation through 75 progressive cases. Systematic ABG training by Dr. Amir Fadhel, Specialist in Anesthesiology & Critical Care.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dramir0078.github.io/abg-tutor/">
    <meta property="og:image" content="https://dramir0078.github.io/abg-tutor/preview.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="The Impossible ABG Tutor">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The Impossible ABG Tutor - Master Edition">
    <meta name="twitter:description" content="Master arterial blood gas interpretation through 75 progressive cases. Systematic ABG training by Dr. Amir Fadhel.">
    <meta name="twitter:image" content="https://dramir0078.github.io/abg-tutor/preview.png">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ü©∫</text></svg>">
    
    <!-- PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ABG Tutor">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect fill='%23667eea' width='200' height='200' rx='40'/%3E%3Ctext x='100' y='130' font-size='90' text-anchor='middle' fill='white' font-family='Arial, sans-serif' font-weight='bold'%3EABG%3C/text%3E%3C/svg%3E">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlRoZSBJbXBvc3NpYmxlIEFCRyBUdXRvciIsCiAgInNob3J0X25hbWUiOiAiQUJHIFR1dG9yIiwKICAiZGVzY3JpcHRpb24iOiAiTWFzdGVyIGFydGVyaWFsIGJsb29kIGdhcyBpbnRlcnByZXRhdGlvbiB3aXRoIDE3NSBjbGluaWNhbCBjYXNlcyBhY3Jvc3MgNSBwcm9ncmVzc2l2ZSBsZXZlbHMiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdC1wcmltYXJ5IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyMDAgMjAwJyUzRSUzQ3JlY3QgZmlsbD0nJTIzNjY3ZWVhJyB3aWR0aD0nMjAwJyBoZWlnaHQ9JzIwMCcvJTNFJTNDdGV4dCB4PScxMDAnIHk9JzEyMCcgZm9udC1zaXplPScxMDAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9J3doaXRlJyBmb250LWZhbWlseT0nQXJpYWwsIHNhbnMtc2VyaWYnIGZvbnQtd2VpZ2h0PSdib2xkJyUzRUFCRyUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJyUzRSUzQ3JlY3QgZmlsbD0nJTIzNjY3ZWVhJyB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicvJTNFJTNDdGV4dCB4PScyNTYnIHk9JzMzMCcgZm9udC1zaXplPScyNjAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9J3doaXRlJyBmb250LWZhbWlseT0nQXJpYWwsIHNhbnMtc2VyaWYnIGZvbnQtd2VpZ2h0PSdib2xkJyUzRUFCRyUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0KICBdLAogICJjYXRlZ29yaWVzIjogWyJlZHVjYXRpb24iLCAibWVkaWNhbCIsICJoZWFsdGgiXQp9">
    
    
    <!-- jsPDF for Certificate Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .home-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .home-btn:hover {
            background: white;
            color: #667eea;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            padding-top: 60px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .bio-link {
            color: white;
            text-decoration: underline;
            margin-top: 10px;
            display: inline-block;
        }
        
        .progress-section {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-item strong {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }
        
        .stat-item span {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-full {
            width: 100%;
            margin-top: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .level-btn {
            background: white;
            border: 3px solid #ddd;
            padding: 20px;
            margin: 10px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .level-btn:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .level-btn.unlocked {
            border-color: #4CAF50;
        }
        
        .level-btn.locked {
            background: #f5f5f5;
            border-color: #ddd;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .level-btn.locked:hover {
            transform: none;
        }
        
        .lock-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }
        
        .scenario-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .abg-values {
            background: #fff9e6;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        
        .abg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .abg-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .abg-item strong {
            display: block;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .abg-item span {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .equation-box {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .equation-box h4 {
            color: #667eea;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        
        .equation-box strong {
            color: #333;
        }
        
        .question-box {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .mcq-choice {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .mcq-choice:hover {
            border-color: #667eea;
            background: #f5f8ff;
        }
        
        .mcq-choice.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }
        
        .mcq-choice.correct {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        
        .mcq-choice.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .mcq-choice.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .choice-letter {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .choice-text {
            flex: 1;
            font-size: 16px;
        }
        
        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .feedback-correct {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        
        .feedback-incorrect {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        .compendium-box {
            background: #fff3e0;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .compendium-box h3 {
            color: #e65100;
            margin-bottom: 20px;
        }
        
        .equation-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ffe0b2;
        }
        
        .equation-section:last-child {
            border-bottom: none;
        }
        
        .equation-section h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        .level-select {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Portfolio Card Styles */
        .portfolio-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            display: block;
            position: relative;
            overflow: hidden;
        }
        
        .portfolio-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.6);
        }
        
        .portfolio-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: all 0.5s ease;
        }
        
        .portfolio-card:hover::before {
            top: -60%;
            right: -60%;
        }
        
        .portfolio-card-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        
        .portfolio-card-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }
        
        /* Professional Photo Styling */
        .portfolio-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: block;
            border: 4px solid white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            object-fit: cover;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .portfolio-card h3 {
            color: white;
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .portfolio-card-subtitle {
            color: rgba(255, 255, 255, 1);
            font-size: 20px;
            font-style: normal;
            font-weight: 700;
            margin-bottom: 12px !important;
        }
        
        .portfolio-card p {
            color: rgba(255, 255, 255, 0.95);
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.6;
            font-weight: 700;
        }
        
        .portfolio-card-button {
            background: white;
            color: #667eea;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .portfolio-card:hover .portfolio-card-button {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        
        /* ============================================
           KNOWLEDGE MODULE STYLES
           ============================================ */
        
        .knowledge-article {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-height: 600px;
            overflow-y: auto;
            line-height: 1.8;
            font-size: 15px;
        }
        
        .knowledge-article h2 {
            color: #667eea;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 22px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .knowledge-article h3 {
            color: #764ba2;
            margin-top: 20px;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .knowledge-article h4 {
            color: #555;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .knowledge-article p {
            margin-bottom: 12px;
            color: #333;
        }
        
        .knowledge-article ul {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .knowledge-article li {
            margin-bottom: 8px;
            color: #333;
        }
        
        .knowledge-article strong {
            color: #667eea;
        }
        
        /* Level Introduction Screen Styles */
        .level-intro-container {
            text-align: center;
            padding: 20px;
        }
        
        .level-intro-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .level-intro-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .level-intro-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .level-intro-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        .btn-learn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 35px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .btn-learn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }
        
        .btn-start-cases {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 35px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-start-cases:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* ============================================
           REGISTRATION FORM STYLES
           ============================================ */
        
        .registration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .registration-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .registration-card h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .registration-card .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group label .required {
            color: #e74c3c;
            margin-left: 3px;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group select {
            cursor: pointer;
            background: white;
        }
        
        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-register {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        .btn-skip {
            flex: 1;
            background: white;
            color: #666;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-skip:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .privacy-note {
            margin-top: 20px;
            padding: 15px;
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            font-size: 13px;
            color: #555;
        }
        
        .privacy-note strong {
            color: #667eea;
        }
        
        /* ========== MASTERY QUIZ & DAILY CHALLENGE STYLES ========== */
        
        .mastery-quiz-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid #fff;
        }
        
        .mastery-quiz-locked {
            background: linear-gradient(135deg, #9090 90 0%, #606060 100%);
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .mastery-quiz-card h2 {
            color: white;
            margin-bottom: 15px;
            font-size: 26px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mastery-quiz-card p {
            color: rgba(255,255,255,0.95);
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .mastery-quiz-requirements {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: white;
            font-size: 14px;
        }
        
        .mastery-quiz-button {
            background: white;
            color: #f5576c;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .mastery-quiz-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .mastery-quiz-button:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .mastery-quiz-button .lock-icon {
            margin-right: 8px;
        }
        
        /* Daily Challenge Card */
        .daily-challenge-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid #fff;
        }
        
        .daily-challenge-card h2 {
            color: white;
            margin-bottom: 10px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .daily-challenge-info {
            color: rgba(255,255,255,0.9);
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .daily-challenge-button {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .daily-challenge-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .daily-completed {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            color: white;
            text-align: center;
        }
        
        /* Mastery Quiz Progress */
        .mastery-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .mastery-progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s ease;
        }
        
        .mastery-case-number {
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            margin-top: 5px;
        }
        
        /* Certificate Display */
        .certificate-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .certificate-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .download-cert-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .download-cert-button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        /* Email Collection Form */
        .email-collection-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .email-collection-form input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .email-collection-form button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .skip-email-button {
            background: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Registration Overlay -->
    <div id="registrationOverlay" class="registration-overlay hidden">
        <div class="registration-card">
            <h2>ü©∫ Welcome to ABG Tutor!</h2>
            <p class="subtitle">Help us improve by sharing a few details (takes 30 seconds)</p>
            
            <form id="registrationForm" onsubmit="submitRegistration(event)">
                <div class="form-group">
                    <label for="fullName">Full Name <span class="required">*</span></label>
                    <input type="text" id="fullName" name="fullName" required placeholder="Dr. John Smith">
                </div>
                
                <div class="form-group">
                    <label for="country">Country <span class="required">*</span></label>
                    <select id="country" name="country" required>
                        <option value="">Select your country</option>
                        <option value="Afghanistan">Afghanistan</option>
                        <option value="Albania">Albania</option>
                        <option value="Algeria">Algeria</option>
                        <option value="Argentina">Argentina</option>
                        <option value="Australia">Australia</option>
                        <option value="Austria">Austria</option>
                        <option value="Bahrain">Bahrain</option>
                        <option value="Bangladesh">Bangladesh</option>
                        <option value="Belgium">Belgium</option>
                        <option value="Brazil">Brazil</option>
                        <option value="Canada">Canada</option>
                        <option value="China">China</option>
                        <option value="Colombia">Colombia</option>
                        <option value="Denmark">Denmark</option>
                        <option value="Egypt">Egypt</option>
                        <option value="Finland">Finland</option>
                        <option value="France">France</option>
                        <option value="Germany">Germany</option>
                        <option value="Greece">Greece</option>
                        <option value="India">India</option>
                        <option value="Indonesia">Indonesia</option>
                        <option value="Iran">Iran</option>
                        <option value="Iraq">Iraq</option>
                        <option value="Ireland">Ireland</option>
                        <option value="Israel">Israel</option>
                        <option value="Italy">Italy</option>
                        <option value="Japan">Japan</option>
                        <option value="Jordan">Jordan</option>
                        <option value="Kuwait">Kuwait</option>
                        <option value="Lebanon">Lebanon</option>
                        <option value="Malaysia">Malaysia</option>
                        <option value="Mexico">Mexico</option>
                        <option value="Morocco">Morocco</option>
                        <option value="Netherlands">Netherlands</option>
                        <option value="New Zealand">New Zealand</option>
                        <option value="Nigeria">Nigeria</option>
                        <option value="Norway">Norway</option>
                        <option value="Oman">Oman</option>
                        <option value="Pakistan">Pakistan</option>
                        <option value="Philippines">Philippines</option>
                        <option value="Poland">Poland</option>
                        <option value="Portugal">Portugal</option>
                        <option value="Qatar">Qatar</option>
                        <option value="Russia">Russia</option>
                        <option value="Saudi Arabia">Saudi Arabia</option>
                        <option value="Singapore">Singapore</option>
                        <option value="South Africa">South Africa</option>
                        <option value="South Korea">South Korea</option>
                        <option value="Spain">Spain</option>
                        <option value="Sweden">Sweden</option>
                        <option value="Switzerland">Switzerland</option>
                        <option value="Syria">Syria</option>
                        <option value="Thailand">Thailand</option>
                        <option value="Tunisia">Tunisia</option>
                        <option value="Turkey">Turkey</option>
                        <option value="UAE">United Arab Emirates</option>
                        <option value="UK">United Kingdom</option>
                        <option value="USA">United States</option>
                        <option value="Vietnam">Vietnam</option>
                        <option value="Yemen">Yemen</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profession">Profession <span class="required">*</span></label>
                    <select id="profession" name="profession" required>
                        <option value="">Select your profession</option>
                        <option value="Doctor">Doctor</option>
                        <option value="Medical Student">Medical Student</option>
                        <option value="Nurse">Nurse</option>
                        <option value="Paramedic">Paramedic</option>
                        <option value="Respiratory Therapist">Respiratory Therapist</option>
                        <option value="Other Healthcare">Other Healthcare Professional</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="specialty">Specialty</label>
                    <select id="specialty" name="specialty">
                        <option value="">Select specialty (if applicable)</option>
                        <option value="Anesthesiology">Anesthesiology</option>
                        <option value="Critical Care">Critical Care / ICU</option>
                        <option value="Emergency Medicine">Emergency Medicine</option>
                        <option value="Internal Medicine">Internal Medicine</option>
                        <option value="Pulmonology">Pulmonology</option>
                        <option value="Surgery">Surgery</option>
                        <option value="Cardiology">Cardiology</option>
                        <option value="Nephrology">Nephrology</option>
                        <option value="Pediatrics">Pediatrics</option>
                        <option value="Other">Other Specialty</option>
                        <option value="N/A">Not Applicable</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="foundVia">How did you find this app? <span class="required">*</span></label>
                    <select id="foundVia" name="foundVia" required>
                        <option value="">Select one</option>
                        <option value="Social Media">Social Media (Facebook/Twitter/Instagram/LinkedIn)</option>
                        <option value="Friend">Friend or Colleague</option>
                        <option value="Institution Email">Institution or University Email</option>
                        <option value="Google Search">Google Search</option>
                        <option value="Medical Forum">Medical Forum or Community</option>
                        <option value="Conference">Medical Conference</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="privacy-note">
                    <strong>üîí Privacy First:</strong> We don't collect email addresses. Your data helps us improve medical education. You can download your data anytime from the home screen.
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn-register">‚úÖ Complete Registration</button>
                    <button type="button" class="btn-skip" onclick="skipRegistration()">‚è≠Ô∏è Skip for Now</button>
                </div>
            </form>
        </div>
    </div>

    <div class="container">
        <!-- Header (always visible) -->
        <div class="header">
            <button class="home-btn" onclick="goHome()">üè† Home</button>
            <h1>The Impossible ABG Tutor</h1>
            <p><strong>Master Edition</strong></p>
            <p>Systematic ABG Interpretation Training</p>
            <p>Dr. Amir Fadhel | Specialist in Anesthesiology & Critical Care</p>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 20px;">üéØ Welcome to Your ABG Journey</h2>
                
                <p style="text-align: center; margin-bottom: 30px; color: #666; line-height: 1.6;">
                    Master arterial blood gas interpretation through 75 progressive cases across 5 difficulty levels.
                    Each level requires 80% accuracy to advance.
                </p>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-primary" onclick="showPlacementTest()">üìù Take Placement Test</button>
                    <button class="btn btn-secondary" onclick="showLevelSelect()">üìö Select Level</button>
                    <button class="btn btn-secondary" onclick="showProgress()">üìä View Progress</button>
                    <button class="btn btn-secondary" onclick="resetProgress()">üîÑ Reset Progress</button>
                </div>
            </div>
            
            <div class="card">
                <h3>üìñ Level Overview</h3>
                <div style="line-height: 2;">
                    <strong>Level 1:</strong> Basic pH status, primary disorders, compensation<br>
                    <strong>Level 2:</strong> Anion gap calculation and interpretation<br>
                    <strong>Level 3:</strong> Winter's formula and respiratory compensation<br>
                    <strong>Level 4:</strong> Adjusted bicarbonate and hidden disorders<br>
                    <strong>Level 5:</strong> Delta ratio and complex mixed disorders
                </div>
            </div>
            
            <!-- DAILY ABG CHALLENGE -->
            <div class="daily-challenge-card" id="dailyChallengeCard">
                <h2>‚ö° Daily ABG Challenge</h2>
                <p class="daily-challenge-info" id="dailyChallengeInfo">New case every day! Test your skills.</p>
                <button class="daily-challenge-button" onclick="startDailyChallenge()" id="dailyChallengeButton">
                    üéØ Start Today's Challenge
                </button>
                <div id="dailyCompletedMessage" class="daily-completed" style="display: none;">
                    ‚úÖ Today's challenge completed! Come back tomorrow for a new case.
                </div>
            </div>
            
            <!-- ABG MASTERY QUIZ -->
            <div class="mastery-quiz-card" id="masteryQuizCard">
                <h2>üèÜ ABG Mastery Quiz</h2>
                <p>100 Professional Cases - Ultimate Certification Challenge</p>
                
                <div class="mastery-quiz-requirements" id="masteryRequirements">
                    <strong>üìã Requirements:</strong><br>
                    Complete all 5 levels with 80%+ accuracy to unlock this challenge.
                </div>
                
                <div id="masteryProgress" style="display: none;">
                    <div class="mastery-progress-bar">
                        <div class="mastery-progress-fill" id="masteryProgressFill" style="width: 0%"></div>
                    </div>
                    <p class="mastery-case-number" id="masteryCaseNumber">0/100 cases completed</p>
                </div>
                
                <button class="mastery-quiz-button" onclick="startMasteryQuiz()" id="masteryQuizButton" disabled>
                    <span class="lock-icon">üîí</span> START MASTERY QUIZ
                </button>
            </div>
            
            <div class="card">
                <button class="btn btn-full btn-secondary" onclick="showCompendium()">üìê View Full Equation Compendium</button>
            </div>
            
            <div class="card" style="background: #fff3cd; border-left: 4px solid #ff9800;">
                <h3 style="color: #e65100;">üîß Debug Tools</h3>
                <p style="margin: 10px 0; color: #666;">Use these if you're experiencing issues:</p>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="showDebugInfo()" style="flex: 1;">üìä Show State</button>
                    <button class="btn btn-secondary" onclick="clearAndReload()" style="flex: 1;">üóëÔ∏è Clear Storage</button>
                </div>
            </div>
            
            <div class="card" style="background: #e3f2fd; border-left: 4px solid #667eea;">
                <h3 style="color: #667eea;">üë§ User Settings</h3>
                <p style="margin: 10px 0; color: #666;">Manage your registration and data:</p>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="showRegistrationForm()" style="flex: 1;">üìù Register / Update Info</button>
                    <button class="btn btn-secondary" onclick="downloadMyData()" style="flex: 1;">üíæ Download My Data</button>
                </div>
                <p style="margin-top: 10px; font-size: 13px; color: #666;">
                    <strong>Privacy:</strong> No email required. Your data helps us improve medical education.
                </p>
            </div>
            
            <!-- My Portfolio Card -->
            <a href="https://linktr.ee/dramir0078" target="_blank" class="portfolio-card">
                <div class="portfolio-card-content">
                    <!-- REPLACE THIS URL WITH YOUR ACTUAL PHOTO URL -->
                    <img src="https://i.imgur.com/IBC3uG8.png" 
                         alt="Dr. Amir Fadhel" 
                         class="portfolio-photo"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span class="portfolio-card-icon" style="display: none;">üë®‚Äç‚öïÔ∏è</span>
                    <h3>My Portfolio Card</h3>
                    <p class="portfolio-card-subtitle">Dr. Amir Fadhel</p>
                    <p>Specialist in Anesthesiology & Critical Care | Medical Educator | Iraq</p>
                    <span class="portfolio-card-button">üîó Visit My LinkTree</span>
                </div>
            </a>
        </div>

        <!-- Full Compendium Screen -->
        <div id="compendiumScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 20px;">üìê ABG Equation Compendium (Textbook Standard)</h2>
                <div class="compendium-box">
                    <div class="equation-section">
                        <h4>ANION GAP (AG)</h4>
                        <p><strong>Equation:</strong> Anion gap = Na ‚àí (Cl + HCO‚ÇÉ)</p>
                        <p><strong>Corrected Anion gap:</strong> Anion gap + 2.5 √ó (4 ‚àí albumin)</p>
                        <p><strong>Normal:</strong> 8-12 mEq/L (albumin 4 g/dL)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>High Anion gap ‚Üí added acids present (HAGMA)</li>
                            <li>Normal Anion gap ‚Üí bicarbonate loss or impaired renal acid secretion (NAGMA)</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>WINTER'S FORMULA (Metabolic Acidosis Compensation)</h4>
                        <p><strong>Equation:</strong> Expected PaCO‚ÇÇ = 1.5 √ó HCO‚ÇÉ + 8 ¬± 2</p>
                        <p><strong>Use:</strong> Only when HCO‚ÇÉ is low (metabolic acidosis)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Actual PaCO‚ÇÇ > expected ‚Üí concomitant respiratory acidosis</li>
                            <li>Actual PaCO‚ÇÇ < expected ‚Üí concomitant respiratory alkalosis</li>
                            <li>Within ¬±2 ‚Üí appropriate compensation</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>METABOLIC ALKALOSIS RESPIRATORY COMPENSATION</h4>
                        <p><strong>Equation:</strong> Expected PaCO‚ÇÇ = 40 + 0.7 √ó (HCO‚ÇÉ ‚àí 24) ¬± 5</p>
                        <p><strong>Use:</strong> Only when HCO‚ÇÉ is elevated (metabolic alkalosis)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Actual PaCO‚ÇÇ > expected +5 ‚Üí superimposed respiratory acidosis</li>
                            <li>Actual PaCO‚ÇÇ < expected ‚àí5 ‚Üí superimposed respiratory alkalosis</li>
                            <li>Within ¬±5 ‚Üí appropriate compensation</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>ADJUSTED BICARBONATE</h4>
                        <p><strong>Equation:</strong> Adjusted HCO‚ÇÉ = HCO‚ÇÉ + (Anion gap ‚àí 12)</p>
                        <p><strong>Use:</strong> Every time Anion gap is high (HAGMA)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Adjusted HCO‚ÇÉ < 18 ‚Üí additional NAGMA</li>
                            <li>Adjusted HCO‚ÇÉ 18-30 ‚Üí pure HAGMA</li>
                            <li>Adjusted HCO‚ÇÉ > 30 ‚Üí concurrent metabolic alkalosis</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>DELTA RATIO (HAGMA Pattern Analysis)</h4>
                        <p><strong>Equation:</strong> Delta Ratio = (Anion gap ‚àí 12) √∑ (24 ‚àí HCO‚ÇÉ)</p>
                        <p><strong>Use:</strong> Only in high anion gap metabolic acidosis</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Delta < 1 ‚Üí HAGMA + NAGMA</li>
                            <li>Delta 1-2 ‚Üí pure HAGMA</li>
                            <li>Delta > 2 ‚Üí metabolic alkalosis or chronic hypercapnia</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>RESPIRATORY ACIDOSIS COMPENSATION</h4>
                        <p><strong>Acute:</strong> PaCO‚ÇÇ ‚Üë10 ‚Üí HCO‚ÇÉ ‚Üë1</p>
                        <p><strong>Chronic:</strong> PaCO‚ÇÇ ‚Üë10 ‚Üí HCO‚ÇÉ ‚Üë3-4</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Matches acute pattern ‚Üí acute respiratory acidosis</li>
                            <li>Matches chronic ‚Üí chronic respiratory acidosis</li>
                            <li>Exceeds expected ‚Üí coexisting metabolic alkalosis</li>
                            <li>Less than expected ‚Üí coexisting metabolic acidosis</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>RESPIRATORY ALKALOSIS COMPENSATION</h4>
                        <p><strong>Acute:</strong> PaCO‚ÇÇ ‚Üì10 ‚Üí HCO‚ÇÉ ‚Üì2</p>
                        <p><strong>Chronic:</strong> PaCO‚ÇÇ ‚Üì10 ‚Üí HCO‚ÇÉ ‚Üì4-5</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Matches acute ‚Üí acute respiratory alkalosis</li>
                            <li>Matches chronic ‚Üí chronic respiratory alkalosis</li>
                            <li>Less than expected ‚Üí concurrent metabolic alkalosis</li>
                            <li>More than expected ‚Üí concurrent metabolic acidosis</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-full btn-secondary" onclick="hideCompendium()" style="margin-top: 20px;">‚Üê Back</button>
            </div>
        </div>

        <!-- Placement Test Screen -->
        <div id="placementScreen" class="hidden">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 10px;">üìù Placement Test</h2>
                <p style="margin: 15px 0; color: #666; text-align: center;">
                    Answer 5 questions to assess your ABG interpretation skills.<br>
                    We'll unlock the appropriate levels based on your performance.
                </p>
                <div id="placementQuestionContainer" style="margin-top: 30px;"></div>
            </div>
        </div>

        <!-- Level Selection Screen -->
        <div id="levelSelectScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Select Your Level</h2>
                <div class="level-select" id="levelButtons"></div>
            </div>
        </div>

        <!-- Progress Screen -->
        <div id="progressScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 15px;">Level <span id="currentLevelDisplay">1</span> Progress</h2>
                
                <div class="progress-section">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span><strong>Case <span id="caseNumber">1</span>/15</strong></span>
                        <span><strong>Question <span id="questionNumber">-</span>/5</strong></span>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%">
                            <span id="progressText">0%</span>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <strong>Score</strong><br><span id="score">0/0</span>
                        </div>
                        <div class="stat-item">
                            <strong>Accuracy</strong><br><span id="accuracy">0%</span>
                        </div>
                        <div class="stat-item" id="passStatus" style="color: #ff9800;">
                            <strong>Required</strong><br>80%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Case Start Screen -->
        <div id="startCaseScreen" class="hidden">
            <div class="card">
                <div style="text-align: center; padding: 20px;">
                    <h2 style="margin-bottom: 20px;">Ready for Case <span id="startCaseNum">1</span>?</h2>
                    <p style="margin-bottom: 25px; color: #666;">Click below to begin the case presentation</p>
                    <button class="btn btn-primary" onclick="startCase()">Start Case</button>
                </div>
            </div>
        </div>

        <!-- Active Case Screen -->
        <div id="caseScreen" class="hidden">
            <div class="card">
                <div class="scenario-box">
                    <h3 style="margin-bottom: 15px;">üìã Scenario</h3>
                    <p id="scenarioText"></p>
                </div>

                <div class="abg-values" id="abgValues"></div>

                <div class="equation-box" id="relevantEquations">
                    <h4>üìê Relevant Equations for This Level</h4>
                    <div id="equationContent"></div>
                </div>

                <div class="question-box">
                    <h3>Question <span id="currentQ"></span>/5</h3>
                    <p id="questionText" style="font-size: 18px; margin: 15px 0; font-weight: bold;"></p>
                    
                    <div id="mcqChoices"></div>
                    
                    <div id="feedback" class="hidden"></div>
                    
                    <button class="btn btn-secondary btn-full hidden" id="nextBtn" onclick="nextQuestion()">Next Question ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Case Summary Screen -->
        <div id="caseSummaryScreen" class="hidden">
            <div id="caseSummaryContent"></div>
        </div>

        <!-- Level Complete Screen -->
        <div id="levelCompleteScreen" class="hidden">
            <div class="card">
                <div id="levelCompleteContent"></div>
            </div>
        </div>

        <!-- NEW: Level Introduction Screen -->
        <div id="levelIntroScreen" class="hidden">
            <div class="card">
                <div class="level-intro-container">
                    <div class="level-intro-icon">üìö</div>
                    <div class="level-intro-title">Ready to start Level <span id="introLevelNum">1</span>?</div>
                    <div class="level-intro-description" id="introLevelDesc">
                        Basic pH status, primary disorders, and compensation
                    </div>
                    
                    <div style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin: 25px 0; border-left: 4px solid #667eea;">
                        <p style="color: #667eea; font-weight: bold; margin-bottom: 10px;">üí° Pro Tip</p>
                        <p style="color: #555; line-height: 1.6;">
                            Want to understand the theory before testing your skills? 
                            Click "Learn This Level" to read the knowledge module first, 
                            or jump straight into cases if you're ready!
                        </p>
                    </div>
                    
                    <div class="level-intro-buttons">
                        <button class="btn-learn" onclick="showKnowledgeArticle()">
                            üìñ Learn This Level
                        </button>
                        <button class="btn-start-cases" onclick="startCasesDirectly()">
                            üöÄ Start Cases
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Knowledge Article Screen -->
        <div id="knowledgeArticleScreen" class="hidden">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 25px;">
                    üìö Level <span id="knowledgeLevelNum">1</span> Knowledge Module
                </h2>
                <div id="knowledgeArticleContent" class="knowledge-article">
                    <!-- Article content will be inserted here -->
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn btn-primary" onclick="backToCaseFromKnowledge()" style="font-size: 18px; padding: 15px 40px;">
                        ‚Üê Back to Cases
                    </button>
                </div>
            </div>
        </div>
        
        <!-- MASTERY QUIZ SCREEN -->
        <div id="masteryQuizScreen" class="hidden">
            <div class="card">
                <h2 style="text-align: center;">üèÜ ABG Mastery Quiz</h2>
                <p style="text-align: center; color: #666;">100 Professional Certification Cases</p>
                
                <div class="mastery-progress-bar">
                    <div class="mastery-progress-fill" id="masteryQuizProgressFill"></div>
                </div>
                <p class="mastery-case-number" id="masteryQuizCaseNumber"></p>
                
                <div id="masteryQuizContent">
                    <!-- Case content will be inserted here by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- MASTERY QUIZ COMPLETION SCREEN -->
        <div id="masteryCompletionScreen" class="hidden">
            <div class="card certificate-container">
                <h2 style="text-align: center; color: #667eea;">üéâ Congratulations!</h2>
                <h3 style="text-align: center; margin-top: 10px;">ABG Mastery Quiz Complete!</h3>
                
                <div style="margin: 30px 0; text-align: center;">
                    <p style="font-size: 18px; margin-bottom: 10px;">Final Score: <strong id="masteryFinalScore"></strong></p>
                    <p style="color: #666;">You've conquered 100 challenging ABG cases!</p>
                </div>
                
                <!-- Email Collection (Optional) -->
                <div class="email-collection-form" id="emailCollectionForm" style="display: none;">
                    <h4 style="margin-bottom: 15px;">üìß Get Your Certificate (Optional)</h4>
                    <p style="color: #666; margin-bottom: 15px;">Enter your email to receive your achievement certificate</p>
                    <input type="email" id="certificateEmail" placeholder="your.email@example.com">
                    <div>
                        <button onclick="submitCertificateEmail()">Send Certificate</button>
                        <button class="skip-email-button" onclick="skipCertificateEmail()">Skip</button>
                    </div>
                </div>
                
                <div class="certificate-actions">
                    <button class="download-cert-button" onclick="downloadCertificate()">
                        üìÑ Download Certificate (PDF)
                    </button>
                    <button class="btn btn-secondary" onclick="goHome()">
                        üè† Return Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // REGISTRATION & TRACKING SYSTEM
        // ============================================
        
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwxiwbxHE2ljHz0lIpLdk9c3K5scO7Zn4oedrOBFlm-BfiZFEQam8K5vRvgTSN4MPX0eg/exec';
        
        // User Data Management
        let userData = {
            userId: null,
            fullName: null,
            country: null,
            profession: null,
            specialty: null,
            foundVia: null,
            registered: false,
            registrationSkipped: false,
            sessionStart: null
        };
        
        // Load user data from localStorage
        function loadUserData() {
            const saved = localStorage.getItem('abgTutorUserData');
            if (saved) {
                userData = JSON.parse(saved);
            }
        }
        
        // Save user data to localStorage
        function saveUserData() {
            localStorage.setItem('abgTutorUserData', JSON.stringify(userData));
        }
        
        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Check if registration is needed
        function checkRegistration() {
            loadUserData();
            
            if (!userData.registered && !userData.registrationSkipped) {
                // Show registration form
                document.getElementById('registrationOverlay').classList.remove('hidden');
            } else {
                // Log session if user is registered
                if (userData.registered) {
                    logSession();
                }
            }
        }
        
        // Submit registration
        async function submitRegistration(event) {
            event.preventDefault();
            
            const form = document.getElementById('registrationForm');
            const formData = new FormData(form);
            
            // Generate user ID if not exists
            if (!userData.userId) {
                userData.userId = generateUserId();
            }
            
            // Collect form data
            userData.fullName = formData.get('fullName');
            userData.country = formData.get('country');
            userData.profession = formData.get('profession');
            userData.specialty = formData.get('specialty') || 'N/A';
            userData.foundVia = formData.get('foundVia');
            userData.registered = true;
            userData.registrationSkipped = false;
            
            // Save to localStorage
            saveUserData();
            
            // Send to Google Sheets
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'register',
                        userId: userData.userId,
                        fullName: userData.fullName,
                        country: userData.country,
                        profession: userData.profession,
                        specialty: userData.specialty,
                        foundVia: userData.foundVia
                    })
                });
                
                console.log('Registration sent to Google Sheets');
                
                // Hide registration form
                document.getElementById('registrationOverlay').classList.add('hidden');
                
                // Log first session
                logSession();
                
                // Show thank you message
                alert('‚úÖ Thank you for registering! Your data helps us improve medical education.');
                
            } catch (error) {
                console.error('Registration error:', error);
                // Still save locally even if submission fails
                document.getElementById('registrationOverlay').classList.add('hidden');
            }
        }
        
        // Skip registration (with reminder)
        function skipRegistration() {
            if (!userData.userId) {
                userData.userId = generateUserId();
            }
            userData.registrationSkipped = true;
            saveUserData();
            
            document.getElementById('registrationOverlay').classList.add('hidden');
            
            alert('‚è≠Ô∏è Registration skipped. You can register anytime from the home screen to help us improve!');
        }
        
        // Log session
        async function logSession() {
            userData.sessionStart = new Date().toISOString();
            
            const deviceType = /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop';
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'session',
                        userId: userData.userId,
                        userName: userData.fullName || 'Anonymous',
                        sessionStart: userData.sessionStart,
                        deviceType: deviceType
                    })
                });
                
                console.log('Session logged');
            } catch (error) {
                console.error('Session logging error:', error);
            }
        }
        
        // Track progress (call this after completing each case)
        async function trackProgress(level, caseNumber, correct, total, knowledgeViewed, timeSpent) {
            const percentage = Math.round((correct / total) * 100);
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'progress',
                        userId: userData.userId,
                        userName: userData.fullName || 'Anonymous',
                        level: level,
                        caseNumber: caseNumber,
                        questionsCorrect: correct,
                        questionsTotal: total,
                        percentage: percentage,
                        knowledgeArticleViewed: knowledgeViewed ? 'Yes' : 'No',
                        timeSpentMinutes: Math.round(timeSpent / 60) || 0
                    })
                });
                
                console.log('Progress tracked');
            } catch (error) {
                console.error('Progress tracking error:', error);
            }
        }
        
        // Show registration form manually (from home screen)
        function showRegistrationForm() {
            document.getElementById('registrationOverlay').classList.remove('hidden');
        }
        
        // Download user data (privacy/GDPR)
        function downloadMyData() {
            loadUserData();
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'my-abg-tutor-data.json';
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // ============================================
        // ORIGINAL GAME STATE
        // ============================================
        
        // Global state
        let gameState = {
            unlockedLevels: [1],
            currentLevel: 1,
            currentCase: 0,
            currentQuestion: 0,
            levelScores: {},
            totalScore: { correct: 0, total: 0 },
            weaknesses: [],
            selectedChoice: null
        };

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('abgTutorProgress');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        // Save progress
        function saveProgress() {
            localStorage.setItem('abgTutorProgress', JSON.stringify(gameState));
        }

        // Initialize
        loadProgress();

        // Complete ABG Case Database - MCQ Format
        // Each question has: q (question text), choices (array), correct (letter A-D), category
        const allCases = {
            1: [ // Level 1 - Basic ABG Interpretation (15 cases)
                {
                    scenario: "A 22-year-old man presents with hyperventilation during a panic episode.",
                    abg: { pH: 7.52, PaCO2: 28, HCO3: 23, Na: 140, Cl: 102, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, over-compensated", "No, under-compensated"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 55-year-old woman with severe vomiting for 2 days arrives weak and dehydrated.",
                    abg: { pH: 7.49, PaCO2: 47, HCO3: 31, Na: 138, Cl: 92, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 71-year-old COPD patient presents with drowsiness and shallow breathing.",
                    abg: { pH: 7.29, PaCO2: 60, HCO3: 28, Na: 140, Cl: 100, Lactate: 1.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A young man with severe diarrhea for 24 hours arrives lethargic.",
                    abg: { pH: 7.31, PaCO2: 33, HCO3: 16, Na: 136, Cl: 108, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 28-year-old woman presents after intense exercise and hyperventilation.",
                    abg: { pH: 7.48, PaCO2: 30, HCO3: 22, Na: 141, Cl: 103, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 60-year-old man with renal failure arrives confused.",
                    abg: { pH: 7.30, PaCO2: 38, HCO3: 19, Na: 138, Cl: 102, Lactate: 1.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "B", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 45-year-old patient overdosed on opioids with shallow breathing.",
                    abg: { pH: 7.25, PaCO2: 58, HCO3: 24, Na: 139, Cl: 100, Lactate: 0.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "C", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 19-year-old woman presents with panic-induced rapid breathing.",
                    abg: { pH: 7.55, PaCO2: 26, HCO3: 22, Na: 142, Cl: 104, Lactate: 0.6 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "C", category: "compensation" }
                    ]
                },
                {
                    scenario: "A patient with uncontrolled diabetes arrives tachypneic.",
                    abg: { pH: 7.33, PaCO2: 29, HCO3: 14, Na: 137, Cl: 100, Lactate: 3.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 70-year-old heart failure patient presents with fatigue and CO2 retention.",
                    abg: { pH: 7.32, PaCO2: 52, HCO3: 26, Na: 140, Cl: 101, Lactate: 1.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "Partial compensation", "Acute, no compensation"], correct: "B", category: "compensation" }
                    ]
                },
                {
                    scenario: "A young adult after prolonged vomiting feels dizzy and weak.",
                    abg: { pH: 7.47, PaCO2: 46, HCO3: 29, Na: 138, Cl: 94, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "B", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 36-year-old man presents with diarrhea and dehydration.",
                    abg: { pH: 7.30, PaCO2: 32, HCO3: 15, Na: 136, Cl: 109, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A patient with pneumonia arrives hypoventilating.",
                    abg: { pH: 7.28, PaCO2: 55, HCO3: 26, Na: 138, Cl: 101, Lactate: 1.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "Partial compensation", "Acute, no compensation"], correct: "B", category: "compensation" }
                    ]
                },
                {
                    scenario: "A marathon runner collapses with rapid breathing and lightheadedness.",
                    abg: { pH: 7.51, PaCO2: 27, HCO3: 21, Na: 141, Cl: 104, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 65-year-old man with advanced COPD arrives exhausted and retaining CO2.",
                    abg: { pH: 7.34, PaCO2: 58, HCO3: 31, Na: 139, Cl: 100, Lactate: 1.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO2 only", "HCO3 only", "Both PaCO2 and HCO3", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO2", "HCO3", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, chronic compensation", "Partial compensation", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                }
            ],
            2: [ // Level 2 - Anion Gap Calculation (15 cases)
                {
                    scenario: "A 54-year-old man with alcohol binge presents confused and tachypneic.",
                    abg: { pH: 7.28, PaCO2: 29, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap (Anion gap = Na ‚àí (Cl + HCO3))", choices: ["15 mEq/L", "20 mEq/L", "27 mEq/L", "32 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal range", "Cannot determine"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (high anion gap)", "NAGMA (normal anion gap)", "Neither", "Mixed picture"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A young woman with severe diarrhea for 2 days arrives lethargic.",
                    abg: { pH: 7.29, PaCO2: 31, HCO3: 15, Na: 137, Cl: 108, Lactate: 1.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "14 mEq/L", "18 mEq/L", "22 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Borderline/Mildly elevated", "Normal range", "Low"], correct: "B", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (bicarbonate loss)", "Mixed", "Respiratory only"], correct: "B", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A diabetic patient arrives with Kussmaul breathing.",
                    abg: { pH: 7.21, PaCO2: 24, HCO3: 10, Na: 138, Cl: 98, Lactate: 6.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "25 mEq/L", "30 mEq/L", "35 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, severely elevated", "Mildly elevated", "Normal range", "Cannot determine"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (likely DKA)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A septic patient develops sudden hypotension.",
                    abg: { pH: 7.25, PaCO2: 30, HCO3: 12, Na: 140, Cl: 102, Lactate: 5.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "22 mEq/L", "26 mEq/L", "30 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal range", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Neither", "Respiratory"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A patient with profuse vomiting has mild dehydration.",
                    abg: { pH: 7.46, PaCO2: 47, HCO3: 30, Na: 139, Cl: 95, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "14 mEq/L", "18 mEq/L", "22 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "No, normal range", "Low", "Cannot determine"], correct: "B", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA", "Neither (no acidosis present)", "Mixed"], correct: "C", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "An elderly man with renal failure presents confused.",
                    abg: { pH: 7.26, PaCO2: 36, HCO3: 15, Na: 138, Cl: 100, Lactate: 2.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["15 mEq/L", "19 mEq/L", "23 mEq/L", "27 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal range", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (uremic acidosis)", "NAGMA", "Mixed", "Neither"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A young adult overdosed on salicylates is tachypneic and nauseated.",
                    abg: { pH: 7.39, PaCO2: 25, HCO3: 15, Na: 140, Cl: 102, Lactate: 3.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal/Borderline", "Alkalemia"], correct: "B", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Mixed disorder", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["15 mEq/L", "19 mEq/L", "23 mEq/L", "27 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (salicylate toxicity)", "NAGMA", "Neither", "Pure respiratory"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A 65-year-old man with CHF arrives in mild shock.",
                    abg: { pH: 7.31, PaCO2: 32, HCO3: 16, Na: 137, Cl: 101, Lactate: 2.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "20 mEq/L", "24 mEq/L", "28 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Mixed", "Neither"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A patient with ileostomy output >2 L/day arrives fatigued.",
                    abg: { pH: 7.33, PaCO2: 34, HCO3: 17, Na: 139, Cl: 110, Lactate: 0.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal range", "Low"], correct: "C", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (GI bicarbonate loss)", "Neither", "Mixed"], correct: "B", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A trauma patient arrives with tissue hypoperfusion.",
                    abg: { pH: 7.22, PaCO2: 28, HCO3: 12, Na: 138, Cl: 100, Lactate: 5.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "22 mEq/L", "26 mEq/L", "30 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A 72-year-old patient with chronic diarrhea arrives weak.",
                    abg: { pH: 7.30, PaCO2: 33, HCO3: 18, Na: 140, Cl: 112, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["6 mEq/L", "10 mEq/L", "14 mEq/L", "18 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal range", "Low"], correct: "C", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (chronic diarrhea)", "Neither", "Mixed"], correct: "B", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A patient with metformin toxicity and vomiting arrives drowsy.",
                    abg: { pH: 7.18, PaCO2: 26, HCO3: 11, Na: 137, Cl: 99, Lactate: 6.4 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, severely elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (metformin toxicity)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A dehydrated elderly woman presents with dizziness and low intake.",
                    abg: { pH: 7.36, PaCO2: 38, HCO3: 21, Na: 142, Cl: 104, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "B", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Normal ABG"], correct: "D", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["13 mEq/L", "17 mEq/L", "21 mEq/L", "25 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline/Mildly elevated", "Normal", "Low"], correct: "B", category: "Anion gap interpretation" },
                        { q: "Classification?", choices: ["HAGMA", "NAGMA", "Neither (pH normal)", "Mixed"], correct: "C", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A patient with AKI following sepsis deterioration arrives hypotensive.",
                    abg: { pH: 7.24, PaCO2: 30, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis + AKI)", "NAGMA", "Neither", "Pure respiratory"], correct: "A", category: "Anion gap interpretation" }
                    ]
                },
                {
                    scenario: "A young man with cholera-like diarrhea arrives exhausted.",
                    abg: { pH: 7.32, PaCO2: 35, HCO3: 18, Na: 136, Cl: 113, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["3 mEq/L", "5 mEq/L", "9 mEq/L", "13 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal/low", "Cannot determine"], correct: "C", category: "Anion gap interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (severe diarrhea)", "Neither", "Mixed"], correct: "B", category: "Anion gap interpretation" }
                    ]
                }
            ],  
            3: [ // Level 3 - Winter's Formula (15 cases)
                {
                    scenario: "A diabetic patient presents with deep, rapid breathing and dehydration.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 10, Na: 138, Cl: 100, Lactate: 5.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula: 1.5 √ó HCO3 + 8 ¬± 2", choices: ["17-21 mmHg", "19-23 mmHg", "21-25 mmHg", "23-27 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 22 mmHg. Does this fall within the expected range?", choices: ["Yes, within expected range", "No, below expected range", "No, above expected range"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate compensation", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A septic shock patient arrives tachypneic with cold extremities.",
                    abg: { pH: 7.24, PaCO2: 25, HCO3: 11, Na: 140, Cl: 102, Lactate: 6.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["19.5-23.5 mmHg", "22.5-26.5 mmHg", "24.5-28.5 mmHg", "26.5-30.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 25 mmHg. Is this within range?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A 70-year-old with renal failure arrives lethargic.",
                    abg: { pH: 7.26, PaCO2: 28, HCO3: 12, Na: 138, Cl: 100, Lactate: 3.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["22-26 mmHg", "24-28 mmHg", "26-30 mmHg", "28-32 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 28 mmHg. Is this adequate?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation appropriate?", choices: ["Yes, appropriate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, coexisting respiratory acidosis", "Yes, coexisting respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A metformin toxicity case presents with vomiting and altered mentation.",
                    abg: { pH: 7.20, PaCO2: 23, HCO3: 10, Na: 137, Cl: 99, Lactate: 7.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["17-21 mmHg", "19-23 mmHg", "21-25 mmHg", "23-27 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 23 mmHg. Assessment?", choices: ["Within expected range", "Below expected", "Above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, appropriate compensation", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis present", "Yes, respiratory alkalosis present"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A trauma patient with blood loss arrives pale and hypotensive.",
                    abg: { pH: 7.29, PaCO2: 30, HCO3: 14, Na: 139, Cl: 101, Lactate: 3.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["25-29 mmHg", "27-31 mmHg", "29-33 mmHg", "31-35 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 30 mmHg. Is this appropriate?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a concomitant respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A malnourished alcoholic arrives confused and tachypneic.",
                    abg: { pH: 7.31, PaCO2: 28, HCO3: 14, Na: 140, Cl: 102, Lactate: 4.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["25-29 mmHg", "27-31 mmHg", "29-33 mmHg", "31-35 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 28 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation appropriate?", choices: ["Yes", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A young adult with prolonged seizures arrives acidotic.",
                    abg: { pH: 7.27, PaCO2: 32, HCO3: 15, Na: 138, Cl: 100, Lactate: 5.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["26.5-30.5 mmHg", "28.5-32.5 mmHg", "30.5-34.5 mmHg", "32.5-36.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 32 mmHg. Is this within range?", choices: ["Yes, appropriate", "No, below range", "No, above range"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A dehydrated patient with diarrhea appears weak and tachypneic.",
                    abg: { pH: 7.33, PaCO2: 30, HCO3: 16, Na: 140, Cl: 108, Lactate: 1.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["28-32 mmHg", "30-34 mmHg", "32-36 mmHg", "34-38 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 30 mmHg. Assessment?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with early septic shock is hyperventilating.",
                    abg: { pH: 7.36, PaCO2: 29, HCO3: 17, Na: 139, Cl: 101, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Mixed disorder"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["31.5-35.5 mmHg", "33.5-37.5 mmHg", "35.5-39.5 mmHg", "37.5-41.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 29 mmHg. Is this appropriate?", choices: ["No, below expected (over-compensated)", "Yes, within expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate or excessive?", choices: ["Excessive/Over-compensated", "Adequate", "Insufficient"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["Yes, concomitant respiratory alkalosis", "No", "Yes, respiratory acidosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "An elderly woman with uremia presents with Kussmaul breathing.",
                    abg: { pH: 7.25, PaCO2: 27, HCO3: 12, Na: 138, Cl: 102, Lactate: 4.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["22-26 mmHg", "24-28 mmHg", "26-30 mmHg", "28-32 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 27 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with lactic acidosis due to hypoperfusion arrives cold and sweaty.",
                    abg: { pH: 7.21, PaCO2: 26, HCO3: 10, Na: 140, Cl: 100, Lactate: 6.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["19-23 mmHg", "21-25 mmHg", "23-27 mmHg", "25-29 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 26 mmHg. Is this within range?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, appropriate", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with pancreatitis presents with rapid breathing.",
                    abg: { pH: 7.28, PaCO2: 31, HCO3: 15, Na: 137, Cl: 100, Lactate: 2.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["26.5-30.5 mmHg", "28.5-32.5 mmHg", "30.5-34.5 mmHg", "32.5-36.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 31 mmHg. Is this appropriate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "An elderly man with chronic kidney disease presents fatigued and dyspneic.",
                    abg: { pH: 7.32, PaCO2: 33, HCO3: 17, Na: 138, Cl: 102, Lactate: 1.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["29.5-33.5 mmHg", "31.5-35.5 mmHg", "33.5-37.5 mmHg", "35.5-39.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO2 is 33 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with toxic alcohol ingestion arrives disoriented.",
                    abg: { pH: 7.19, PaCO2: 20, HCO3: 9, Na: 140, Cl: 98, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["17.5-21.5 mmHg", "19.5-23.5 mmHg", "21.5-25.5 mmHg", "23.5-27.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 20 mmHg. Is this within range?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A post-arrest patient has poor perfusion and deep acidosis.",
                    abg: { pH: 7.17, PaCO2: 24, HCO3: 9, Na: 138, Cl: 100, Lactate: 7.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO2 using Winter's formula", choices: ["17.5-21.5 mmHg", "19.5-23.5 mmHg", "21.5-25.5 mmHg", "23.5-27.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO2 is 24 mmHg. Is this appropriate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                }
            ],  
            4: [ // Level 4 - Adjusted Bicarbonate (15 cases)
                {
                    scenario: "A metformin toxicity patient presents severely acidotic and tachypneic.",
                    abg: { pH: 7.18, PaCO2: 24, HCO3: 11, Na: 138, Cl: 100, Lactate: 7.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap: Anion gap = Na ‚àí (Cl + HCO3)", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "How do you classify the adjusted HCO3?", choices: ["<18 (NAGMA present)", "18-30 (Pure HAGMA)", ">30 (Hidden metabolic alkalosis)", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, concurrent NAGMA", "Yes, concurrent metabolic alkalosis", "Mixed picture"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A vomiting diabetic patient arrives dehydrated with abdominal pain.",
                    abg: { pH: 7.29, PaCO2: 28, HCO3: 14, Na: 139, Cl: 97, Lactate: 3.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "How do you classify the adjusted HCO3?", choices: ["<18 (NAGMA present)", "18-30 (Pure HAGMA)", ">30 (Hidden metabolic alkalosis)", "Normal"], correct: "C", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, concurrent NAGMA", "Yes, concurrent metabolic alkalosis (from vomiting)", "Cannot determine"], correct: "C", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A CKD patient with missed dialysis presents weak and dyspneic.",
                    abg: { pH: 7.24, PaCO2: 29, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18 (additional NAGMA)", "18-30 (Pure HAGMA)", ">30 (metabolic alkalosis)", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA (uremic acidosis)", "Yes, NAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A sepsis patient becomes acidotic despite IV fluids.",
                    abg: { pH: 7.20, PaCO2: 26, HCO3: 11, Na: 138, Cl: 102, Lactate: 6.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis (HAGMA)", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A dehydrated alcoholic arrives tachypneic and confused.",
                    abg: { pH: 7.33, PaCO2: 27, HCO3: 15, Na: 140, Cl: 102, Lactate: 3.9 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["17 mEq/L", "20 mEq/L", "23 mEq/L", "26 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Normal"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure alcoholic ketoacidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed disorder"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A patient with prolonged diarrhea presents acidotic and tired.",
                    abg: { pH: 7.30, PaCO2: 32, HCO3: 16, Na: 136, Cl: 112, Lactate: 1.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["4 mEq/L", "8 mEq/L", "12 mEq/L", "16 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18 (Low - pure NAGMA)", "18-30", ">30", "Normal"], correct: "A", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure NAGMA from GI losses", "Yes, HAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives with visual disturbances.",
                    abg: { pH: 7.12, PaCO2: 22, HCO3: 9, Na: 139, Cl: 98, Lactate: 10.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "28 mEq/L", "32 mEq/L", "36 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure toxic alcohol HAGMA", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A patient in early renal shutdown becomes progressively acidotic.",
                    abg: { pH: 7.26, PaCO2: 31, HCO3: 15, Na: 140, Cl: 103, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "19 mEq/L", "22 mEq/L", "25 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, NAGMA", "Yes, metabolic alkalosis", "Cannot determine"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A lactic acidosis patient deteriorates during septic shock.",
                    abg: { pH: 7.19, PaCO2: 27, HCO3: 12, Na: 138, Cl: 101, Lactate: 7.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Normal"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A vomiting patient with starvation ketosis presents fatigued.",
                    abg: { pH: 7.38, PaCO2: 30, HCO3: 17, Na: 139, Cl: 98, Lactate: 2.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Normal/Compensated", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Borderline high"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, compensated ketoacidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A pancreatitis patient becomes acidotic and tachypneic.",
                    abg: { pH: 7.25, PaCO2: 28, HCO3: 13, Na: 138, Cl: 100, Lactate: 5.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis from pancreatitis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A severe hypoperfusion patient with cool extremities arrives.",
                    abg: { pH: 7.16, PaCO2: 24, HCO3: 10, Na: 140, Cl: 101, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure severe lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A DKA patient partially treated arrives still acidotic.",
                    abg: { pH: 7.24, PaCO2: 31, HCO3: 14, Na: 137, Cl: 101, Lactate: 4.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "19 mEq/L", "22 mEq/L", "25 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, resolving DKA (pure HAGMA)", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A renal tubular acidosis patient presents with fatigue.",
                    abg: { pH: 7.30, PaCO2: 33, HCO3: 17, Na: 138, Cl: 112, Lactate: 0.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["5 mEq/L", "9 mEq/L", "13 mEq/L", "17 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)", choices: ["11 mEq/L", "14 mEq/L", "17 mEq/L", "20 mEq/L"], correct: "B", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18 (Low - pure NAGMA)", "18-30", ">30", "Normal"], correct: "A", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure RTA (NAGMA)", "Yes, HAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A post-arrest patient presents with severe global hypoxia.",
                    abg: { pH: 7.15, PaCO2: 23, HCO3: 9, Na: 139, Cl: 100, Lactate: 9.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate adjusted HCO3", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO3?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure post-arrest lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                }
            ],
            5: [ // Level 5 - Delta Ratio & Mixed Disorders (15 cases)
                {
                    scenario: "A DKA patient with vomiting arrives dehydrated and tachypneic.",
                    abg: { pH: 7.22, PaCO2: 26, HCO3: 12, Na: 138, Cl: 99, Lactate: 6.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio = (Anion gap ‚àí 12) √∑ (24 ‚àí HCO3)", choices: ["0.8", "1.25", "1.8", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "How do you interpret the delta ratio?", choices: ["<1 (HAGMA + NAGMA)", "1-2 (Pure HAGMA)", ">2 (HAGMA + metabolic alkalosis)", "Cannot determine"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (DKA)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives severely confused.",
                    abg: { pH: 7.09, PaCO2: 18, HCO3: 6, Na: 140, Cl: 100, Lactate: 12.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["28 mEq/L", "31 mEq/L", "34 mEq/L", "37 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.22", "1.7", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "How do you interpret the delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (toxic alcohol)", "HAGMA + NAGMA", "HAGMA + respiratory alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with septic shock hyperventilates rapidly.",
                    abg: { pH: 7.28, PaCO2: 20, HCO3: 9, Na: 138, Cl: 101, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Mixed disorder", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.07", "1.5", "2.1"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "HAGMA + concurrent respiratory alkalosis", "HAGMA + NAGMA", "Triple disorder"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A vomiting diabetic arrives with mixed ketoacidosis and dehydration.",
                    abg: { pH: 7.31, PaCO2: 28, HCO3: 14, Na: 139, Cl: 96, Lactate: 4.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["1.2", "1.7", "2.2", "2.7"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "High"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (DKA)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A renal failure patient presents with acidosis and vomiting.",
                    abg: { pH: 7.27, PaCO2: 30, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.36", "1.8", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (uremic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A COPD patient with lactic acidosis presents hypoventilating.",
                    abg: { pH: 7.25, PaCO2: 54, HCO3: 24, Na: 138, Cl: 98, Lactate: 5.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Pure respiratory acidosis", "Pure metabolic acidosis", "Mixed: Respiratory + Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "13 mEq/L", "16 mEq/L", "19 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.5", "1.0", "1.5", "2.0"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (borderline)", ">2", "Very low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure respiratory acidosis", "HAGMA with concurrent respiratory acidosis", "Pure HAGMA", "NAGMA"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A starvation ketosis patient also has severe diarrhea.",
                    abg: { pH: 7.33, PaCO2: 30, HCO3: 16, Na: 139, Cl: 111, Lactate: 2.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (Anion gap normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure NAGMA (GI losses)", "HAGMA + NAGMA", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A hypothermic shock patient arrives with severe Anion gap elevation.",
                    abg: { pH: 7.14, PaCO2: 26, HCO3: 10, Na: 140, Cl: 100, Lactate: 10.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.29", "1.8", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with alcoholic ketoacidosis and vomiting arrives tachypneic.",
                    abg: { pH: 7.30, PaCO2: 28, HCO3: 14, Na: 138, Cl: 98, Lactate: 5.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["1.0", "1.4", "1.9", "2.4"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (alcoholic ketoacidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A multi-organ failure patient has profound acidemia.",
                    abg: { pH: 7.11, PaCO2: 24, HCO3: 8, Na: 139, Cl: 100, Lactate: 11.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["25 mEq/L", "28 mEq/L", "31 mEq/L", "34 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.19", "1.6", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (multi-organ lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with DKA + diarrhea is severely dehydrated.",
                    abg: { pH: 7.25, PaCO2: 27, HCO3: 12, Na: 136, Cl: 112, Lactate: 4.4 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (Anion gap normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure NAGMA (hyperchloremic acidosis)", "HAGMA + NAGMA", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives hyperventilating.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 9, Na: 140, Cl: 102, Lactate: 9.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.13", "1.6", "2.1"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (toxic alcohol + lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A chronic CO2 retainer develops lactic acidosis from hypoperfusion.",
                    abg: { pH: 7.29, PaCO2: 60, HCO3: 28, Na: 138, Cl: 98, Lactate: 4.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Pure respiratory acidosis", "Pure metabolic acidosis", "Chronic respiratory acidosis (compensated)", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (Anion gap normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Chronic respiratory acidosis (COPD)", "HAGMA + respiratory acidosis", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with metabolic alkalosis from vomiting develops sepsis.",
                    abg: { pH: 7.41, PaCO2: 30, HCO3: 19, Na: 140, Cl: 97, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory alkalosis", "Metabolic acidosis", "Mixed: metabolic alkalosis + acidosis", "Normal"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["1.2", "1.8", "2.4", "3.0"], correct: "C", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2", ">2 (hidden metabolic alkalosis)", "Very high"], correct: "C", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure metabolic alkalosis", "HAGMA + concurrent metabolic alkalosis", "Triple disorder"], correct: "C", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A cardiac arrest survivor arrives profoundly acidotic.",
                    abg: { pH: 7.08, PaCO2: 26, HCO3: 7, Na: 138, Cl: 100, Lactate: 12.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["25 mEq/L", "28 mEq/L", "31 mEq/L", "34 mEq/L"], correct: "C", category: "Anion gap calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.12", "1.6", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (post-arrest lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                }
            ]
        };

        // Track answers for each case
        let caseAnswers = [];

        // Show/hide screens
        function showScreen(screenId, addToHistory = true) {
            const screens = ['homeScreen', 'compendiumScreen', 'placementScreen', 'levelSelectScreen', 
                            'progressScreen', 'startCaseScreen', 'caseScreen', 'caseSummaryScreen', 'levelCompleteScreen',
                            'levelIntroScreen', 'knowledgeArticleScreen', 'masteryQuizScreen', 'masteryCompletionScreen']; // Added Mastery screens
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            
            // Add to browser history to enable back button
            if (addToHistory) {
                window.history.pushState({ screen: screenId }, '', `#${screenId}`);
            }
        }
        
        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.screen) {
                showScreen(event.state.screen, false); // Don't add to history again
            } else {
                // If no state, go to home
                showScreen('homeScreen', false);
            }
        });
        
        // Initialize on load
        window.addEventListener('load', function() {
            // Set initial history state
            window.history.replaceState({ screen: 'homeScreen' }, '', '#homeScreen');
            
            // Show install prompt after a short delay
            setTimeout(showInstallPrompt, 2000);
        });
        
        // PWA Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
        });
        
        function showInstallPrompt() {
            // Check if already installed or dismissed
            if (localStorage.getItem('installPromptDismissed') === 'true') {
                return;
            }
            
            // Check if running as installed app
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
                return; // Already installed
            }
            
            // Create install prompt banner
            const banner = document.createElement('div');
            banner.id = 'installBanner';
            banner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 20px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: space-between;
                animation: slideDown 0.3s ease-out;
            `;
            
            banner.innerHTML = `
                <div style="flex: 1;">
                    <strong style="display: block; font-size: 16px; margin-bottom: 4px;">üì± Install ABG Tutor</strong>
                    <span style="font-size: 14px; opacity: 0.95;">Add to your home screen for quick access & offline use</span>
                </div>
                <div style="display: flex; gap: 10px; margin-left: 15px;">
                    <button onclick="installApp()" style="background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 14px; white-space: nowrap;">
                        Install
                    </button>
                    <button onclick="dismissInstallPrompt()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                        Maybe Later
                    </button>
                </div>
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from {
                        transform: translateY(-100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(banner);
        }
        
        function installApp() {
            const banner = document.getElementById('installBanner');
            
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback for iOS or browsers that don't support beforeinstallprompt
                showIOSInstallInstructions();
            }
            
            if (banner) {
                banner.remove();
            }
        }
        
        function showIOSInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            
            if (isIOS && isSafari) {
                alert('To install on iPhone/iPad:\n\n1. Tap the Share button (square with arrow)\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" in the top right corner');
            } else {
                alert('To install:\n\n‚Ä¢ Chrome/Edge: Look for the install icon in the address bar\n‚Ä¢ Firefox: Tap the menu and select "Install"\n‚Ä¢ Safari (iOS): Tap Share ‚Üí Add to Home Screen');
            }
        }
        
        function dismissInstallPrompt() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.style.animation = 'slideDown 0.3s ease-out reverse';
                setTimeout(() => banner.remove(), 300);
            }
            localStorage.setItem('installPromptDismissed', 'true');
        }
        
        // Show install prompt again after 7 days if dismissed
        setTimeout(() => {
            localStorage.removeItem('installPromptDismissed');
        }, 7 * 24 * 60 * 60 * 1000); // 7 days

        function goHome() {
            showScreen('homeScreen');
        }
        
        function returnHome() {
            showScreen('homeScreen');
        }

        function showCompendium() {
            showScreen('compendiumScreen');
        }

        function hideCompendium() {
            showScreen('homeScreen');
        }
        
        function showProgress() {
            showScreen('progressScreen');
        }

        // ============================================
        // KNOWLEDGE MODULE SYSTEM  
        // ============================================
        
        const levelKnowledgeArticles = {
            1: `
                <h2>LEVEL 1 ‚Äî FOUNDATIONS OF ABG INTERPRETATION</h2>
                
                <h3>1. Purpose of Level 1</h3>
                <p>Level 1 builds the core foundations required for ABG interpretation. The focus is on recognizing simple, single-process disorders without compensation analysis or advanced equations.</p>
                
                <p>By the end of this level, a learner should reliably identify:</p>
                <ul>
                    <li>Whether the pH is acidic, normal, or alkaline</li>
                    <li>Which component (PaCO2 or HCO3-) is moving in the same direction as pH</li>
                    <li>The primary acid‚Äìbase disorder</li>
                    <li>The basic direction of respiratory compensation (but NOT the magnitude)</li>
                </ul>
                <p><strong>This level does not use formal equations.</strong></p>
                
                <h3>2. What You Will Learn</h3>
                <ul>
                    <li>How to divide an ABG into three key units: pH, PaCO2, HCO3-</li>
                    <li>How to classify acidemia vs alkalemia</li>
                    <li>How to determine whether respiratory or metabolic components dominate</li>
                    <li>Recognizing simple patterns without mixed disorders</li>
                    <li>Exposure to common clinical ABGs in everyday practice</li>
                </ul>
                
                <h3>3. Core Interpretation Skills (Level 1)</h3>
                <ul>
                    <li>Identify acidemia or alkalemia</li>
                    <li>Identify if PaCO2 is high or low</li>
                    <li>Identify if HCO3- is high or low</li>
                    <li>Match the direction of pH with the correct component</li>
                    <li>Name the primary disorder: Metabolic acidosis, Metabolic alkalosis, Respiratory acidosis, Respiratory alkalosis</li>
                </ul>
                <p><strong>This level is pattern recognition training, not calculation.</strong></p>
                
                <h3>4. Relevant Equations for This Level</h3>
                <p><strong>None.</strong> Level 1 is intentionally equation-free.</p>
                <p>The goal is to train the learner's eyes to identify the "shape" of an ABG and label the disorder correctly, without needing mathematical tools.</p>
                
                <h3>5. Common Clinical Conditions in Level 1</h3>
                <p><strong>Metabolic Acidosis (simple NAGMA):</strong></p>
                <ul>
                    <li>Diarrhea</li>
                    <li>Ileostomy losses</li>
                    <li>Renal tubular acidosis</li>
                </ul>
                
                <p><strong>Metabolic Alkalosis:</strong></p>
                <ul>
                    <li>Vomiting</li>
                    <li>Diuretic use</li>
                    <li>Post-hypercapnic alkalosis (simple form)</li>
                </ul>
                
                <p><strong>Respiratory Acidosis:</strong></p>
                <ul>
                    <li>COPD hypoventilation</li>
                    <li>Opioid overdose</li>
                    <li>Sedative-induced respiratory depression</li>
                </ul>
                
                <p><strong>Respiratory Alkalosis:</strong></p>
                <ul>
                    <li>Panic hyperventilation</li>
                    <li>Pain/anxiety</li>
                    <li>Early sepsis</li>
                </ul>
                <p>These are single-process disorders with predictable patterns.</p>
                
                <h3>6. Pattern Recognition Pearls</h3>
                <ul>
                    <li>If pH is low and PaCO2 is high ‚Üí respiratory acidosis</li>
                    <li>If pH is low and HCO3- is low ‚Üí metabolic acidosis</li>
                    <li>If pH is high and PaCO2 is low ‚Üí respiratory alkalosis</li>
                    <li>If pH is high and HCO3- is high ‚Üí metabolic alkalosis</li>
                    <li>If PaCO2 and HCO3- go in opposite directions ‚Üí mixed disorder (NOT tested at this level)</li>
                </ul>
                <p><strong>Level 1 teaches you to trust these patterns.</strong></p>
                
                <h3>7. Common Mistakes at Level 1</h3>
                <ul>
                    <li>Confusing primary disorder with compensation direction</li>
                    <li>Misreading units or mixing pH vs PaCO2 vs HCO3-</li>
                    <li>Thinking every acidosis has high Anion gap (not true)</li>
                    <li>Assuming hyperventilation = metabolic issue (often respiratory)</li>
                </ul>
                <p>These mistakes will be automatically tracked by the tutor.</p>
                
                <h3>8. What Level 1 Prepares You For</h3>
                <p>Level 1 gives you the foundation needed to progress to <strong>Level 2 ‚Äî Anion Gap Mastery.</strong></p>
                <p>After mastering Level 1, learners can correctly identify the primary disorder. Level 2 builds on this by showing why the disorder exists ‚Äî and what biochemical process is behind it.</p>
            `,
            2: `
                <h2>LEVEL 2 ‚Äî ANION GAP MASTERY</h2>
                
                <h3>1. Purpose of Level 2</h3>
                <p>Level 2 introduces the biochemical foundation of metabolic acidosis: the Anion Gap (AG). This is the level where a learner transitions from "pattern recognition" to diagnostic precision.</p>
                
                <p>By the end of this level, a learner should be able to:</p>
                <ul>
                    <li>Correctly calculate the anion gap</li>
                    <li>Correct for hypoalbuminemia</li>
                    <li>Distinguish high Anion gap metabolic acidosis from normal Anion gap metabolic acidosis</li>
                    <li>Recognize the major diseases behind each pattern</li>
                    <li>Understand why the body generates an anion gap</li>
                </ul>
                <p>This level sets the stage for advanced mixed-disorder analysis.</p>
                
                <h3>2. What You Will Learn</h3>
                <ul>
                    <li>How to calculate Anion gap using Na, Cl, and HCO3</li>
                    <li>Why albumin must be considered</li>
                    <li>Physiologic difference between HAGMA and NAGMA</li>
                    <li>How to interpret Anion gap in common diseases</li>
                    <li>Identifying early metabolic emergencies</li>
                    <li>Recognizing "clean" vs "dirty" acidosis</li>
                </ul>
                <p><strong>Level 2 begins true biochemical interpretation.</strong></p>
                
                <h3>3. Core Interpretation Skills (Level 2)</h3>
                <ul>
                    <li>Compute Anion gap using the classical equation</li>
                    <li>Apply albumin correction when appropriate</li>
                    <li>Classify metabolic acidosis into: HAGMA (high anion gap metabolic acidosis) and NAGMA (normal anion gap metabolic acidosis)</li>
                    <li>Link Anion gap category to probable diagnosis</li>
                    <li>Integrate Anion gap with Level 1 primary disorder recognition</li>
                </ul>
                <p>This level focuses on metabolic acidosis only, not compensation.</p>
                
                <h3>4. Relevant Equations for This Level</h3>
                <p><strong>Anion Gap (AG)</strong></p>
                <p>AG = Na ‚àí (Cl + HCO3)</p>
                
                <p><strong>Corrected Anion Gap</strong></p>
                <p>Corrected Anion gap = Anion gap + 2.5 √ó (4 ‚àí albumin)</p>
                
                <p><strong>Interpretation:</strong></p>
                <ul>
                    <li>Normal Anion gap: 8‚Äì12 (albumin 4 g/dL)</li>
                    <li>High Anion gap ‚Üí unmeasured acids present</li>
                    <li>Normal Anion gap ‚Üí bicarbonate loss or impaired renal acid secretion</li>
                </ul>
                <p><strong>These are the ONLY equations used in Level 2.</strong></p>
                
                <h3>5. Common Clinical Conditions in Level 2</h3>
                <p><strong>High Anion gap Metabolic Acidosis (HAGMA)</strong></p>
                <p>Caused by accumulation of acids:</p>
                <ul>
                    <li>DKA</li>
                    <li>Lactic acidosis (shock, sepsis, hypoxia)</li>
                    <li>Uremic acidosis (renal failure)</li>
                    <li>Toxic alcohols (methanol, ethylene glycol)</li>
                    <li>Salicylate poisoning</li>
                    <li>Metformin toxicity</li>
                    <li>Severe sepsis</li>
                </ul>
                <p>These conditions produce unmeasured anions ‚Üí ‚Üë Anion gap.</p>
                
                <p><strong>Normal Anion gap Metabolic Acidosis (NAGMA)</strong></p>
                <p>Caused by bicarbonate loss or impaired secretion:</p>
                <ul>
                    <li>Diarrhea</li>
                    <li>Ileostomy losses</li>
                    <li>Renal tubular acidosis</li>
                    <li>Carbonic anhydrase inhibitors</li>
                    <li>Early renal failure (mild)</li>
                </ul>
                <p>These do NOT produce unmeasured acids ‚Üí Anion gap stays normal.</p>
                
                <h3>6. Pattern Recognition Pearls</h3>
                <ul>
                    <li>A very low HCO3 with normal Anion gap almost always means bicarbonate loss (diarrhea, RTA)</li>
                    <li>A high Anion gap disproportionately high relative to HCO3 drop signals toxic ingestion or lactic overload</li>
                    <li>DKA often shows moderately elevated Anion gap with very low HCO3 and rapid breathing</li>
                    <li>Sepsis produces high Anion gap from elevated lactate ‚Äî ALWAYS a red flag</li>
                    <li>Uremic acidosis shows high Anion gap with normal or mildly elevated lactate</li>
                </ul>
                
                <h3>7. Common Mistakes at Level 2</h3>
                <ul>
                    <li>Forgetting to correct Anion gap for albumin</li>
                    <li>Assuming all metabolic acidosis has high AG</li>
                    <li>Not recognizing NAGMA as a distinct category</li>
                    <li>Miscalculating Anion gap due to arithmetic errors</li>
                    <li>Ignoring lactate when interpreting HAGMA</li>
                </ul>
                
                <h3>8. What Level 2 Prepares You For</h3>
                <p>Level 2 opens the door to understanding <strong>Level 3 ‚Äî Winter's Formula and Respiratory Compensation.</strong></p>
                <p>Once you can reliably calculate and interpret Anion gap, you're ready to assess whether the respiratory system is compensating appropriately for the metabolic disorder.</p>
            `,
            3: `
                <h2>LEVEL 3 ‚Äî WINTER'S FORMULA & RESPIRATORY COMPENSATION</h2>
                
                <h3>1. Purpose of Level 3</h3>
                <p>Level 3 introduces the concept of respiratory compensation for metabolic acidosis using Winter's Formula. This is where learners begin to detect mixed disorders by comparing expected vs actual PaCO2.</p>
                
                <p>By the end of this level, a learner should be able to:</p>
                <ul>
                    <li>Calculate expected PaCO2 using Winter's Formula</li>
                    <li>Determine if respiratory compensation is appropriate</li>
                    <li>Detect hidden respiratory acidosis or alkalosis</li>
                    <li>Understand the physiologic limits of compensation</li>
                    <li>Recognize when a "simple" acidosis is actually mixed</li>
                </ul>
                
                <h3>2. What You Will Learn</h3>
                <ul>
                    <li>How the respiratory system compensates for metabolic acidosis</li>
                    <li>The mathematical relationship between HCO3 and PaCO2</li>
                    <li>How to apply Winter's Formula correctly</li>
                    <li>When compensation is appropriate vs inappropriate</li>
                    <li>How to detect concurrent respiratory disorders</li>
                </ul>
                
                <h3>3. Core Interpretation Skills (Level 3)</h3>
                <ul>
                    <li>Calculate expected PaCO2 using Winter's Formula</li>
                    <li>Compare actual PaCO2 to expected range</li>
                    <li>Identify appropriate compensation</li>
                    <li>Detect over-compensation (respiratory alkalosis)</li>
                    <li>Detect under-compensation (respiratory acidosis)</li>
                </ul>
                
                <h3>4. Relevant Equation for This Level</h3>
                <p><strong>Winter's Formula (Metabolic Acidosis Compensation)</strong></p>
                <p>Expected PaCO2 = 1.5 √ó HCO3 + 8 ¬± 2</p>
                
                <p><strong>Use:</strong> Only when HCO3 is low (metabolic acidosis)</p>
                
                <p><strong>Interpretation:</strong></p>
                <ul>
                    <li>Actual PaCO2 > expected ‚Üí concomitant respiratory acidosis</li>
                    <li>Actual PaCO2 < expected ‚Üí concomitant respiratory alkalosis</li>
                    <li>Within ¬±2 ‚Üí appropriate compensation</li>
                </ul>
                
                <h3>5. Common Clinical Conditions in Level 3</h3>
                <p><strong>Pure Metabolic Acidosis with Appropriate Compensation:</strong></p>
                <ul>
                    <li>Classic DKA</li>
                    <li>Lactic acidosis from sepsis</li>
                    <li>Uremic acidosis</li>
                    <li>Diarrhea-induced acidosis</li>
                </ul>
                
                <p><strong>Metabolic Acidosis + Respiratory Acidosis:</strong></p>
                <ul>
                    <li>Septic shock + COPD exacerbation</li>
                    <li>DKA + sedative overdose</li>
                    <li>Lactic acidosis + respiratory failure</li>
                </ul>
                
                <p><strong>Metabolic Acidosis + Respiratory Alkalosis:</strong></p>
                <ul>
                    <li>Early sepsis with hyperventilation</li>
                    <li>Salicylate poisoning (direct respiratory stimulation)</li>
                    <li>Panic + metabolic stress</li>
                </ul>
                
                <h3>6. Pattern Recognition Pearls</h3>
                <ul>
                    <li>If PaCO2 is "too high" for the HCO3 ‚Üí think respiratory failure</li>
                    <li>If PaCO2 is "too low" for the HCO3 ‚Üí think hyperventilation or salicylates</li>
                    <li>Winter's Formula only works for metabolic acidosis, NOT alkalosis</li>
                    <li>Compensation takes hours to days ‚Äî acute changes may not show full compensation</li>
                </ul>
                
                <h3>7. Common Mistakes at Level 3</h3>
                <ul>
                    <li>Using Winter's Formula for metabolic alkalosis</li>
                    <li>Forgetting the ¬±2 mmHg margin of error</li>
                    <li>Not calculating expected PaCO2 before interpreting</li>
                    <li>Confusing compensation with correction</li>
                    <li>Ignoring clinical context when compensation seems "off"</li>
                </ul>
                
                <h3>8. What Level 3 Prepares You For</h3>
                <p>Level 3 builds the foundation for <strong>Level 4 ‚Äî Adjusted Bicarbonate and Hidden Disorders.</strong></p>
                <p>Once you can assess respiratory compensation, you're ready to detect hidden metabolic disorders using Adjusted HCO3.</p>
            `,
            4: `
                <h2>LEVEL 4 ‚Äî ADJUSTED BICARBONATE & HIDDEN DISORDERS</h2>
                
                <h3>1. Purpose of Level 4</h3>
                <p>Level 4 introduces Adjusted Bicarbonate, the tool that reveals hidden metabolic disorders in high anion gap acidosis. This level teaches learners to detect NAGMA and metabolic alkalosis that coexist with HAGMA.</p>
                
                <p>By the end of this level, a learner should be able to:</p>
                <ul>
                    <li>Calculate Adjusted HCO3</li>
                    <li>Interpret under-correction or over-correction</li>
                    <li>Detect: HAGMA + NAGMA, HAGMA + Metabolic Alkalosis, Pure HAGMA</li>
                </ul>
                <p>This level brings the metabolic system into full clinical clarity.</p>
                
                <h3>2. What You Will Learn</h3>
                <ul>
                    <li>Why Anion gap rise and HCO3 fall should correlate</li>
                    <li>How deviations expose additional disorders</li>
                    <li>How to calculate and interpret Adjusted HCO3</li>
                    <li>How to identify masked metabolic processes</li>
                    <li>The clinical significance of mixed metabolic disorders</li>
                </ul>
                
                <h3>3. Core Interpretation Skills (Level 4)</h3>
                <ul>
                    <li>Calculate Adjusted HCO3 for any HAGMA</li>
                    <li>Interpret the three zones: <18, 18-30, >30</li>
                    <li>Detect hidden NAGMA</li>
                    <li>Detect hidden metabolic alkalosis</li>
                    <li>Integrate with Anion gap and Winter's Formula</li>
                </ul>
                
                <h3>4. Relevant Equation for This Level</h3>
                <p><strong>Adjusted Bicarbonate</strong></p>
                <p>Adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)</p>
                
                <p><strong>Interpretation:</strong></p>
                <ul>
                    <li>Adjusted HCO3 < 18 ‚Üí Additional NAGMA</li>
                    <li>Adjusted HCO3 18‚Äì30 ‚Üí Pure HAGMA</li>
                    <li>Adjusted HCO3 > 30 ‚Üí Concurrent Metabolic Alkalosis</li>
                </ul>
                <p><strong>This equation is the heart of Level 4.</strong></p>
                
                <h3>5. Common Clinical Conditions in Level 4</h3>
                <p><strong>HAGMA + NAGMA</strong></p>
                <p>Typical causes:</p>
                <ul>
                    <li>DKA + severe diarrhea</li>
                    <li>Renal failure + diarrhea</li>
                    <li>Toxic alcohols + delayed presentation</li>
                    <li>Sepsis + ileostomy losses</li>
                </ul>
                <p>Here, HCO3 falls more than expected for the Anion gap rise.</p>
                
                <p><strong>Pure HAGMA</strong></p>
                <p>Typical causes:</p>
                <ul>
                    <li>Early DKA</li>
                    <li>Lactic acidosis</li>
                    <li>Uremia (moderate to severe)</li>
                    <li>Ethylene glycol ingestion (early)</li>
                </ul>
                <p>This is the simplest pattern.</p>
                
                <p><strong>HAGMA + Metabolic Alkalosis</strong></p>
                <p>Typical causes:</p>
                <ul>
                    <li>DKA + vomiting</li>
                    <li>Renal failure + diuretics</li>
                    <li>Lactic acidosis + aggressive bicarbonate loss correction</li>
                    <li>Alcoholic ketoacidosis + vomiting</li>
                </ul>
                <p>Here, bicarbonate is "higher than it should be" despite the acidosis. This is extremely common in real practice.</p>
                
                <h3>6. Pattern Recognition Pearls</h3>
                <ul>
                    <li>If Anion gap is high but HCO3 is not "low enough" ‚Üí metabolic alkalosis is present</li>
                    <li>If HCO3 is "too low" for the Anion gap ‚Üí a normal-gap acidosis is also present</li>
                    <li>In complex shock states, Anion gap and HCO3 behave unpredictably ‚Äî Adjusted HCO3 clarifies the picture</li>
                    <li>In vomiting + DKA, the metabolic alkalosis may mask the severity of the ketoacidosis</li>
                </ul>
                
                <h3>7. Common Mistakes at Level 4</h3>
                <ul>
                    <li>Assuming all HAGMA cases are "pure"</li>
                    <li>Forgetting to check Anion gap before applying Adjusted HCO3</li>
                    <li>Applying Adjusted HCO3 in NAGMA (not appropriate)</li>
                    <li>Misinterpreting a high adjusted HCO3 as "normal" bicarbonate</li>
                    <li>Confusing respiratory compensation with metabolic layering</li>
                </ul>
                
                <h3>8. What Level 4 Prepares You For</h3>
                <p>Level 4 builds the final foundation needed for <strong>Level 5 ‚Äî Delta Ratio & Full Mixed-Disorder Integration.</strong></p>
                <p>Once you can detect high Anion gap acidosis, assess respiratory compensation, and identify hidden metabolic disorders, you are ready to integrate everything into a full differential diagnosis using Delta Ratio.</p>
            `,
            5: `
                <h2>LEVEL 5 ‚Äî DELTA RATIO & FULL MIXED-DISORDER INTEGRATION</h2>
                
                <h3>1. Purpose of Level 5</h3>
                <p>Level 5 teaches the final, advanced tool of ABG interpretation: the Delta Ratio, which compares the rise in the Anion Gap to the fall in bicarbonate.</p>
                
                <p>This is the level for:</p>
                <ul>
                    <li>Multi-layered metabolic acidosis</li>
                    <li>Masked alkalosis</li>
                    <li>Shock physiology</li>
                    <li>ICU-level complexity</li>
                    <li>Toxic ingestions</li>
                    <li>Advanced renal failure</li>
                </ul>
                
                <p>By the end of this level, the learner will be able to:</p>
                <ul>
                    <li>Calculate Delta Ratio</li>
                    <li>Interpret its meaning in 3 distinct zones</li>
                    <li>Detect two or even three metabolic processes at once</li>
                    <li>Integrate all equations across Levels 1‚Äì4</li>
                    <li>Diagnose the full acid‚Äìbase picture, not just pieces</li>
                </ul>
                <p><strong>This is the level where learners become clinically dangerous in a good way.</strong></p>
                
                <h3>2. What You Will Learn</h3>
                <ul>
                    <li>How Anion gap rise and HCO3 fall should correlate</li>
                    <li>How deviations expose additional disorders</li>
                    <li>How to use Delta Ratio to classify metabolic acidosis types</li>
                    <li>How to identify masked metabolic alkalosis</li>
                    <li>How to detect "double or triple" metabolic disorders</li>
                    <li>How to integrate Delta Ratio with Adjusted HCO3 for a full picture</li>
                </ul>
                
                <h3>3. Core Interpretation Skills (Level 5)</h3>
                <ul>
                    <li>Compute Delta Ratio using the final compendium</li>
                    <li>Correlate Anion gap vs HCO3 behavior</li>
                    <li>Distinguish three Delta Ratio zones</li>
                    <li>Combine Winter's Formula + Adjusted HCO3 + Delta Ratio</li>
                    <li>Identify multi-process metabolic disorders</li>
                    <li>Rebuild the entire acid‚Äìbase story from a single ABG</li>
                </ul>
                <p>This level tests deep integration, not memorization.</p>
                
                <h3>4. Relevant Equation for This Level</h3>
                <p><strong>Delta Ratio</strong></p>
                <p>Delta Ratio = (Anion gap ‚àí 12) √∑ (24 ‚àí HCO3)</p>
                
                <p><strong>Interpretation Zones:</strong></p>
                <ul>
                    <li>Delta < 1 ‚Üí HAGMA + NAGMA</li>
                    <li>Delta 1‚Äì2 ‚Üí Pure HAGMA</li>
                    <li>Delta > 2 ‚Üí HAGMA + Metabolic Alkalosis OR Chronic Hypercapnia</li>
                </ul>
                <p><strong>This equation is the key to multi-process detection.</strong></p>
                
                <h3>5. Common Clinical Conditions in Level 5</h3>
                <p><strong>Delta < 1 (HAGMA + NAGMA)</strong></p>
                <p>Causes:</p>
                <ul>
                    <li>DKA + diarrhea</li>
                    <li>Diarrhea + sepsis</li>
                    <li>Renal failure + bicarbonate loss</li>
                    <li>Early toxic alcohol ingestion</li>
                    <li>Sepsis with ileostomy losses</li>
                </ul>
                <p>These patients have severe HCO3 loss beyond what Anion gap explains.</p>
                
                <p><strong>Delta 1‚Äì2 (Pure HAGMA)</strong></p>
                <p>Causes:</p>
                <ul>
                    <li>Classic DKA (no vomiting)</li>
                    <li>Lactic acidosis from shock</li>
                    <li>Alcoholic ketoacidosis (early)</li>
                    <li>Uremic acidosis</li>
                    <li>Toxic alcohols (moderate stage)</li>
                </ul>
                <p>This is the expected biochemical behavior.</p>
                
                <p><strong>Delta > 2 (HAGMA + Metabolic Alkalosis or Chronic Hypercapnia)</strong></p>
                <p>Causes:</p>
                <ul>
                    <li>DKA + vomiting (extremely common)</li>
                    <li>Renal failure + diuretics</li>
                    <li>Metabolic alkalosis masking Anion gap acidosis</li>
                    <li>Severe shock with early respiratory compensation failure</li>
                    <li>Chronic CO2 retainers in acute decompensation</li>
                </ul>
                <p>These are some of the hardest ABG patterns in medicine.</p>
                
                <h3>6. Pattern Recognition Pearls</h3>
                <ul>
                    <li>A very high Anion gap with only mildly low HCO3 ‚Üí metabolic alkalosis is present</li>
                    <li>A moderately elevated Anion gap with severely low HCO3 ‚Üí NAGMA is present</li>
                    <li>If Anion gap is high but Delta Ratio is <1, always think: "Is the patient losing bicarbonate?"</li>
                    <li>If Delta Ratio >2, check for vomiting, diuretics, or chronic CO2 retention</li>
                </ul>
                <p><strong>Delta Ratio converts ABG interpretation from "spot reading" ‚Üí full physiologic storytelling.</strong></p>
                
                <h3>7. Common Mistakes at Level 5</h3>
                <ul>
                    <li>Applying Delta Ratio in normal Anion gap disorders</li>
                    <li>Forgetting to calculate Anion gap before Delta Ratio</li>
                    <li>Using Delta Ratio for respiratory-only disorders</li>
                    <li>Ignoring albumin correction (Anion gap must be correct first)</li>
                    <li>Confusing chronic hypercapnia with metabolic alkalosis</li>
                    <li>Misreading the numerator or denominator during crisis</li>
                </ul>
                
                <h3>8. What Level 5 Prepares You For</h3>
                <p>Level 5 is the final level of the ABG system and prepares the learner for:</p>
                <ul>
                    <li>Real-world ICU cases</li>
                    <li>Shock physiology interpretation</li>
                    <li>Combined metabolic + respiratory disorders</li>
                    <li>Complex DKA with vomiting</li>
                    <li>Toxicology ABGs</li>
                    <li>Multi-step layered acid‚Äìbase disorders</li>
                </ul>
                
                <p>After Level 5, the learner is fully capable of performing the complete acid‚Äìbase differential at bedside using:</p>
                <ul>
                    <li>Primary disorder (Level 1)</li>
                    <li>Anion Gap (Level 2)</li>
                    <li>Winter's Formula (Level 3)</li>
                    <li>Adjusted HCO3 (Level 4)</li>
                    <li>Delta Ratio (Level 5)</li>
                </ul>
                <p><strong>This is the full ABG mastery pathway.</strong></p>
            `
        };

        // Knowledge Module Functions
        function showLevelIntroduction(level) {
            gameState.currentLevel = level;
            
            const levelDescriptions = {
                1: "Basic pH status, primary disorders, and compensation",
                2: "Anion gap calculation and interpretation",
                3: "Winter's formula and respiratory compensation",
                4: "Adjusted bicarbonate and hidden disorders",
                5: "Delta ratio and complex mixed disorders"
            };
            
            document.getElementById('introLevelNum').textContent = level;
            document.getElementById('introLevelDesc').textContent = levelDescriptions[level];
            showScreen('levelIntroScreen');
        }
        
        function showKnowledgeArticle() {
            const level = gameState.currentLevel;
            document.getElementById('knowledgeLevelNum').textContent = level;
            document.getElementById('knowledgeArticleContent').innerHTML = levelKnowledgeArticles[level];
            gameState.knowledgeArticleViewed = true; // Track that user viewed the article
            showScreen('knowledgeArticleScreen');
        }
        
        function backToCaseFromKnowledge() {
            showScreen('levelIntroScreen');
        }
        
        function startCasesDirectly() {
            // Initialize level score if not exists
            if (!gameState.levelScores[gameState.currentLevel]) {
                gameState.levelScores[gameState.currentLevel] = { correct: 0, total: 0 };
            }
            
            // Reset to beginning of this level
            gameState.currentCase = 0;
            gameState.currentQuestion = 0;
            
            saveProgress();
            showLevelProgress();
        }

        // ============================================
        // END OF KNOWLEDGE MODULE SYSTEM
        // ============================================

        // Placement Test State
        let placementTest = {
            questions: [],
            currentQuestion: 0,
            answers: [],
            score: 0
        };

        function showPlacementTest() {
            // Select one representative question from each level
            placementTest.questions = [
                // Level 1 question - Basic pH
                {
                    level: 1,
                    scenario: "A COPD patient arrives confused and somnolent.",
                    abg: { pH: 7.28, PaCO2: 65, HCO3: 30 },
                    question: "What is the primary disorder?",
                    choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"],
                    correct: "A"
                },
                // Level 2 question - Anion Gap
                {
                    level: 2,
                    scenario: "A patient with severe diarrhea for 3 days presents weak.",
                    abg: { pH: 7.32, PaCO2: 34, HCO3: 18, Na: 138, Cl: 110 },
                    question: "Calculate the anion gap: Anion gap = Na ‚àí (Cl + HCO3)",
                    choices: ["6 mEq/L", "10 mEq/L", "14 mEq/L", "18 mEq/L"],
                    correct: "B"
                },
                // Level 3 question - Winter's Formula
                {
                    level: 3,
                    scenario: "A DKA patient arrives tachypneic with fruity breath.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 10 },
                    question: "Calculate expected PaCO2 using Winter's formula: 1.5 √ó HCO3 + 8 ¬± 2",
                    choices: ["15-19 mmHg", "19-23 mmHg", "23-27 mmHg", "27-31 mmHg"],
                    correct: "B"
                },
                // Level 4 question - Adjusted Bicarbonate
                {
                    level: 4,
                    scenario: "A vomiting diabetic patient with DKA arrives dehydrated.",
                    abg: { pH: 7.29, PaCO2: 28, HCO3: 14, Na: 139, Cl: 97 },
                    question: "Calculate adjusted HCO3 = HCO3 + (Anion gap ‚àí 12). First, Anion gap = 139 - (97 + 14) = 28. Then adjusted HCO3 = ?",
                    choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"],
                    correct: "C"
                },
                // Level 5 question - Delta Ratio
                {
                    level: 5,
                    scenario: "A patient with metabolic alkalosis from vomiting develops sepsis.",
                    abg: { pH: 7.41, PaCO2: 30, HCO3: 19, Na: 140, Cl: 97 },
                    question: "Calculate delta ratio = (Anion gap ‚àí 12) √∑ (24 ‚àí HCO3). Anion gap = 140 - (97 + 19) = 24. Delta ratio = ?",
                    choices: ["1.2", "1.8", "2.4", "3.0"],
                    correct: "C"
                }
            ];
            
            placementTest.currentQuestion = 0;
            placementTest.answers = [];
            placementTest.score = 0;
            
            showScreen('placementScreen');
            loadPlacementQuestion();
        }
        
        function loadPlacementQuestion() {
            const q = placementTest.questions[placementTest.currentQuestion];
            const container = document.getElementById('placementQuestionContainer');
            
            const progress = Math.round(((placementTest.currentQuestion) / placementTest.questions.length) * 100);
            
            container.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; font-size: 18px;">üìù Placement Test</h3>
                        <span style="background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold;">
                            Question ${placementTest.currentQuestion + 1}/5
                        </span>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 15px;">
                        <div style="background: white; height: 100%; width: ${progress}%; transition: width 0.3s;"></div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px; font-size: 13px; font-weight: 600;">
                        Level ${q.level} Assessment
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; border-left: 5px solid #667eea;">
                    <h3 style="color: #333; margin: 0 0 15px 0; font-size: 16px; line-height: 1.6;">
                        üìã ${q.scenario}
                    </h3>
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="color: #667eea; font-weight: bold; margin-bottom: 10px; font-size: 15px;">
                            üî¨ ABG Values:
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 14px;">
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>pH:</strong> ${q.abg.pH}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>PaCO2:</strong> ${q.abg.PaCO2}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>HCO3:</strong> ${q.abg.HCO3}
                            </div>
                            ${q.abg.Na ? `
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>Na:</strong> ${q.abg.Na}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>Cl:</strong> ${q.abg.Cl}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <div style="color: #667eea; font-weight: bold; margin-bottom: 15px; font-size: 16px;">
                        ‚ùì Question:
                    </div>
                    <p style="font-size: 16px; font-weight: 600; color: #333; line-height: 1.6; margin: 0;">
                        ${q.question}
                    </p>
                </div>
                
                <div id="placementChoices" style="display: flex; flex-direction: column; gap: 12px;"></div>
            `;
            
            const choicesDiv = document.getElementById('placementChoices');
            q.choices.forEach((choice, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.style.cssText = 'background: white; border: 3px solid #e0e0e0; padding: 18px 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 15px; text-align: left; display: flex; align-items: center; gap: 15px;';
                btn.innerHTML = `
                    <span style="background: #667eea; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; flex-shrink: 0;">${letter}</span>
                    <span style="flex: 1; font-weight: 500; color: #333;">${choice}</span>
                `;
                btn.onmouseover = () => {
                    btn.style.borderColor = '#667eea';
                    btn.style.transform = 'translateX(5px)';
                    btn.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                };
                btn.onmouseout = () => {
                    btn.style.borderColor = '#e0e0e0';
                    btn.style.transform = 'translateX(0)';
                    btn.style.boxShadow = 'none';
                };
                btn.onclick = () => selectPlacementAnswer(letter);
                choicesDiv.appendChild(btn);
            });
        }
        
        function selectPlacementAnswer(answer) {
            const q = placementTest.questions[placementTest.currentQuestion];
            placementTest.answers.push(answer);
            
            if (answer === q.correct) {
                placementTest.score++;
            }
            
            placementTest.currentQuestion++;
            
            if (placementTest.currentQuestion < placementTest.questions.length) {
                loadPlacementQuestion();
            } else {
                showPlacementResults();
            }
        }
        
        function showPlacementResults() {
            const score = placementTest.score;
            const total = placementTest.questions.length;
            const percentage = (score / total) * 100;
            
            let startLevel = 1;
            let message = '';
            let unlockedText = '';
            
            if (percentage >= 80) {
                startLevel = 5;
                message = 'Outstanding! You have mastered all concepts.';
                unlockedText = 'All levels unlocked!';
                for (let i = 1; i <= 5; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 60) {
                startLevel = 4;
                message = 'Excellent! You have strong ABG interpretation skills.';
                unlockedText = 'Levels 1-4 unlocked!';
                for (let i = 1; i <= 4; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 40) {
                startLevel = 3;
                message = 'Good foundation! You understand basic concepts well.';
                unlockedText = 'Levels 1-3 unlocked!';
                for (let i = 1; i <= 3; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 20) {
                startLevel = 2;
                message = 'Decent start! You have basic knowledge.';
                unlockedText = 'Levels 1-2 unlocked!';
                for (let i = 1; i <= 2; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else {
                startLevel = 1;
                message = 'Welcome! Let\'s build your foundation from the ground up.';
                unlockedText = 'Level 1 unlocked!';
                if (!gameState.unlockedLevels.includes(1)) {
                    gameState.unlockedLevels.push(1);
                }
            }
            
            saveProgress();
            
            const container = document.getElementById('placementQuestionContainer');
            container.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s ease;">
                        ${percentage >= 80 ? 'üèÜ' : percentage >= 60 ? 'üåü' : percentage >= 40 ? 'üëç' : percentage >= 20 ? 'üìö' : 'üéØ'}
                    </div>
                    
                    <h2 style="color: #667eea; margin-bottom: 30px; font-size: 28px;">Placement Test Complete!</h2>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 20px; margin-bottom: 30px; color: white; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
                        <div style="font-size: 16px; margin-bottom: 15px; opacity: 0.9;">Your Score</div>
                        <div style="font-size: 64px; font-weight: bold; margin-bottom: 10px;">
                            ${score}/${total}
                        </div>
                        <div style="font-size: 28px; font-weight: 600; margin-bottom: 20px;">
                            ${percentage.toFixed(0)}%
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 4px; border-radius: 2px; margin: 0 auto; max-width: 200px;">
                            <div style="background: white; height: 100%; width: ${percentage}%; border-radius: 2px;"></div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #667eea;">
                        <p style="font-size: 18px; line-height: 1.8; color: #333; margin-bottom: 20px;">
                            ${message}
                        </p>
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="color: #667eea; font-weight: bold; margin-bottom: 15px; font-size: 16px;">
                                ‚úÖ ${unlockedText}
                            </div>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
                                <div style="font-size: 15px; margin-bottom: 8px; opacity: 0.9;">You will start at:</div>
                                <div style="font-size: 42px; font-weight: bold;">
                                    Level ${startLevel}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startLevel(${startLevel})" style="font-size: 20px; padding: 18px 50px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        üöÄ Start Level ${startLevel}
                    </button>
                </div>
                
                <style>
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-20px); }
                    }
                </style>
            `;
        }

        function showLevelSelect() {
            showScreen('levelSelectScreen');
            renderLevelButtons();
        }

        function renderLevelButtons() {
            const container = document.getElementById('levelButtons');
            container.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const isUnlocked = gameState.unlockedLevels.includes(i);
                const score = gameState.levelScores[i] || { correct: 0, total: 0 };
                const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
                
                const btn = document.createElement('div');
                btn.className = `level-btn ${isUnlocked ? 'unlocked' : 'locked'}`;
                btn.innerHTML = `
                    <div>
                        <h3>Level ${i}</h3>
                        <p style="color: #666; margin-top: 5px;">
                            ${getLevelDescription(i)}
                        </p>
                        ${score.total > 0 ? `<p style="color: #4CAF50; margin-top: 5px;">Progress: ${percentage}%</p>` : ''}
                    </div>
                    ${isUnlocked ? '' : '<span class="lock-icon">üîí</span>'}
                `;
                
                if (isUnlocked) {
                    btn.onclick = () => startLevel(i);
                }
                
                container.appendChild(btn);
            }
        }

        function getLevelDescription(level) {
            const descriptions = {
                1: "Basic pH status, primary disorders, compensation",
                2: "Anion gap calculation and interpretation",
                3: "Winter's formula and respiratory compensation",
                4: "Adjusted bicarbonate and hidden disorders",
                5: "Delta ratio and complex mixed disorders"
            };
            return descriptions[level];
        }

        function startLevel(level) {
            // Check if level has cases
            if (allCases[level].length === 0) {
                alert(`Level ${level} is currently under development. Please select Level 1 for now.`);
                return;
            }
            
            // Show level introduction screen with "Learn This Level" option
            showLevelIntroduction(level);
        }

        function showLevelProgress() {
            showScreen('progressScreen');
            updateProgress();
            setTimeout(() => {
                document.getElementById('startCaseNum').textContent = gameState.currentCase + 1;
                showScreen('startCaseScreen');
            }, 1500);
        }

        function startCase() {
            caseAnswers = [];
            gameState.currentQuestion = 0;
            
            console.log('=== Starting Case ===');
            console.log('Level:', gameState.currentLevel);
            console.log('Case:', gameState.currentCase);
            console.log('Total cases in level:', allCases[gameState.currentLevel].length);
            
            showScreen('caseScreen');
            loadCase();
            loadEquations();
            loadQuestion();
        }

        function loadCase() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            document.getElementById('scenarioText').textContent = caseData.scenario;
            document.getElementById('caseNumber').textContent = gameState.currentCase + 1;
            
            // Load ABG values
            const abgHTML = `
                <h3 style="margin-bottom: 15px;">üî¨ Laboratory Values</h3>
                <div class="abg-grid">
                    ${Object.entries(caseData.abg).map(([key, value]) => `
                        <div class="abg-item">
                            <strong>${key}</strong>
                            <span>${value}${getUnit(key)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('abgValues').innerHTML = abgHTML;
        }

        function getUnit(key) {
            const units = {
                'pH': '',
                'PaCO2': ' mmHg',
                'HCO3': ' mEq/L',
                'Na': ' mEq/L',
                'Cl': ' mEq/L',
                'Lactate': ' mmol/L'
            };
            return units[key] || '';
        }

        function loadEquations() {
            const level = gameState.currentLevel;
            let equations = '<div style="line-height: 1.8;"><strong>Normal Ranges:</strong> pH 7.35-7.45 | PaCO2 35-45 | HCO3 22-26</div>';
            
            if (level >= 2) {
                equations += '<h4>Anion Gap</h4><strong>AG = Na ‚àí (Cl + HCO3)</strong><br>Corrected Anion gap = Anion gap + 2.5 √ó (4 ‚àí albumin)<br>Normal: 8-12 mEq/L';
            }
            if (level >= 3) {
                equations += '<h4>Winter\'s Formula</h4><strong>Expected PaCO2 = 1.5 √ó HCO3 + 8 ¬± 2</strong><br>(Use only for metabolic acidosis)';
            }
            if (level >= 3) {
                equations += '<h4>Metabolic Alkalosis Compensation</h4><strong>Expected PaCO2 = 40 + 0.7 √ó (HCO3 ‚àí 24) ¬± 5</strong>';
            }
            if (level >= 4) {
                equations += '<h4>Adjusted HCO3</h4><strong>Adjusted HCO3 = HCO3 + (Anion gap ‚àí 12)</strong><br>Interpretation: <18 (additional NAGMA), 18-30 (pure HAGMA), >30 (concurrent alkalosis)';
            }
            if (level >= 5) {
                equations += '<h4>Delta Ratio</h4><strong>ŒîRatio = (Anion gap ‚àí 12) √∑ (24 ‚àí HCO3)</strong><br>Interpretation: <1 (HAGMA+NAGMA), 1-2 (pure HAGMA), >2 (metabolic alkalosis)';
            }
            
            document.getElementById('equationContent').innerHTML = equations;
        }

        function loadQuestion() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            const question = caseData.questions[gameState.currentQuestion];
            
            document.getElementById('questionNumber').textContent = gameState.currentQuestion + 1;
            document.getElementById('currentQ').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionText').textContent = question.q;
            
            // Load MCQ choices
            const choicesHTML = question.choices.map((choice, index) => {
                const letter = String.fromCharCode(65 + index); // A, B, C, D
                return `
                    <div class="mcq-choice" onclick="selectChoice('${letter}')">
                        <div class="choice-letter">${letter}</div>
                        <div class="choice-text">${choice}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('mcqChoices').innerHTML = choicesHTML;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            gameState.selectedChoice = null;
        }

        function selectChoice(letter) {
            if (gameState.selectedChoice !== null) return; // Already answered
            
            gameState.selectedChoice = letter;
            
            // Highlight selected choice
            const choices = document.querySelectorAll('.mcq-choice');
            choices.forEach((choice, index) => {
                const choiceLetter = String.fromCharCode(65 + index);
                if (choiceLetter === letter) {
                    choice.classList.add('selected');
                }
            });
            
            // Submit answer automatically after selection
            setTimeout(() => submitAnswer(), 300);
        }

        function submitAnswer() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            const question = caseData.questions[gameState.currentQuestion];
            
            const correct = gameState.selectedChoice === question.correct;
            
            // Track this answer for case summary
            caseAnswers.push({
                correct: correct,
                userAnswer: gameState.selectedChoice,
                correctAnswer: question.correct,
                question: question.q
            });
            
            gameState.totalScore.total++;
            
            const feedback = document.getElementById('feedback');
            const choices = document.querySelectorAll('.mcq-choice');
            
            // Disable all choices
            choices.forEach(choice => choice.classList.add('disabled'));
            
            // Mark correct and incorrect
            choices.forEach((choice, index) => {
                const choiceLetter = String.fromCharCode(65 + index);
                if (choiceLetter === question.correct) {
                    choice.classList.add('correct');
                } else if (choiceLetter === gameState.selectedChoice) {
                    choice.classList.add('incorrect');
                }
            });
            
            if (correct) {
                gameState.totalScore.correct++;
                feedback.className = 'feedback feedback-correct';
                feedback.textContent = '‚úì Correct.';
            } else {
                feedback.className = 'feedback feedback-incorrect';
                feedback.textContent = `‚úó Incorrect. The correct answer is: ${question.correct}.`;
                gameState.weaknesses.push(question.category);
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');
            
            updateProgress();
            saveProgress();
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            if (gameState.currentQuestion < caseData.questions.length) {
                loadQuestion();
            } else {
                // Show case summary before moving to next case
                showCaseSummary();
            }
        }

        function showCaseSummary() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            const caseCorrect = caseAnswers.filter(a => a.correct).length;
            const caseTotal = caseAnswers.length;
            const casePercentage = Math.round((caseCorrect / caseTotal) * 100);
            
            // Initialize level score if needed
            if (!gameState.levelScores[gameState.currentLevel]) {
                gameState.levelScores[gameState.currentLevel] = { correct: 0, total: 0 };
            }
            
            gameState.levelScores[gameState.currentLevel].correct += caseCorrect;
            gameState.levelScores[gameState.currentLevel].total += caseTotal;
            
            // Track progress to Google Sheets (if registered)
            if (userData.registered) {
                const knowledgeViewed = gameState.knowledgeArticleViewed || false;
                const timeSpent = 0; // Can track this with timestamps if needed
                trackProgress(
                    gameState.currentLevel,
                    gameState.currentCase + 1,
                    caseCorrect,
                    caseTotal,
                    knowledgeViewed,
                    timeSpent
                );
            }
            
            const summaryHTML = `
                <div class="card">
                    <h2>Case ${gameState.currentCase + 1} Complete</h2>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 48px; font-weight: bold; color: ${casePercentage >= 80 ? '#4CAF50' : '#ff9800'};">
                            ${casePercentage}%
                        </div>
                        <p style="color: #666; margin-top: 10px;">
                            ${caseCorrect} out of ${caseTotal} correct
                        </p>
                    </div>
                    
                    <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3 style="margin-bottom: 15px;">Review:</h3>
                        ${caseAnswers.map((answer, index) => `
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                                <strong>Q${index + 1}:</strong> ${answer.correct ? '‚úì' : '‚úó'}
                                ${!answer.correct ? `<span style="color: #666;"> (Your answer: ${answer.userAnswer}, Correct: ${answer.correctAnswer})</span>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="continueToNextCase()">
                        ${gameState.currentCase < 14 ? 'Continue to Next Case ‚Üí' : 'Complete Level'}
                    </button>
                </div>
            `;
            
            document.getElementById('caseSummaryContent').innerHTML = summaryHTML;
            showScreen('caseSummaryScreen');
            saveProgress();
        }

        function continueToNextCase() {
            gameState.currentCase++;
            
            console.log('=== Continue to Next Case ===');
            console.log('New case number:', gameState.currentCase);
            
            const cases = allCases[gameState.currentLevel];
            console.log('Total cases available:', cases.length);
            
            if (gameState.currentCase < cases.length) {
                // More cases in this level
                console.log('Moving to case', gameState.currentCase + 1);
                document.getElementById('startCaseNum').textContent = gameState.currentCase + 1;
                showScreen('progressScreen');
                updateProgress();
                setTimeout(() => {
                    showScreen('startCaseScreen');
                }, 1500);
            } else {
                // Level complete
                console.log('Level complete!');
                showLevelComplete();
            }
        }

        function showLevelComplete() {
            const score = gameState.levelScores[gameState.currentLevel];
            const percentage = Math.round((score.correct / score.total) * 100);
            const passed = percentage >= 80;
            
            if (passed && !gameState.unlockedLevels.includes(gameState.currentLevel + 1) && gameState.currentLevel < 5) {
                gameState.unlockedLevels.push(gameState.currentLevel + 1);
            }
            
            const completeHTML = `
                <h2 style="text-align: center;">Level ${gameState.currentLevel} Complete!</h2>
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 60px; font-weight: bold; color: ${passed ? '#4CAF50' : '#f44336'};">
                        ${percentage}%
                    </div>
                    <p style="font-size: 20px; color: #666; margin-top: 10px;">
                        ${score.correct} out of ${score.total} correct
                    </p>
                    <p style="font-size: 24px; font-weight: bold; margin-top: 20px; color: ${passed ? '#4CAF50' : '#f44336'};">
                        ${passed ? '‚úì PASSED' : '‚úó FAILED'}
                    </p>
                    <p style="color: #666; margin-top: 10px;">
                        ${passed ? 'You have unlocked the next level!' : 'You need 80% to advance. Try again!'}
                    </p>
                </div>
                
                ${gameState.weaknesses.length > 0 ? `
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3 style="margin-bottom: 10px;">Areas to Review:</h3>
                        <ul style="margin-left: 20px;">
                            ${[...new Set(gameState.weaknesses)].map(w => `<li>${w}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="goHome()" style="flex: 1;">üè† Home</button>
                    ${passed && gameState.currentLevel < 5 ? 
                        `<button class="btn btn-primary" onclick="startLevel(${gameState.currentLevel + 1})" style="flex: 1;">Next Level ‚Üí</button>` :
                        `<button class="btn btn-primary" onclick="startLevel(${gameState.currentLevel})" style="flex: 1;">Retry Level</button>`
                    }
                </div>
            `;
            
            document.getElementById('levelCompleteContent').innerHTML = completeHTML;
            showScreen('levelCompleteScreen');
            saveProgress();
        }

        function updateProgress() {
            document.getElementById('currentLevelDisplay').textContent = gameState.currentLevel;
            
            const score = gameState.levelScores[gameState.currentLevel] || { correct: 0, total: 0 };
            const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
            
            document.getElementById('score').textContent = `${score.correct}/${score.total}`;
            document.getElementById('accuracy').textContent = `${percentage}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}%`;
            
            const passStatus = document.getElementById('passStatus');
            if (percentage >= 80) {
                passStatus.style.color = '#4CAF50';
                passStatus.innerHTML = '<strong>Status</strong><br>PASSING';
            } else {
                passStatus.style.color = '#ff9800';
                passStatus.innerHTML = '<strong>Required</strong><br>80%';
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('abgTutorProgress');
                gameState = {
                    unlockedLevels: [1],
                    currentLevel: 1,
                    currentCase: 0,
                    currentQuestion: 0,
                    levelScores: {},
                    totalScore: { correct: 0, total: 0 },
                    weaknesses: [],
                    selectedChoice: null
                };
                saveProgress();
                alert('Progress reset! Refreshing page...');
                location.reload();
            }
        }
        
        // Debug functions
        function showDebugInfo() {
            const info = `
=== ABG Tutor State ===
Current Level: ${gameState.currentLevel}
Current Case: ${gameState.currentCase} (Display: Case ${gameState.currentCase + 1})
Current Question: ${gameState.currentQuestion}
Unlocked Levels: ${gameState.unlockedLevels.join(', ')}

Cases in Level ${gameState.currentLevel}: ${allCases[gameState.currentLevel].length}

Level Scores:
${Object.entries(gameState.levelScores).map(([level, score]) => 
    `  Level ${level}: ${score.correct}/${score.total} (${Math.round(score.correct/score.total*100)}%)`
).join('\n') || '  None yet'}

Total Score: ${gameState.totalScore.correct}/${gameState.totalScore.total}
            `.trim();
            
            console.log(info);
            alert(info);
        }
        
        function clearAndReload() {
            if (confirm('This will clear all saved progress and reload the page. Continue?')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        // ============================================
        // MASTERY QUIZ & DAILY CHALLENGE SYSTEM
        // ============================================
        
        // Mastery Quiz Cases (First 20 of 100)
        const masteryQuizCases = [
            {
                examID: "EXM_001",
                difficulty: 3,
                scenario: "A 63-year-old woman with long-standing type 2 diabetes is brought from home with increasing shortness of breath over 12 hours. She has Kussmaul-type breathing but remains alert. She reports nausea and polyuria for the past two days. Her vitals: BP 102/64, HR 118, RR 32, Temp 37.4¬∞C. She has poor oral intake and missed her insulin doses. Labs show glucose 510 mg/dL.",
                abg: { pH: 7.25, PaCO2: 22, HCO3: 10, Na: 132, Cl: 92, Lactate: 2.1 },
                questions: [
                    { q: "What is the acid-base status?", choices: ["Primary metabolic acidosis","Primary respiratory acidosis","Mixed alkalosis","Normal"], correct: "A", category: "primary disorder" },
                    { q: "Is the anion gap elevated?", choices: ["Yes","No","Cannot determine","Normal range"], correct: "A", category: "AG" },
                    { q: "What is the likely primary cause?", choices: ["DKA","Renal tubular acidosis","Sepsis-induced lactic acidosis","Toxic alcohol ingestion"], correct: "A", category: "clinical correlation" },
                    { q: "Is respiratory compensation appropriate?", choices: ["Yes","No-over","No-under","Not applicable"], correct: "A", category: "compensation" },
                    { q: "Adjusted HCO3- suggests what?", choices: ["Pure HAGMA","HAGMA + NAGMA","HAGMA + metabolic alkalosis","Respiratory disorder"], correct: "B", category: "adjusted bicarbonate" }
                ]
            },
            {
                examID: "EXM_002",
                difficulty: 5,
                scenario: "A 44-year-old man with chronic alcoholism is brought to the ED confused and vomiting. He has been consuming alcohol heavily for three days and has poor nutritional intake. He appears dehydrated and tachypneic. Vitals: BP 96/58, HR 122, RR 30, Temp 36.9¬∞C. His breath has a fruity odor. BMP shows Na 138, K 3.2, glucose 135 mg/dL.",
                abg: { pH: 7.36, PaCO2: 20, HCO3: 11, Na: 138, Cl: 94, Lactate: 4.8 },
                questions: [
                    { q: "What is the primary disturbance?", choices: ["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Mixed acidosis"], correct: "A", category: "primary" },
                    { q: "Is the Anion gap elevated?", choices: ["Yes","No","Borderline","Cannot calculate"], correct: "A", category: "AG" },
                    { q: "What is the delta ratio most consistent with?", choices: ["Pure HAGMA","HAGMA + metabolic alkalosis","HAGMA + NAGMA","Chronic hypercapnia"], correct: "C", category: "delta ratio" },
                    { q: "Which condition best fits the picture?", choices: ["Alcoholic ketoacidosis","DKA","Lactic acidosis from shock","Ethylene glycol ingestion"], correct: "A", category: "etiology" },
                    { q: "Is the respiratory response excessive?", choices: ["Yes-over","Yes-under","No-appropriate","Not assessed"], correct: "C", category: "compensation" }
                ]
            },
            {
                examID: "EXM_003",
                difficulty: 1,
                scenario: "A 27-year-old anxious woman presents with sudden onset chest tightness and tingling in her fingers after an argument. She is breathing rapidly and feels lightheaded. Vitals: BP 124/80, HR 100, RR 34, Temp 36.8¬∞C. No medical history, physical exam normal.",
                abg: { pH: 7.55, PaCO2: 24, HCO3: 20, Na: 140, Cl: 103, Lactate: 1.2 },
                questions: [
                    { q: "Primary disturbance?", choices: ["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"], correct: "A", category: "primary" },
                    { q: "Is HCO3- appropriate?", choices: ["Yes","High","Low","Not interpretable"], correct: "A", category: "compensation" },
                    { q: "What mechanism is most likely?", choices: ["Hyperventilation","Vomiting","Renal bicarbonate loss","Opioid overdose"], correct: "A", category: "mechanism" },
                    { q: "pH category?", choices: ["Acidemia","Normal","Alkalemia","Mixed"], correct: "C", category: "pH" },
                    { q: "Is this acute or chronic?", choices: ["Acute","Chronic","Mixed","Cannot say"], correct: "A", category: "timing" }
                ]
            },
            {
                examID: "EXM_004",
                difficulty: 4,
                scenario: "A 73-year-old man with severe COPD on home oxygen presents with increased sputum production and dyspnea. He is somnolent but arousable. Vitals: BP 128/76, HR 104, RR 18 shallow, Temp 37.2¬∞C, SpO2 86% on 2 L/min. He was given sedatives at home. CXR shows hyperinflation.",
                abg: { pH: 7.28, PaCO2: 72, HCO3: 32, Na: 140, Cl: 100, Lactate: 1.4 },
                questions: [
                    { q: "Primary disorder?", choices: ["Acute respiratory acidosis","Chronic respiratory acidosis","Acute on chronic resp acidosis","Metabolic acidosis"], correct: "C", category: "primary" },
                    { q: "Is compensation adequate?", choices: ["Too low","Too high","Appropriate for chronic","Appropriate for acute"], correct: "C", category: "compensation" },
                    { q: "Likely trigger?", choices: ["Sedative effect","DKA","Renal failure","Sepsis"], correct: "A", category: "trigger" },
                    { q: "pH interpretation?", choices: ["Severely acidemic","Mildly acidemic","Normal","Alkalemic"], correct: "B", category: "pH" },
                    { q: "HCO3- suggests what?", choices: ["Acute only","Chronic only","Acute on chronic","Respiratory alkalosis"], correct: "C", category: "pattern" }
                ]
            },
            {
                examID: "EXM_005",
                difficulty: 2,
                scenario: "A 48-year-old man with 24 hours of profuse watery diarrhea presents with dizziness and muscle cramps. He appears dehydrated. Vitals: BP 94/60, HR 116, RR 24, Temp 37.1¬∞C. He has poor oral intake and mild abdominal tenderness. No vomiting. No chronic illnesses.",
                abg: { pH: 7.32, PaCO2: 33, HCO3: 17, Na: 136, Cl: 112, Lactate: 1.0 },
                questions: [
                    { q: "Primary disorder?", choices: ["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Mixed disorder"], correct: "A", category: "primary" },
                    { q: "Anion gap status?", choices: ["Normal Anion gap","High Anion gap","Borderline","Not calculable"], correct: "A", category: "AG" },
                    { q: "Likely cause?", choices: ["Bicarbonate loss","Ketone accumulation","Lactic acidosis","Drug ingestion"], correct: "A", category: "cause" },
                    { q: "Compensation appropriate?", choices: ["Yes","Over","Under","Not applicable"], correct: "A", category: "compensation" },
                    { q: "pH category?", choices: ["Acidemia","Normal","Alkalemia","Mixed"], correct: "A", category: "pH" }
                ]
            },
            // Cases 6-10
            {
                examID: "EXM_006",
                difficulty: 5,
                scenario: "A 59-year-old dialysis patient misses his scheduled session and presents confused and dyspneic. He has peripheral edema and crackles on auscultation. Vitals: BP 168/92, HR 112, RR 30, Temp 36.5¬∞C. JVP elevated. His medications include beta blockers and phosphate binders. Serum potassium is 6.0 mmol/L.",
                abg: { pH: 7.18, PaCO2: 48, HCO3: 17, Na: 138, Cl: 98, Lactate: 2.9 },
                questions: [
                    { q: "Primary disturbance?", choices: ["Metabolic acidosis","Respiratory acidosis","Mixed acidosis","Metabolic alkalosis"], correct: "C" },
                    { q: "Anion gap status?", choices: ["High","Normal","Low","Cannot calculate"], correct: "A" },
                    { q: "Delta ratio likely:", choices: ["<1","1‚Äì2",">2","Not applicable"], correct: "A" },
                    { q: "Respiratory component is:", choices: ["Appropriately low","High-resp acidosis","Low-resp alkalosis","Normal"], correct: "B" },
                    { q: "Likely explanation?", choices: ["Uremia + hypoventilation","Pure uremic acidosis","Sepsis","Vomiting"], correct: "A" }
                ]
            },
            {
                examID: "EXM_007",
                difficulty: 3,
                scenario: "A 36-year-old woman presents with severe dyspnea and pleuritic chest pain following recent long-haul travel. She is anxious, tachypneic, and mildly hypoxic. Vitals: BP 118/70, HR 124, RR 34, Temp 37.0¬∞C, SpO2 90% on room air. No past medical history.",
                abg: { pH: 7.49, PaCO2: 26, HCO3: 19, Na: 139, Cl: 103, Lactate: 1.1 },
                questions: [
                    { q: "Primary disturbance?", choices: ["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"], correct: "A" },
                    { q: "Is HCO3- appropriate?", choices: ["Yes","Too high","Too low","Not interpretable"], correct: "A" },
                    { q: "Underlying cause?", choices: ["Pulmonary embolism","Pneumothorax","Panic attack","COPD"], correct: "A" },
                    { q: "pH category?", choices: ["Normal","Acidemia","Alkalemia","Mixed"], correct: "C" },
                    { q: "AG expected?", choices: ["Normal","High","Low","Cannot assess"], correct: "A" }
                ]
            },
            {
                examID: "EXM_008",
                difficulty: 4,
                scenario: "A 68-year-old man with CHF presents with acute orthopnea and pink frothy sputum. He is diaphoretic and restless. Vitals: BP 178/96, HR 130, RR 36, SpO2 84% on room air. Crackles bilaterally. He has been non-compliant with diuretics. He is placed on BiPAP in the ED.",
                abg: { pH: 7.44, PaCO2: 30, HCO3: 20, Na: 140, Cl: 101, Lactate: 2.0 },
                questions: [
                    { q: "Interpret primary disorder.", choices: ["Respiratory alkalosis","Metabolic acidosis","Metabolic alkalosis","Mixed"], correct: "A" },
                    { q: "Compensation appropriate?", choices: ["Yes","Over","Under","Not applicable"], correct: "A" },
                    { q: "Likely explanation?", choices: ["Pulmonary edema","Asthma","COPD flare","Sepsis"], correct: "A" },
                    { q: "HCO3- suggests:", choices: ["Chronic compensation","Acute change","Metabolic alkalosis","Normal only"], correct: "B" },
                    { q: "pH status?", choices: ["Normal","Alkalemia","Acidemia","Mixed"], correct: "B" }
                ]
            },
            {
                examID: "EXM_009",
                difficulty: 2,
                scenario: "A 30-year-old man presents with persistent vomiting for 36 hours due to suspected food poisoning. He appears weak and volume-depleted. Vitals: BP 104/70, HR 108, RR 20. No diarrhea. Mild epigastric tenderness.",
                abg: { pH: 7.50, PaCO2: 46, HCO3: 34, Na: 138, Cl: 88, Lactate: 1.0 },
                questions: [
                    { q: "Primary disorder?", choices: ["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"], correct: "A" },
                    { q: "Compensation appropriate?", choices: ["Yes","Under","Over","Not applicable"], correct: "A" },
                    { q: "Likely cause?", choices: ["Vomiting","Diarrhea","Renal failure","DKA"], correct: "A" },
                    { q: "pH interpretation?", choices: ["Alkalemia","Normal","Acidemia","Mixed"], correct: "A" },
                    { q: "Chloride finding suggests:", choices: ["Volume depletion","Renal failure","Tox","Sepsis"], correct: "A" }
                ]
            },
            {
                examID: "EXM_010",
                difficulty: 5,
                scenario: "A 51-year-old man with septic shock from pneumonia is intubated and mechanically ventilated. Despite fluids and norepinephrine, he remains hypotensive. Vitals: BP 88/52 on pressors, HR 132, RR ventilated, Temp 38.9¬∞C. Urine output is minimal. Rising lactate noted.",
                abg: { pH: 7.21, PaCO2: 38, HCO3: 15, Na: 140, Cl: 102, Lactate: 6.5 },
                questions: [
                    { q: "Primary disorder?", choices: ["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"], correct: "A" },
                    { q: "Anion gap status?", choices: ["High","Normal","Low","Unable to calculate"], correct: "A" },
                    { q: "Delta ratio likely:", choices: ["<1","1‚Äì2",">2","Not applicable"], correct: "A" },
                    { q: "Respiratory compensation?", choices: ["Appropriate","Insufficient","Excessive","Not used here"], correct: "B" },
                    { q: "Most likely etiology?", choices: ["Lactic acidosis from shock","DKA","Toxin ingestion","Chronic renal failure"], correct: "A" }
                ]
            },
            // Cases 11-20
            {
                examID: "EXM_011",
                difficulty: 4,
                scenario: "A 72-year-old woman with severe community-acquired pneumonia is admitted to the ICU with worsening dyspnea. She is on high-flow nasal cannula at 60 L/min, FiO2 0.6. Her RR is 34, accessory muscles active. Vitals: BP 112/70, HR 118, Temp 38.5¬∞C. She has rising lactate and decreasing urine output over the last 4 hours. Cr is 1.9 mg/dL (baseline 1.0).",
                abg: { pH: 7.31, PaCO2: 30, HCO3: 15, Na: 138, Cl: 104, Lactate: 4.1 },
                questions: [
                    { q: "Primary disorder?", choices:["Metabolic acidosis","Respiratory alkalosis","Mixed acidosis","Metabolic alkalosis"], correct:"A" },
                    { q: "Anion gap status?", choices:["High","Normal","Low","Not calculable"], correct:"A" },
                    { q: "Respiratory response?", choices:["Appropriate","Under","Over","Cannot determine"], correct:"C" },
                    { q: "Likely cause?", choices:["Sepsis-induced lactic acidosis","Diarrhea","Vomiting","Toxin ingestion"], correct:"A" },
                    { q: "Delta ratio suggests:", choices:["<1","1‚Äì2",">2","Not applicable"], correct:"A" }
                ]
            },
            {
                examID: "EXM_012",
                difficulty: 2,
                scenario: "A 41-year-old man presents to the ED after 12 hours of intense vomiting from suspected food poisoning. He appears dehydrated and lightheaded. Vitals: BP 102/64, HR 110, RR 18, Temp 37.0¬∞C. Mucous membranes are dry. No history of kidney disease. Cl is notably low at 88 mmol/L.",
                abg: { pH: 7.48, PaCO2: 46, HCO3: 34, Na: 139, Cl: 88, Lactate: 1.2 },
                questions: [
                    { q: "Primary disorder?", choices:["Metabolic alkalosis","Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis"], correct:"A" },
                    { q: "Compensation?", choices:["Appropriate","Under","Over","Not assessable"], correct:"A" },
                    { q: "Likely cause?", choices:["Vomiting","DKA","Renal failure","Sepsis"], correct:"A" },
                    { q: "pH status?", choices:["Alkalemia","Acidemia","Normal","Mixed"], correct:"A" },
                    { q: "Chloride finding suggests:", choices:["Volume depletion","Renal loss","Sepsis","Hyperchloremia"], correct:"A" }
                ]
            },
            {
                examID: "EXM_013",
                difficulty: 5,
                scenario: "A 57-year-old man with a history of chronic kidney disease (Stage 5) arrives confused after missing his last two dialysis sessions. He is volume overloaded with crackles and generalized edema. Vitals: BP 176/102, HR 108, RR 28. Labs: K 6.4 mmol/L, BUN 92 mg/dL, Cr 10.1 mg/dL. He is becoming progressively drowsy in the ED.",
                abg: { pH: 7.15, PaCO2: 38, HCO3: 12, Na: 138, Cl: 100, Lactate: 2.2 },
                questions: [
                    { q: "Primary disorder?", choices:["Metabolic acidosis","Respiratory acidosis","Mixed disorder","Metabolic alkalosis"], correct:"A" },
                    { q: "Anion gap status?", choices:["High","Normal","Low","Not calculable"], correct:"A" },
                    { q: "Respiratory component?", choices:["Appropriate","Under","Over","Not interpretable"], correct:"B" },
                    { q: "Most likely etiology?", choices:["Uremic acidosis","Lactic acidosis","Toxin ingestion","DKA"], correct:"A" },
                    { q: "Adjusted HCO3- suggests?", choices:["Coexisting NAGMA","Pure HAGMA","Metabolic alkalosis","Respiratory alkalosis"], correct:"A" }
                ]
            },
            {
                examID: "EXM_014",
                difficulty: 1,
                scenario: "A 29-year-old man arrives with tingling around his mouth and hands after a stressful flight. He reports rapid breathing and fear of dying. Vitals: BP 130/76, HR 102, RR 38, Temp 36.7¬∞C. Exam otherwise normal. No medical history. Symptoms improve when he slows his breathing.",
                abg: { pH: 7.53, PaCO2: 25, HCO3: 21, Na: 140, Cl: 102, Lactate: 1.0 },
                questions: [
                    { q:"Primary disturbance?", choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"], correct:"A" },
                    { q:"Compensation?", choices:["Appropriate","Under","Over","Not applicable"], correct:"A" },
                    { q:"Likely mechanism?", choices:["Hyperventilation","Vomiting","Renal failure","Opioids"], correct:"A" },
                    { q:"pH category?", choices:["Alkalemia","Acidemia","Normal","Mixed"], correct:"A" },
                    { q:"Is it acute or chronic?", choices:["Acute","Chronic","Mixed","Not clear"], correct:"A" }
                ]
            },
            {
                examID: "EXM_015",
                difficulty: 3,
                scenario: "A 46-year-old woman with type 1 diabetes presents with abdominal pain and nausea for 24 hours. She appears dehydrated, with tachypnea and fruity breath odor. Vitals: BP 108/66, HR 124, RR 30, Temp 37.8¬∞C. Labs: glucose 460 mg/dL, K 4.8 mmol/L, Na 130, BUN 24, Cr 1.4.",
                abg: { pH: 7.27, PaCO2: 23, HCO3: 10, Na: 130, Cl: 94, Lactate: 2.3 },
                questions: [
                    { q: "Primary disorder?", choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"], correct:"A" },
                    { q: "Anion gap status?", choices:["High","Normal","Low","Not calculable"], correct:"A" },
                    { q: "Likely cause?", choices:["DKA","Uremia","Lactic acidosis","Methanol"], correct:"A" },
                    { q: "Compensation?", choices:["Appropriate","Under","Over","Not applicable"], correct:"A" },
                    { q: "Adjusted HCO3- suggests:", choices:["HAGMA + NAGMA","Pure HAGMA","HAGMA + metabolic alkalosis","Respiratory alkalosis"], correct:"B" }
                ]
            },
            {
                examID: "EXM_016",
                difficulty: 4,
                scenario: "A 62-year-old man on chronic opioid therapy presents with somnolence. His wife found him difficult to arouse. Vitals: BP 134/78, HR 92, RR 8 shallow, SpO2 88% on room air. Pupils are pinpoint. He responds minimally to painful stimuli. Lungs are clear. No fever.",
                abg: { pH: 7.22, PaCO2: 66, HCO3: 27, Na: 139, Cl: 103, Lactate: 1.3 },
                questions: [
                    { q:"Primary disorder?", choices:["Acute respiratory acidosis","Chronic respiratory acidosis","Metabolic acidosis","Mixed"], correct:"A" },
                    { q:"HCO3- suggests:", choices:["Chronic retention","Acute retention","Metabolic cause","Normal only"], correct:"B" },
                    { q:"Etiology?", choices:["Opioid-induced hypoventilation","COPD","Asthma","Neuromuscular failure"], correct:"A" },
                    { q:"pH category?", choices:["Acidemia","Normal","Alkalemia","Mixed"], correct:"A" },
                    { q:"Is compensation present?", choices:["Not yet","Fully present","Overcompensated","Metabolic alkalosis"], correct:"A" }
                ]
            },
            {
                examID: "EXM_017",
                difficulty: 5,
                scenario: "A 50-year-old woman in the OR for emergent bowel resection becomes hypotensive and requires vasopressors. She has received large volumes of crystalloid. Vitals: BP 84/50 on norepinephrine, HR 128, RR ventilated. Urine output is minimal. Surgeon reports ischemic bowel. Lactate is rising rapidly.",
                abg: { pH: 7.19, PaCO2: 34, HCO3: 13, Na: 138, Cl: 110, Lactate: 7.8 },
                questions: [
                    { q:"Primary disorder?", choices:["Metabolic acidosis","Respiratory acidosis","Mixed","Respiratory alkalosis"], correct:"A" },
                    { q:"Anion gap status?", choices:["High","Normal","Low","Not calculable"], correct:"A" },
                    { q:"Delta ratio?", choices:["<1","1‚Äì2",">2","Cannot determine"], correct:"A" },
                    { q:"Etiology?", choices:["Lactic acidosis from bowel ischemia","Renal failure","DKA","Sedation"], correct:"A" },
                    { q:"Respiratory compensation?", choices:["Appropriate","Under","Over","Not applicable"], correct:"B" }
                ]
            },
            {
                examID: "EXM_018",
                difficulty: 2,
                scenario: "A 65-year-old woman with COPD presents with a productive cough and wheezing. She is mildly dyspneic but speaking full sentences. Vitals: BP 138/84, HR 96, RR 20, SpO2 92% on 2 L/min. She has no fever. She reports her inhaler ran out yesterday.",
                abg: { pH: 7.37, PaCO2: 50, HCO3: 28, Na: 139, Cl: 100, Lactate: 1.0 },
                questions: [
                    { q:"Primary process?", choices:["Chronic respiratory acidosis","Acute respiratory acidosis","Metabolic acidosis","Metabolic alkalosis"], correct:"A" },
                    { q:"HCO3- reflects:", choices:["Chronic adaptation","Acute change","No adaptation","Metabolic alkalosis"], correct:"A" },
                    { q:"pH interpretation?", choices:["Normal","Acidemia","Alkalemia","Mixed"], correct:"A" },
                    { q:"Does she have acute worsening?", choices:["No","Yes","Indeterminate","Impossible to assess"], correct:"A" },
                    { q:"Likely cause?", choices:["Inhaler non-adherence","Sepsis","Pneumothorax","Heart failure"], correct:"A" }
                ]
            },
            {
                examID: "EXM_019",
                difficulty: 3,
                scenario: "A 38-year-old woman with persistent diarrhea for three days presents with fatigue, dizziness, and muscle cramps. Vitals: BP 100/60, HR 118, RR 22. She has dry mucous membranes and reduced skin turgor. No vomiting. Labs: K 3.0 mmol/L.",
                abg: { pH: 7.30, PaCO2: 32, HCO3: 16, Na: 136, Cl: 112, Lactate: 1.1 },
                questions: [
                    { q:"Primary disorder?", choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Mixed"], correct:"A" },
                    { q:"Anion gap status?", choices:["Normal","High","Low","Not calculable"], correct:"A" },
                    { q:"Likely physiological cause?", choices:["Bicarbonate loss","Ketone buildup","Lactate accumulation","Resp failure"], correct:"A" },
                    { q:"Compensation?", choices:["Appropriate","Under","Over","Not applicable"], correct:"A" },
                    { q:"Chloride finding suggests:", choices:["Hyperchloremic acidosis","Hypochloremia","Renal failure","Metabolic alkalosis"], correct:"A" }
                ]
            },
            {
                examID: "EXM_020",
                difficulty: 4,
                scenario: "A 58-year-old man with severe asthma is brought to the ED in respiratory distress. He is using accessory muscles, unable to speak full sentences. After initial bronchodilators, his work of breathing increases. Vitals: BP 150/88, HR 128, RR 36, SpO2 88% on oxygen. He appears exhausted.",
                abg: { pH: 7.28, PaCO2: 58, HCO3: 26, Na: 140, Cl: 100, Lactate: 1.3 },
                questions: [
                    { q:"Primary disturbance?", choices:["Acute respiratory acidosis","Chronic respiratory acidosis","Metabolic acidosis","Mixed"], correct:"A" },
                    { q:"pH category?", choices:["Acidemia","Normal","Alkalemia","Mixed"], correct:"A" },
                    { q:"Interpret HCO3-:", choices:["No chronic compensation","Suggests chronic process","Suggests metabolic alkalosis","Normal only"], correct:"A" },
                    { q:"Likely cause?", choices:["Impending respiratory failure","Overventilation","Renal failure","Toxin"], correct:"A" },
                    { q:"Next logical concern?", choices:["Imminent need for intubation","Stop bronchodilators","Expect rapid improvement","Metabolic alkalosis workup"], correct:"A" }
                ]
            },
            // Cases 21-40
            {examID:"EXM_021",difficulty:4,scenario:"A 70-year-old man with a history of ischemic cardiomyopathy presents with acute shortness of breath. He reports missing his diuretics for 3 days. He has severe orthopnea, cold extremities, and pink frothy sputum. Vitals: BP 182/98, HR 124, RR 34, SpO2 83% on room air. He is placed on BiPAP. CXR shows pulmonary edema.",abg:{pH:7.47,PaCO2:28,HCO3:20,Na:138,Cl:102,Lactate:2.4},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Metabolic acidosis","Respiratory acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Likely cause?",choices:["Acute pulmonary edema","Sepsis","Asthma attack","DKA"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"HCO3- finding suggests:",choices:["Acute process","Chronic process","Metabolic alkalosis","No compensation"],correct:"A"}]},
            {examID:"EXM_022",difficulty:2,scenario:"A 33-year-old man presents with abdominal pain and 24 hours of repeated vomiting. He appears pale and dehydrated. Vitals: BP 106/68, HR 110, RR 20. He has no comorbidities. Chemistry panel shows chloride 89 mmol/L and mild hypokalemia. No diarrhea. No fever.",abg:{pH:7.49,PaCO2:47,HCO3:34,Na:139,Cl:89,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Most likely cause?",choices:["Vomiting","Diarrhea","Renal failure","DKA"],correct:"A"},{q:"pH interpretation?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Chloride finding suggests:",choices:["Volume depletion","Hyperchloremia","Renal retention","Metabolic acidosis"],correct:"A"}]},
            {examID:"EXM_023",difficulty:5,scenario:"A 54-year-old woman is brought to the ED with confusion after ingesting an unknown industrial solvent. Her breath smells sweet, she is tachypneic, and she vomited once. Vitals: BP 110/68, HR 120, RR 36, Temp 36.6¬∞C. Her osmolar gap is elevated. Glucose is 140 mg/dL. She becomes increasingly lethargic.",abg:{pH:7.12,PaCO2:24,HCO3:8,Na:140,Cl:102,Lactate:3.0},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Cannot calculate"],correct:"A"},{q:"Likely cause?",choices:["Toxic alcohol ingestion","DKA","Uremia","Lactic acidosis only"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot determine"],correct:"B"}]},
            {examID:"EXM_024",difficulty:3,scenario:"A 66-year-old man with known COPD arrives with worsening dyspnea and productive cough for 3 days. He has a low-grade fever and wheezing. Vitals: BP 140/82, HR 104, RR 20 shallow, SpO2 90% on 2 L/min. He is alert but fatigued. He has long-standing hypercapnia.",abg:{pH:7.33,PaCO2:64,HCO3:34,Na:138,Cl:100,Lactate:1.4},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Chronic respiratory acidosis","Mixed disorder"],correct:"A"},{q:"HCO3- indicates:",choices:["Chronic compensation","Acute retention","Metabolic acidosis","No compensation"],correct:"A"},{q:"pH category?",choices:["Mild acidemia","Severe acidemia","Normal","Alkalemia"],correct:"A"},{q:"Likely trigger?",choices:["Infection","Trauma","Renal failure","Panic attack"],correct:"A"},{q:"Respiratory status?",choices:["Acute worsening on chronic","Stable chronic","Overventilating","Abnormal alkalosis"],correct:"A"}]},
            {examID:"EXM_025",difficulty:1,scenario:"A 21-year-old college student comes complaining of sudden shortness of breath and tingling around her mouth after seeing blood during a lab session. She is visibly anxious and hyperventilating. Vitals: BP 128/76, HR 110, RR 40, Temp 36.8¬∞C. Physical exam normal.",abg:{pH:7.57,PaCO2:22,HCO3:19,Na:140,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Renal failure","Vomiting","Toxin"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Is chronic compensation expected?",choices:["No","Yes","Mixed","Cannot say"],correct:"A"}]},
            {examID:"EXM_026",difficulty:5,scenario:"A 58-year-old woman in septic shock from a perforated viscus remains hypotensive despite aggressive resuscitation and norepinephrine. She is intubated and mechanically ventilated. Urine output is nearly zero. Rapid point-of-care lactate shows 8.9 mmol/L. BUN is 54, creatinine 3.6 mg/dL. The abdomen is rigid.",abg:{pH:7.09,PaCO2:40,HCO3:11,Na:138,Cl:104,Lactate:8.9},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot determine"],correct:"A"},{q:"Cause?",choices:["Severe lactic acidosis","Vomiting","Diarrhea","Renal tubular acidosis"],correct:"A"},{q:"Respiratory compensation?",choices:["Inadequate","Appropriate","Excessive","Not applicable"],correct:"A"}]},
            {examID:"EXM_027",difficulty:2,scenario:"A 45-year-old man comes with 2 days of watery diarrhea. He feels weak and dizzy. Vitals: BP 98/60, HR 116, RR 22. He has no vomiting and has lost significant fluid volume. Labs show chloride 114 mmol/L and mild metabolic acidosis.",abg:{pH:7.33,PaCO2:30,HCO3:15,Na:135,Cl:114,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Mixed"],correct:"A"},{q:"Anion gap status?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Bicarbonate loss","Ketones","Lactate","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride elevation suggests:",choices:["Hyperchloremic acidosis","Hypochloremia","Metabolic alkalosis","Renal retention"],correct:"A"}]},
            {examID:"EXM_028",difficulty:3,scenario:"A 67-year-old man with CHF on high-dose furosemide presents with weakness and palpitations. He reports poor oral intake. Vitals: BP 140/86, HR 98 irregularly irregular, RR 20. He appears volume depleted. Potassium is 2.9 mmol/L. ECG shows PACs and PVCs.",abg:{pH:7.51,PaCO2:48,HCO3:37,Na:140,Cl:86,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Likely cause?",choices:["Diuretic overuse","DKA","Renal failure","Lactic acidosis"],correct:"A"},{q:"pH status?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Chloride indicates:",choices:["Depletion alkalosis","Hyperchloremia","Renal acidosis","Toxin"],correct:"A"}]},
            {examID:"EXM_029",difficulty:1,scenario:"A 26-year-old man presents after running up several flights of stairs, feeling dizzy and breathing rapidly. He denies anxiety but is clearly hyperventilating. Vitals: BP 126/70, HR 118, RR 38. No medical history. No pain. No fever.",abg:{pH:7.51,PaCO2:28,HCO3:22,Na:139,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Sepsis","Vomiting","Renal failure"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Chronic adaptation?",choices:["No","Yes","Mixed","Cannot assess"],correct:"A"}]},
            {examID:"EXM_030",difficulty:5,scenario:"A 49-year-old man is found unresponsive at home next to an empty bottle of antifreeze. EMS notes deep rapid breathing and tachycardia. Vitals: BP 98/56, HR 128, RR 38, Temp 36.2¬∞C. He has flank tenderness. Labs show calcium oxalate crystals and an osmolar gap.",abg:{pH:7.08,PaCO2:18,HCO3:5,Na:140,Cl:100,Lactate:3.5},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Main etiology?",choices:["Ethylene glycol poisoning","DKA","Lactic acidosis","Uremia"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot determine"],correct:"B"}]},
            {examID:"EXM_031",difficulty:2,scenario:"A 52-year-old woman presents with nausea and diffuse weakness after three days of poor oral intake due to influenza. She reports lightheadedness when standing. Vitals: BP 96/64, HR 112, RR 20, Temp 38.1¬∞C. She has dry mucous membranes. No vomiting today, but she vomited multiple times on day 1. She has mild tachypnea.",abg:{pH:7.36,PaCO2:30,HCO3:17,Na:137,Cl:109,Lactate:1.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis"],correct:"A"},{q:"Anion gap status?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Bicarbonate loss","Ketosis","Lactic acidosis only","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH category?",choices:["Normal","Acidemia","Alkalemia","Mixed"],correct:"A"}]},
            {examID:"EXM_032",difficulty:4,scenario:"A 64-year-old man with severe emphysema presents with increased work of breathing. He has had a mild fever and worsening cough for 4 days. He uses accessory muscles and cannot finish full sentences. Vitals: BP 142/84, HR 116, RR 26 shallow, SpO2 86% on 2 L/min. He has long-standing CO2 retention.",abg:{pH:7.29,PaCO2:70,HCO3:33,Na:139,Cl:100,Lactate:1.3},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Chronic respiratory acidosis","Mixed disorder"],correct:"A"},{q:"HCO3- suggests:",choices:["Chronic adaptation","Acute only","Metabolic acidosis","No compensation"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Likely trigger?",choices:["Infective exacerbation","Panic attack","Renal failure","Hyperventilation"],correct:"A"},{q:"CO2 status?",choices:["Acute rise on chronic base","Pure chronic rise","Overventilation","Normal"],correct:"A"}]},
            {examID:"EXM_033",difficulty:5,scenario:"A 48-year-old man with known alcoholic liver disease presents confused and vomiting dark fluid. He is tachycardic and breathing rapidly. Vitals: BP 102/64, HR 130, RR 32, Temp 36.9¬∞C. Labs: glucose 92 mg/dL, Na 133, K 3.1, BUN 28, Cr 1.6. He drank heavily the last 48 hours with minimal food intake.",abg:{pH:7.35,PaCO2:23,HCO3:12,Na:133,Cl:92,Lactate:5.1},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Delta ratio suggests:",choices:["<1","1‚Äì2",">2","Not applicable"],correct:"C"},{q:"Most likely cause?",choices:["Alcoholic ketoacidosis + lactic acidosis","DKA","Sepsis alone","Toxin"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_034",difficulty:3,scenario:"A 57-year-old woman with chronic diarrhea from ulcerative colitis flare presents with generalized weakness. Vitals: BP 100/58, HR 114, RR 22, Temp 37.5¬∞C. Labs: Na 135, K 3.0, Cl 114. She reports 8 watery stools per day for the past 48 hours. No vomiting.",abg:{pH:7.31,PaCO2:30,HCO3:15,Na:135,Cl:114,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Mixed"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Ketones","Lactate","Uremia"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride finding?",choices:["Hyperchloremic acidosis","Hypochloremia","Renal failure","Metabolic alkalosis"],correct:"A"}]},
            {examID:"EXM_035",difficulty:1,scenario:"A 32-year-old man presents after a panic attack triggered by an argument. He is breathing rapidly, shaking, and reports tingling in his fingertips. Vitals: BP 120/70, HR 108, RR 40. He denies chest pain or fever. Symptoms improve with coached breathing.",abg:{pH:7.55,PaCO2:25,HCO3:21,Na:140,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Sepsis","Vomiting","Renal failure"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_036",difficulty:5,scenario:"A 71-year-old man in the ICU after major abdominal surgery becomes suddenly hypotensive with rising lactate. He is intubated and mechanically ventilated. Vitals: BP 84/50 on norepinephrine, HR 128, Temp 38.6¬∞C. Urine output has decreased in the past 3 hours. BUN is 48 mg/dL, Cr 2.8 mg/dL.",abg:{pH:7.17,PaCO2:36,HCO3:13,Na:138,Cl:104,Lactate:6.9},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Not applicable"],correct:"A"},{q:"Cause?",choices:["Septic shock + lactic acidosis","Vomiting","Renal tubular acidosis","Asthma"],correct:"A"},{q:"Resp compensation?",choices:["Inadequate","Appropriate","Excessive","Not applicable"],correct:"A"}]},
            {examID:"EXM_037",difficulty:3,scenario:"A 47-year-old man with poorly controlled diabetes presents with 2 days of vomiting and abdominal pain. He is dehydrated and tachycardic. Vitals: BP 110/70, HR 122, RR 28, Temp 37.8¬∞C. Labs: glucose 398 mg/dL, Na 131, K 4.7, BUN 22, Cr 1.3.",abg:{pH:7.29,PaCO2:25,HCO3:12,Na:131,Cl:92,Lactate:2.9},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["DKA","Uremia","Toxin ingestion","Lactic acidosis only"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","HAGMA + NAGMA","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"}]},
            {examID:"EXM_038",difficulty:4,scenario:"A 74-year-old woman presents with confusion, tremors, and slurred speech. She has a history of long-standing COPD and heart failure. Vitals: BP 138/84, HR 98, RR 14 shallow, SpO2 88% on 2 L/min. She recently increased her dose of benzodiazepines for insomnia.",abg:{pH:7.30,PaCO2:62,HCO3:29,Na:140,Cl:102,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Acute on chronic resp acidosis","Metabolic acidosis","Respiratory alkalosis","Mixed disorder"],correct:"A"},{q:"Cause?",choices:["Sedative-induced hypoventilation","Sepsis","Renal failure","Vomiting"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"HCO3- finding?",choices:["Chronic adaptation","Acute only","Metabolic alkalosis","Normal"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Metabolic alkalosis","Lactic shock","DKA"],correct:"A"}]},
            {examID:"EXM_039",difficulty:2,scenario:"A 59-year-old man comes with two days of severe diarrhea from a gastrointestinal infection. He has dizziness, muscle cramps, and appears dehydrated. Vitals: BP 96/60, HR 118, RR 22. Labs: Na 134, Cl 112, K 3.1.",abg:{pH:7.34,PaCO2:31,HCO3:16,Na:134,Cl:112,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Mixed"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Ketosis","Lactic acidosis","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride finding?",choices:["Hyperchloremic acidosis","Hypochloremia","Metabolic alkalosis","Renal issue"],correct:"A"}]},
            {examID:"EXM_040",difficulty:5,scenario:"A 62-year-old dialysis patient is brought in confused after missing several sessions. He is tachypneic with deep Kussmaul-like respirations. Vitals: BP 150/96, HR 112, RR 32, Temp 36.8¬∞C. Labs: BUN 108 mg/dL, Cr 12.2 mg/dL, K 6.2 mmol/L. He is severely volume overloaded.",abg:{pH:7.18,PaCO2:28,HCO3:10,Na:138,Cl:100,Lactate:2.5},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Not applicable"],correct:"B"},{q:"Most likely cause?",choices:["Severe uremia","DKA","Sepsis","Ethylene glycol"],correct:"A"},{q:"Respiratory compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            // Cases 41-60
            {examID:"EXM_041",difficulty:3,scenario:"A 58-year-old man with uncontrolled type 2 diabetes presents with profound weakness and polyuria for 3 days. He has not been taking insulin. Vitals: BP 118/72, HR 110, RR 26, Temp 37.2¬∞C. He is dehydrated, has dry mucosa, and mild abdominal tenderness. Glucose is 560 mg/dL. BUN 34, Cr 1.8. Potassium 5.1.",abg:{pH:7.28,PaCO2:27,HCO3:12,Na:132,Cl:90,Lactate:2.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely etiology?",choices:["DKA","Uremia","Toxin ingestion","Diarrhea"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","HAGMA + NAGMA","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"}]},
            {examID:"EXM_042",difficulty:1,scenario:"A 23-year-old woman presents with dizziness and tingling in her hands after a stressful argument. She is breathing rapidly and appears anxious but otherwise healthy. Vitals: BP 124/74, HR 102, RR 38, Temp 36.9¬∞C. She denies chest pain or fever.",abg:{pH:7.53,PaCO2:26,HCO3:22,Na:139,Cl:103,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Renal failure","Salicylate toxicity","Vomiting"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_043",difficulty:4,scenario:"A 70-year-old woman with CHF and CKD presents with progressive shortness of breath. She has orthopnea and mild peripheral edema. Vitals: BP 168/92, HR 112, RR 30, SpO2 85% on room air. She is placed on noninvasive ventilation. Labs: BUN 48, Cr 3.4. She has crackles to mid-lung.",abg:{pH:7.44,PaCO2:30,HCO3:20,Na:137,Cl:102,Lactate:2.8},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Likely cause?",choices:["Pulmonary edema with tachypnea","Asthma","Panic attack","Renal tubular acidosis"],correct:"A"},{q:"pH category?",choices:["Normal‚Äìlow alkalemia","Severe alkalemia","Acidemia","Mixed"],correct:"A"},{q:"HCO3- status?",choices:["Compensatory lowering","Chronic deficit","Renal alkalosis","Unrelated"],correct:"A"}]},
            {examID:"EXM_044",difficulty:5,scenario:"A 55-year-old alcoholic man is found confused with abdominal pain, vomiting, and tachypnea. He has not eaten for 2 days. Vitals: BP 108/70, HR 128, RR 34, Temp 37.1¬∞C. Chemistry: Na 131, K 3.3, Cl 88, BUN 22, Cr 1.4, glucose 92 mg/dL. Ketones strongly positive. Lactate 4.2.",abg:{pH:7.20,PaCO2:24,HCO3:10,Na:131,Cl:88,Lactate:4.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Alcoholic ketoacidosis","Hyperchloremic acidosis","DKA","Ethylene glycol poisoning"],correct:"A"},{q:"Delta ratio?",choices:[">2","1‚Äì2","<1","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_045",difficulty:3,scenario:"A 67-year-old woman presents with persistent vomiting due to gastric outlet obstruction. She is dehydrated, weak, and dizzy. Vitals: BP 98/62, HR 110, RR 18. Labs: Na 140, K 3.0, Cl 84. BUN 28, Cr 1.0. She has dry mucosa and postural hypotension.",abg:{pH:7.52,PaCO2:48,HCO3:39,Na:140,Cl:84,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride finding suggests:",choices:["Hypochloremic alkalosis","Hyperchloremia","NAGMA","DKA"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Likely cause?",choices:["Vomiting/NG losses","Diarrhea","Renal ischemia","Sepsis"],correct:"A"}]},
            {examID:"EXM_046",difficulty:2,scenario:"A 45-year-old man presents with severe diarrhea from a viral gastroenteritis outbreak. He has muscle cramps and dizziness. Vitals: BP 102/66, HR 118, RR 24. Labs: Na 135, K 3.2, Cl 110. He denies vomiting or abdominal trauma.",abg:{pH:7.33,PaCO2:29,HCO3:15,Na:135,Cl:110,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Ketosis","Lactic acidosis","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride?",choices:["Hyperchloremic pattern","Hypochloremia","Renal pathology","Mixed alkalosis"],correct:"A"}]},
            {examID:"EXM_047",difficulty:4,scenario:"A 73-year-old man with advanced COPD presents with drowsiness and a productive cough. He has been using home oxygen at higher flow rates the last two days. Vitals: BP 138/82, HR 100, RR 14 shallow, SpO2 92% on 4 L/min. He is lethargic and mildly confused.",abg:{pH:7.28,PaCO2:76,HCO3:35,Na:140,Cl:100,Lactate:1.5},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Chronic respiratory acidosis","Mixed"],correct:"A"},{q:"Cause?",choices:["Excess O2 ‚Üí CO2 retention","Pulmonary embolism","Hyperventilation","Sepsis"],correct:"A"},{q:"pH?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"HCO3- suggests:",choices:["Chronic adaptation","Acute only","Primary metabolic issue","Overcompensation"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Lactic shock","DKA","Alkalosis"],correct:"A"}]},
            {examID:"EXM_048",difficulty:5,scenario:"A 50-year-old man with type 1 diabetes is brought in with Kussmaul respirations and severe abdominal pain. He is dehydrated, tachycardic, and confused. Vitals: BP 90/58, HR 132, RR 32, Temp 38.0¬∞C. Glucose 680 mg/dL. K 6.0. BUN 38, Cr 2.0. Lactate 3.9.",abg:{pH:7.05,PaCO2:20,HCO3:5,Na:130,Cl:94,Lactate:3.9},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Severe DKA","Diarrhea","Vomiting","Renal tubular acidosis"],correct:"A"},{q:"Delta ratio?",choices:["1‚Äì2","<1",">2","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_049",difficulty:3,scenario:"A 61-year-old woman with chronic renal insufficiency presents with weakness and metallic taste in her mouth. She has decreased urine output for the last 24 hours. Vitals: BP 138/84, HR 104, RR 24. Labs: BUN 62 mg/dL, Cr 4.8 mg/dL, K 5.3.",abg:{pH:7.27,PaCO2:29,HCO3:13,Na:138,Cl:103,Lactate:1.8},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Uremia","DKA","Toxins","Diarrhea"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","HAGMA + NAGMA","Metabolic alkalosis","No mixed disorder"],correct:"A"}]},
            {examID:"EXM_050",difficulty:4,scenario:"A 68-year-old woman develops postoperative hypoventilation after receiving high doses of opioids for pain control. She is somnolent, shallow breathing, and difficult to arouse. Vitals: BP 110/66, HR 92, RR 8, SpO2 90% on 3 L/min. No fever. Normal lung exam.",abg:{pH:7.24,PaCO2:68,HCO3:28,Na:140,Cl:104,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Respiratory acidosis","Respiratory alkalosis","Metabolic acidosis","Metabolic alkalosis"],correct:"A"},{q:"HCO3- suggests:",choices:["Partial metabolic compensation","Chronic process","No compensation","Metabolic alkalosis"],correct:"A"},{q:"Cause?",choices:["Opioid-induced hypoventilation","Sepsis","Asthma","DKA"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Ventilatory status?",choices:["Severely hypoventilating","Hyperventilating","Normal","Erratic"],correct:"A"}]},
            {examID:"EXM_051",difficulty:3,scenario:"A 63-year-old man with long-standing hypertension and CKD presents with increasing lethargy and nausea for 3 days. He has decreased urine output and signs of volume overload. Vitals: BP 156/92, HR 96, RR 24. Labs: BUN 72 mg/dL, Cr 5.6 mg/dL, K 5.8. He is mildly tachypneic with bibasilar crackles.",abg:{pH:7.30,PaCO2:31,HCO3:15,Na:138,Cl:102,Lactate:1.8},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Uremia","DKA","Diarrhea","Toxin ingestion"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3- suggests:",choices:["Pure HAGMA","Mixed acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"}]},
            {examID:"EXM_052",difficulty:1,scenario:"A 29-year-old woman presents with trembling, chest tightness, and shortness of breath after receiving stressful news. She is tearful and has rapid shallow breathing. Vitals: BP 122/68, HR 108, RR 36. No fever or pain. She has perioral tingling.",abg:{pH:7.55,PaCO2:23,HCO3:20,Na:140,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Acute hyperventilation","Renal disease","Sepsis","Vomiting"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Likely timing?",choices:["Acute","Chronic","Mixed","Unclear"],correct:"A"}]},
            {examID:"EXM_053",difficulty:5,scenario:"A 56-year-old alcoholic man presents unconscious with shallow breathing and hypothermia. EMS reports he was found in a garage with multiple empty antifreeze containers. Vitals: BP 94/60, HR 118, RR 10, Temp 35.2¬∞C. Labs show CaOx crystals in urine. Osmolar gap is high.",abg:{pH:7.09,PaCO2:32,HCO3:9,Na:140,Cl:100,Lactate:3.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Most likely cause?",choices:["Ethylene glycol poisoning","Lactic acidosis only","DKA","Renal tubular acidosis"],correct:"A"},{q:"Delta ratio?",choices:["1‚Äì2","<1",">2","Not applicable"],correct:"A"},{q:"Resp compensation?",choices:["Undercompensated","Appropriate","Overcompensating","Not applicable"],correct:"A"}]},
            {examID:"EXM_054",difficulty:4,scenario:"A 61-year-old woman with COPD and recent pneumonia presents with increasing somnolence. Her family reports she has been using her home oxygen at 5 L/min for the last two days. Vitals: BP 140/80, HR 96, RR 10 shallow, SpO2 94% on 5 L. She is drowsy and confused.",abg:{pH:7.28,PaCO2:78,HCO3:36,Na:140,Cl:103,Lactate:1.4},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Metabolic acidosis","Mixed"],correct:"A"},{q:"Cause?",choices:["Excess O2 leading to CO2 retention","Sepsis","Hyperventilation","Panic attack"],correct:"A"},{q:"pH?",choices:["Acidemia","Alkalemia","Normal","Mixed"],correct:"A"},{q:"HCO3- indicates:",choices:["Chronic adaptation","Acute only","No compensation","Primary metabolic disorder"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Pulmonary embolism","DKA","Renal failure"],correct:"A"}]},
            {examID:"EXM_055",difficulty:3,scenario:"A 44-year-old man presents with 2 days of persistent vomiting due to suspected small bowel obstruction. He is dehydrated, tachycardic, and weak. Vitals: BP 102/60, HR 118, RR 20. Labs: Na 139, K 3.1, Cl 84. Abdomen is distended with high-pitched bowel sounds.",abg:{pH:7.50,PaCO2:46,HCO3:34,Na:139,Cl:84,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Key electrolyte clue?",choices:["Low chloride","High chloride","Low sodium","High potassium"],correct:"A"},{q:"Likely cause?",choices:["Vomiting/NG loss","Renal failure","Diarrhea","DKA"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"}]},
            {examID:"EXM_056",difficulty:2,scenario:"A 38-year-old man presents with profuse watery diarrhea for 3 days. He feels weak with muscle cramps and dizziness. Vitals: BP 98/62, HR 116, RR 22. Labs: Na 134, Cl 112, K 3.4. He is mildly dehydrated but alert.",abg:{pH:7.32,PaCO2:30,HCO3:15,Na:134,Cl:112,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Ketones","Lactic acidosis","Kidney failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride?",choices:["Hyperchloremic pattern","Hypochloremia","Renal tubular issue","Metabolic alkalosis"],correct:"A"}]},
            {examID:"EXM_057",difficulty:5,scenario:"A 51-year-old man with septic shock from pneumonia is intubated and on high-dose norepinephrine. He remains hypotensive. Vitals: BP 84/54, HR 132, RR set to 22 on ventilator. Lactate is 9.2 mmol/L. Urine output has dropped to 10 mL/hr. BUN 58, Cr 3.0 mg/dL.",abg:{pH:7.11,PaCO2:36,HCO3:11,Na:137,Cl:103,Lactate:9.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Severe lactic acidosis + shock","DKA","Renal tubular acidosis","Salicylates"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Inadequate","Appropriate","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_058",difficulty:4,scenario:"A 72-year-old man with CHF on aggressive diuresis presents with weakness and palpitations. He is dehydrated, and ECG shows frequent PVCs. Vitals: BP 134/80, HR 98 irregular, RR 18. Labs: K 2.9, Cl 88. BUN and creatinine mildly elevated.",abg:{pH:7.48,PaCO2:46,HCO3:34,Na:140,Cl:88,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Likely cause?",choices:["Diuretic-induced alkalosis","DKA","Vomiting","Toxin"],correct:"A"},{q:"Key electrolyte clue?",choices:["Low chloride","High chloride","High sodium","Low bicarbonate"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"}]},
            {examID:"EXM_059",difficulty:1,scenario:"A 22-year-old man presents after sprinting up multiple stairs and suddenly feeling dizzy. He is breathing rapidly but otherwise healthy. Vitals: BP 118/74, HR 120, RR 34. No fever, chest pain, or anxiety history.",abg:{pH:7.50,PaCO2:29,HCO3:22,Na:139,Cl:102,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation from exertion","Renal failure","DKA","Vomiting"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_060",difficulty:5,scenario:"A 48-year-old woman who overdosed on salicylates presents with vomiting, tinnitus, and rapid breathing. Vitals: BP 120/72, HR 114, RR 32, Temp 38.3¬∞C. She is agitated and sweating profusely. Labs: glucose 110 mg/dL, BUN 22, Cr 1.1.",abg:{pH:7.46,PaCO2:23,HCO3:16,Na:139,Cl:100,Lactate:3.0},questions:[{q:"Pattern?",choices:["Mixed resp alkalosis + met acidosis","Pure resp alkalosis","Pure met acidosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Salicylate toxicity","DKA","Sepsis","Renal failure"],correct:"A"},{q:"pH status?",choices:["Alkalemia with mixed process","Normal","Acidemia","Mixed acidemia"],correct:"A"},{q:"Compensation?",choices:["Not applicable-this is mixed","Appropriate","Under","Over"],correct:"A"}]},
            // Cases 61-100 - THE FINAL STRETCH! ‚öîÔ∏è
            {examID:"EXM_061",difficulty:3,scenario:"A 51-year-old man with poorly controlled diabetes presents with vomiting, abdominal pain, and progressive weakness. He reports taking less insulin due to nausea. Vitals: BP 112/66, HR 122, RR 28, Temp 37.4¬∞C. He is dehydrated with dry mucous membranes. Glucose is 420 mg/dL. BUN 30, Cr 1.5.",abg:{pH:7.26,PaCO2:27,HCO3:12,Na:132,Cl:90,Lactate:2.0},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["DKA","Uremia","Diarrhea","Ethylene glycol"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","HAGMA + normal Anion gap acidosis","Metabolic alkalosis","Mixed alkalosis"],correct:"A"}]},
            {examID:"EXM_062",difficulty:5,scenario:"A 67-year-old man in septic shock from a perforated colon is intubated and on high-dose norepinephrine. Over the past 2 hours his urine output has dropped to nearly zero. He remains febrile and mottled. Vitals: BP 86/50, HR 134, Temp 38.9¬∞C. Lactate returns at 11.2 mmol/L. BUN 52, Cr 3.5 mg/dL.",abg:{pH:7.14,PaCO2:32,HCO3:10,Na:138,Cl:104,Lactate:11.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely etiology?",choices:["Severe lactic acidosis","DKA","Vomiting","RTA"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Undercompensated","Appropriate","Overcompensated","Not applicable"],correct:"A"}]},
            {examID:"EXM_063",difficulty:1,scenario:"A 34-year-old woman presents with acute shortness of breath during an anxiety episode. She reports chest tightness but no pain. She is breathing very rapidly and cries intermittently. Vitals: BP 118/70, HR 108, RR 40.",abg:{pH:7.56,PaCO2:22,HCO3:19,Na:140,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Sepsis","DKA","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Timing?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_064",difficulty:3,scenario:"A 48-year-old woman with ulcerative colitis presents with persistent diarrhea for 4 days. She feels weak and dizzy. Vitals: BP 100/62, HR 112, RR 22. Labs: Na 135, K 3.0, Cl 114. She has no vomiting and appears volume depleted.",abg:{pH:7.32,PaCO2:30,HCO3:15,Na:135,Cl:114,Lactate:1.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Lactic acidosis","Ketones","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride indicates:",choices:["Hyperchloremic acidosis","Hypochloremia","Metabolic alkalosis","Renal retention"],correct:"A"}]},
            {examID:"EXM_065",difficulty:4,scenario:"A 69-year-old man with long-standing COPD presents with fatigue, confusion, and frequent daytime sleepiness. Family reports he increased home oxygen to 6 L/min due to breathlessness. Vitals: BP 138/86, HR 98, RR 12 shallow, SpO2 94% on 6 L. He is slow to respond and somnolent.",abg:{pH:7.30,PaCO2:74,HCO3:35,Na:140,Cl:101,Lactate:1.3},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Pure acute resp acidosis","Metabolic acidosis","Mixed disorder"],correct:"A"},{q:"Cause?",choices:["Excess oxygen leading to CO2 retention","DKA","PE","Diarrhea"],correct:"A"},{q:"HCO3- level indicates:",choices:["Chronic adaptation","Acute only","No compensation","Metabolic alkalosis"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Respiratory alkalosis","Lactic shock","DKA"],correct:"A"}]},
            {examID:"EXM_066",difficulty:2,scenario:"A 60-year-old woman presents with vomiting due to acute gastroenteritis. She reports 12 episodes of vomiting in 24 hours and feels dizzy. Vitals: BP 102/68, HR 108, RR 18. Labs show Na 140, K 3.3, Cl 86. She has mild dehydration.",abg:{pH:7.49,PaCO2:47,HCO3:35,Na:140,Cl:86,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Vomiting","Diarrhea","Renal failure","Sepsis"],correct:"A"},{q:"Chloride indicates:",choices:["Hypochloremic alkalosis","Hyperchloremia","Mixed disorder","Normal"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"}]},
            {examID:"EXM_067",difficulty:5,scenario:"A 54-year-old man is brought to the ED after ingesting an unknown toxin. He is tachypneic, confused, and vomiting. Vitals: BP 104/60, HR 128, RR 34. Labs show glucose 128 mg/dL and osmolar gap is markedly elevated. Calcium oxalate crystals visible on urine microscopy.",abg:{pH:7.10,PaCO2:26,HCO3:8,Na:140,Cl:100,Lactate:3.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely etiology?",choices:["Ethylene glycol poisoning","DKA","Diarrhea","Renal tubular acidosis"],correct:"A"},{q:"Delta ratio?",choices:["1‚Äì2","<1",">2","Not applicable"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_068",difficulty:2,scenario:"A 41-year-old woman presents with severe watery diarrhea for 48 hours after eating contaminated food. She feels weak and lightheaded. Vitals: BP 94/58, HR 120, RR 24. Labs: Na 134, K 3.2, Cl 112. She is pale and mildly tachypneic.",abg:{pH:7.33,PaCO2:29,HCO3:15,Na:134,Cl:112,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Ketones","Lactate","Toxin ingestion"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride finding?",choices:["Hyperchloremic acidosis","Hypochloremia","Metabolic alkalosis","Renal deficiency"],correct:"A"}]},
            {examID:"EXM_069",difficulty:4,scenario:"A 72-year-old woman with CHF on high-dose diuretics presents with dizziness and palpitations. She appears dehydrated and weak. ECG shows occasional PVCs. Vitals: BP 130/80, HR 96 irregular, RR 20. Labs: K 2.8, Cl 88. Mild metabolic alkalosis suspected.",abg:{pH:7.50,PaCO2:46,HCO3:34,Na:140,Cl:88,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation level?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Diuretic-induced alkalosis","DKA","Vomiting","Toxin ingestion"],correct:"A"},{q:"Chloride finding?",choices:["Hypochloremic pattern","Hyperchloremia","Normal","RTA"],correct:"A"},{q:"pH?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"}]},
            {examID:"EXM_070",difficulty:1,scenario:"A 25-year-old man presents after intense exercise with rapid breathing. He denies chest pain or anxiety but feels lightheaded. Vitals: BP 118/74, HR 120, RR 34. He is well-appearing once rested for a few minutes.",abg:{pH:7.49,PaCO2:30,HCO3:22,Na:139,Cl:102,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Hyperventilation from exertion","Renal failure","Sepsis","Vomiting"],correct:"A"},{q:"pH status?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_071",difficulty:4,scenario:"A 76-year-old woman with stage IV COPD presents with worsening dyspnea and lethargy. Her family reports she increased her home oxygen to 6 L/min. Vitals: BP 144/86, HR 102, RR 10 shallow, SpO2 94% on 6 L. She is somnolent, confused, and has shallow tidal volumes.",abg:{pH:7.31,PaCO2:74,HCO3:35,Na:140,Cl:102,Lactate:1.5},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Metabolic acidosis","Mixed"],correct:"A"},{q:"Likely cause?",choices:["Oxygen-induced CO2 retention","Pulmonary embolism","Hyperventilation","Sepsis"],correct:"A"},{q:"HCO3- indicates:",choices:["Chronic retention","Acute only","Renal failure","No compensation"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Major risk?",choices:["CO2 narcosis","Hypokalemia","DKA","Seizures"],correct:"A"}]},
            {examID:"EXM_072",difficulty:1,scenario:"A 19-year-old woman presents with lightheadedness and hyperventilation after receiving distressing news. She has no chest pain or fever. Vitals: BP 118/72, HR 104, RR 38. She reports tingling around her mouth and fingers.",abg:{pH:7.55,PaCO2:23,HCO3:20,Na:140,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Cause?",choices:["Acute hyperventilation","Renal failure","DKA","Vomiting"],correct:"A"},{q:"pH?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_073",difficulty:5,scenario:"A 60-year-old man is found unresponsive with an open container of antifreeze nearby. He is hypothermic and tachypneic. Vitals: BP 100/60, HR 120, RR 30, Temp 35.0¬∞C. Labs show an elevated osmolar gap and calcium oxalate crystals in urine. Glucose is normal. He has metabolic confusion and vomiting.",abg:{pH:7.11,PaCO2:28,HCO3:9,Na:140,Cl:100,Lactate:3.5},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Ethylene glycol poisoning","DKA","Lactic acidosis only","Uremia"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot determine"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_074",difficulty:3,scenario:"A 66-year-old man with heart failure presents with progressive dyspnea and orthopnea. He has mild leg edema and bibasilar crackles. Vitals: BP 158/90, HR 110, RR 28, SpO2 87% on room air. Labs show BUN 38, Cr 2.0. He appears tachypneic and anxious.",abg:{pH:7.46,PaCO2:30,HCO3:21,Na:137,Cl:102,Lactate:2.6},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Cause?",choices:["Pulmonary edema","Panic attack","Renal failure","Asthma"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Lactate suggests:",choices:["Mild hypoperfusion","Renal injury","DKA","Seizures"],correct:"A"}]},
            {examID:"EXM_075",difficulty:2,scenario:"A 45-year-old woman with 3 days of severe diarrhea presents fatigued and dizzy. Vitals: BP 94/58, HR 118, RR 24. Labs: Na 134, K 3.0, Cl 114. She is volume depleted with dry mucosa and hyperactive bowel sounds.",abg:{pH:7.32,PaCO2:29,HCO3:15,Na:134,Cl:114,Lactate:1.3},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Bicarbonate loss","Lactic acidosis","Ketosis","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride suggests:",choices:["Hyperchloremic acidosis","Hypochloremia","Metabolic alkalosis","Renal retention"],correct:"A"}]},
            {examID:"EXM_076",difficulty:5,scenario:"A 74-year-old man in the ICU after bowel ischemia surgery remains hypotensive on vasopressors. His abdomen is distended, and urine output has dropped to 5 mL/hr. He is intubated and febrile at 38.8¬∞C. Lactate returns at 8.4 mmol/L. BUN 58, Cr 3.2 mg/dL.",abg:{pH:7.18,PaCO2:38,HCO3:14,Na:138,Cl:104,Lactate:8.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Septic shock + ischemia","DKA","Resp failure","Vomiting"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Inadequate","Appropriate","Excessive","Not applicable"],correct:"A"}]},
            {examID:"EXM_077",difficulty:1,scenario:"A 21-year-old athlete presents after an intense run with dizziness and rapid breathing. He denies anxiety or chest pain. Vitals: BP 116/70, HR 125, RR 36. He recovers quickly when resting.",abg:{pH:7.50,PaCO2:29,HCO3:22,Na:139,Cl:102,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Cause?",choices:["Hyperventilation from exertion","Sepsis","Renal failure","Vomiting"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Not known"],correct:"A"}]},
            {examID:"EXM_078",difficulty:4,scenario:"A 58-year-old post-op patient on opioid PCA becomes progressively somnolent. Nursing reports shallow breaths and low minute ventilation. Vitals: BP 110/64, HR 88, RR 7, SpO2 90% on 2 L. She responds only to sternal rub.",abg:{pH:7.26,PaCO2:68,HCO3:30,Na:140,Cl:103,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Respiratory acidosis","Respiratory alkalosis","Metabolic acidosis","Metabolic alkalosis"],correct:"A"},{q:"Cause?",choices:["Opioid-induced hypoventilation","Sepsis","Pulmonary embolism","Asthma"],correct:"A"},{q:"HCO3- suggests:",choices:["Partial metabolic compensation","No compensation","Chronic process only","Metabolic acidosis"],correct:"A"},{q:"pH?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Resp status?",choices:["Severely hypoventilating","Hyperventilating","Normal","Inconsistent"],correct:"A"}]},
            {examID:"EXM_079",difficulty:3,scenario:"A 62-year-old woman with CKD presents with fatigue and decreased appetite. She has mild nausea and metallic taste. Vitals: BP 142/90, HR 94, RR 22. Labs: BUN 72 mg/dL, Cr 5.9 mg/dL, K 5.4. She is mildly tachypneic.",abg:{pH:7.28,PaCO2:28,HCO3:13,Na:138,Cl:104,Lactate:1.6},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Uremia","DKA","Diarrhea","Toxin"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","Mixed HAGMA + NAGMA","Metabolic alkalosis","Compensated"],correct:"A"}]},
            {examID:"EXM_080",difficulty:5,scenario:"A 49-year-old woman overdoses on salicylates and presents with agitation, vomiting, tinnitus, and rapid breathing. Vitals: BP 118/72, HR 114, RR 34, Temp 38.4¬∞C. She is sweating and hyperventilating deeply. Labs show glucose 112 mg/dL, BUN 20, Cr 1.0.",abg:{pH:7.47,PaCO2:23,HCO3:16,Na:140,Cl:99,Lactate:3.0},questions:[{q:"Pattern?",choices:["Mixed resp alkalosis + met acidosis","Pure resp alkalosis","Pure met acidosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Salicylate toxicity","DKA","Sepsis","Renal failure"],correct:"A"},{q:"pH status?",choices:["Alkalemia with mixed process","Normal","Acidemia","Mixed acidemia"],correct:"A"},{q:"Compensation?",choices:["Not applicable-mixed disorder","Appropriate","Under","Over"],correct:"A"}]},
            // Cases 81-90
            {examID:"EXM_081",difficulty:3,scenario:"A 56-year-old man with long-standing type 2 diabetes presents with nausea, vomiting, and progressive weakness. He reports missing his insulin for 2 days. Vitals: BP 110/64, HR 118, RR 30, Temp 37.3¬∞C. He has Kussmaul-like respirations. Glucose is 480 mg/dL. BUN 34, Cr 1.6.",abg:{pH:7.27,PaCO2:25,HCO3:12,Na:132,Cl:90,Lactate:2.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["DKA","Uremia","Salicylate toxicity","Vomiting"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","Mixed acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"}]},
            {examID:"EXM_082",difficulty:5,scenario:"A 72-year-old man in septic shock from ascending cholangitis is intubated and on high-dose norepinephrine. Lactate returns as 10.1 mmol/L. He is febrile, mottled, and has minimal urine output. Vitals: BP 84/52, HR 130, Temp 39.1¬∞C. BUN 58, Cr 3.1 mg/dL.",abg:{pH:7.13,PaCO2:34,HCO3:11,Na:138,Cl:103,Lactate:10.1},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Respiratory acidosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Likely cause?",choices:["Severe lactic acidosis","DKA","RTA","Hyperchloremia"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Unclear"],correct:"A"},{q:"Resp compensation?",choices:["Undercompensated","Appropriate","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_083",difficulty:2,scenario:"A 40-year-old woman presents with 36 hours of persistent vomiting. She is dehydrated, weak, and dizzy on standing. Vitals: BP 98/60, HR 112, RR 18. Labs: Na 139, K 3.1, Cl 86. Abdomen is mildly tender without peritonitis.",abg:{pH:7.51,PaCO2:49,HCO3:38,Na:139,Cl:86,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Chloride finding suggests:",choices:["Hypochloremic alkalosis","Hyperchloremia","Mixed process","NAGMA"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"},{q:"Etiology?",choices:["Vomiting/NG loss","Renal retention","DKA","Sepsis"],correct:"A"}]},
            {examID:"EXM_084",difficulty:4,scenario:"A 69-year-old COPD patient presents confused and extremely drowsy. Family reports he increased his home oxygen to 7 L/min due to breathlessness. Vitals: BP 142/86, HR 94, RR 10 shallow, SpO2 95% on 7 L. He responds slowly and has CO2 retention signs.",abg:{pH:7.29,PaCO2:80,HCO3:36,Na:140,Cl:103,Lactate:1.5},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Metabolic acidosis","Mixed"],correct:"A"},{q:"Cause?",choices:["Oxygen-induced hypoventilation","DKA","Sepsis","PE"],correct:"A"},{q:"HCO3- indicates:",choices:["Chronic adaptation","Acute only","Primary metabolic issue","No compensation"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Lactic shock","DKA","CHF"],correct:"A"}]},
            {examID:"EXM_085",difficulty:1,scenario:"A 24-year-old student presents with tingling in her fingers and around her mouth after a panic episode. She is visibly anxious and breathing quickly. Vitals: BP 118/70, HR 106, RR 38. No fever, chest pain, or metabolic illness.",abg:{pH:7.57,PaCO2:21,HCO3:19,Na:139,Cl:103,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"pH category?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Sepsis","Vomiting","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Timing?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_086",difficulty:5,scenario:"A 50-year-old woman presents confused after taking a large amount of aspirin for chronic pain. She is hyperventilating, sweating, and vomiting. Vitals: BP 122/68, HR 116, RR 34, Temp 38.0¬∞C. Labs show glucose 105 mg/dL. She is agitated and dehydrated.",abg:{pH:7.45,PaCO2:22,HCO3:15,Na:140,Cl:100,Lactate:2.8},questions:[{q:"Pattern?",choices:["Mixed resp alkalosis + met acidosis","Pure resp alkalosis","Pure met acidosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Salicylate toxicity","DKA","Renal failure","Lactic shock"],correct:"A"},{q:"pH status?",choices:["Borderline alkalemia with mixed disorder","Acidemia","Normal","Mixed acidemia"],correct:"A"},{q:"Compensation?",choices:["Not applicable-true mixed","Appropriate","Under","Over"],correct:"A"}]},
            {examID:"EXM_087",difficulty:3,scenario:"A 43-year-old man with chronic diarrhea from Crohns disease presents with dizziness and muscle cramps. He is dehydrated and weak. Vitals: BP 96/60, HR 118, RR 22. Labs: Na 134, K 3.2, Cl 112. No vomiting.",abg:{pH:7.34,PaCO2:31,HCO3:16,Na:134,Cl:112,Lactate:1.4},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Likely etiology?",choices:["Bicarbonate loss","Ketones","Lactate","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride?",choices:["Hyperchloremic pattern","Hypochloremia","Metabolic alkalosis","Mixed"],correct:"A"}]},
            {examID:"EXM_088",difficulty:4,scenario:"A 75-year-old man with advanced COPD presents somnolent with shallow breathing. He has been using high-flow home oxygen for the past 48 hours due to a viral illness. Vitals: BP 140/84, HR 92, RR 10, SpO2 95% on 6 L/min. He is difficult to arouse.",abg:{pH:7.31,PaCO2:76,HCO3:38,Na:140,Cl:100,Lactate:1.2},questions:[{q:"Interpretation?",choices:["Acute on chronic resp acidosis","Metabolic acidosis","Respiratory alkalosis","Mixed"],correct:"A"},{q:"Cause?",choices:["Oxygen-induced hypoventilation","Sepsis","DKA","Asthma"],correct:"A"},{q:"HCO3- indicates:",choices:["Chronic compensation","Acute only","No compensation","Mixed"],correct:"A"},{q:"pH category?",choices:["Acidemia","Alkalemia","Normal","Mixed"],correct:"A"},{q:"Risk?",choices:["CO2 narcosis","Lactic acidosis","RTA","Metabolic alkalosis"],correct:"A"}]},
            {examID:"EXM_089",difficulty:2,scenario:"A 39-year-old woman presents with persistent vomiting from acute gastritis. She is dehydrated and weak. Vitals: BP 104/66, HR 110, RR 18. Labs: Na 140, K 3.0, Cl 88. Mild epigastric tenderness but no peritonitis.",abg:{pH:7.49,PaCO2:48,HCO3:35,Na:140,Cl:88,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis"],correct:"A"},{q:"Chloride finding?",choices:["Hypochloremia ‚Üí alkalosis","Hyperchloremia","NAGMA","RTA"],correct:"A"},{q:"Etiology?",choices:["Vomiting","Diarrhea","Renal failure","DKA"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"}]},
            {examID:"EXM_090",difficulty:5,scenario:"A 52-year-old man with a history of chronic alcohol use is brought in confused, vomiting, and tachypneic. He has not eaten for 3 days. Vitals: BP 108/70, HR 128, RR 32, Temp 37.1¬∞C. Labs: glucose 88 mg/dL, Na 130, K 3.1, Cl 90, lactate 3.9. Ketones strongly positive.",abg:{pH:7.23,PaCO2:26,HCO3:11,Na:130,Cl:90,Lactate:3.9},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Alcoholic ketoacidosis + lactic acidosis","DKA","RTA","Hyperchloremia"],correct:"A"},{q:"Delta ratio?",choices:[">2","1‚Äì2","<1","Not applicable"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            // Cases 91-100 - THE FINAL 10! üèÜ
            {examID:"EXM_091",difficulty:4,scenario:"A 71-year-old man with severe COPD presents with confusion and shallow breathing. He recently increased his home oxygen to 6 L/min. Vitals: BP 144/90, HR 96, RR 10, SpO2 95% on 6 L. He is somnolent and arouses only to pain. Lung exam reveals poor air movement.",abg:{pH:7.32,PaCO2:78,HCO3:39,Na:140,Cl:102,Lactate:1.4},questions:[{q:"Primary disorder?",choices:["Acute on chronic resp acidosis","Acute respiratory acidosis","Metabolic acidosis","Respiratory alkalosis"],correct:"A"},{q:"Cause?",choices:["O2-induced hypoventilation","Pulmonary embolism","Asthma","Hyperventilation"],correct:"A"},{q:"HCO3- suggests:",choices:["Chronic adaptation","Acute rise","Metabolic alkalosis","No compensation"],correct:"A"},{q:"pH category?",choices:["Acidemia","Normal","Alkalemia","Mixed"],correct:"A"},{q:"Major risk?",choices:["CO2 narcosis","Hypokalemia","DKA","Seizures"],correct:"A"}]},
            {examID:"EXM_092",difficulty:2,scenario:"A 38-year-old woman presents with nausea and repeated vomiting from suspected food poisoning. She is dizzy and weak. Vitals: BP 106/70, HR 110, RR 18. She has dry mucous membranes. Labs: Na 140, K 3.2, Cl 88.",abg:{pH:7.50,PaCO2:47,HCO3:36,Na:140,Cl:88,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Electrolyte clue?",choices:["Hypochloremia","Hyperchloremia","Hypernatremia","Hyperkalemia"],correct:"A"},{q:"Etiology?",choices:["Vomiting","Diarrhea","DKA","Renal failure"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Normal","Acidemia","Mixed"],correct:"A"}]},
            {examID:"EXM_093",difficulty:5,scenario:"A 55-year-old man is brought in unconscious after ingesting a large amount of antifreeze. He is hypothermic and tachypneic. Vitals: BP 98/60, HR 124, RR 32, Temp 35.1¬∞C. Labs show an osmolar gap elevation with calcium oxalate crystals in urine.",abg:{pH:7.08,PaCO2:28,HCO3:7,Na:140,Cl:100,Lactate:4.0},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Respiratory alkalosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap status?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Ethylene glycol poisoning","DKA","Uremia","Lactic acidosis alone"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot determine"],correct:"A"},{q:"Resp compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_094",difficulty:3,scenario:"A 66-year-old woman with chronic renal disease presents with weakness, anorexia, and decreased urine output. Vitals: BP 150/94, HR 92, RR 26. Labs: BUN 76 mg/dL, Cr 6.1 mg/dL, K 5.6. She appears fatigued and slightly tachypneic.",abg:{pH:7.29,PaCO2:30,HCO3:14,Na:138,Cl:103,Lactate:1.7},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Uremia","DKA","Diarrhea","Salicylate toxicity"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Adjusted HCO3-?",choices:["Pure HAGMA","Mixed HAGMA + NAGMA","Metabolic alkalosis","No mixed disorder"],correct:"A"}]},
            {examID:"EXM_095",difficulty:1,scenario:"A 27-year-old woman develops hyperventilation and tingling after an argument with a family member. She has no medical illness. Vitals: BP 118/72, HR 110, RR 40. She is anxious and tearful.",abg:{pH:7.56,PaCO2:22,HCO3:19,Na:140,Cl:102,Lactate:1.0},questions:[{q:"Primary disorder?",choices:["Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Cause?",choices:["Hyperventilation","Sepsis","Renal disease","Vomiting"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Chronicity?",choices:["Acute","Chronic","Mixed","Unknown"],correct:"A"}]},
            {examID:"EXM_096",difficulty:4,scenario:"A 75-year-old man on high-dose loop diuretics presents with confusion, weakness, and palpitations. He appears dehydrated. Vitals: BP 134/82, HR 102 irregular, RR 18. Labs: K 2.8, Cl 86. ECG shows PVCs. He has chronic CHF.",abg:{pH:7.52,PaCO2:48,HCO3:38,Na:140,Cl:86,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Respiratory acidosis","Metabolic acidosis"],correct:"A"},{q:"Electrolyte clue?",choices:["Hypochloremia","Hyperchloremia","Hyperkalemia","Hyponatremia"],correct:"A"},{q:"Etiology?",choices:["Diuretic-induced alkalosis","DKA","Vomiting","Toxin ingestion"],correct:"A"},{q:"pH status?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_097",difficulty:5,scenario:"A 53-year-old man with septic shock from necrotizing fasciitis is intubated and on high-dose vasopressors. He is mottled, febrile, and has minimal urine output. Vitals: BP 82/48, HR 138, Temp 39.2¬∞C. Lactate returns at 9.8 mmol/L. BUN 60, Cr 4.0 mg/dL.",abg:{pH:7.16,PaCO2:36,HCO3:12,Na:138,Cl:104,Lactate:9.8},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory acidosis","Metabolic alkalosis","Respiratory alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Severe lactic acidosis","DKA","Vomiting","Hyperchloremia"],correct:"A"},{q:"Delta ratio?",choices:["<1","1‚Äì2",">2","Cannot assess"],correct:"A"},{q:"Resp compensation?",choices:["Inadequate","Appropriate","Over","Not applicable"],correct:"A"}]},
            {examID:"EXM_098",difficulty:2,scenario:"A 42-year-old woman presents with 2 days of diarrhea from viral gastroenteritis. She is weak and mildly dehydrated. Vitals: BP 98/64, HR 114, RR 22. Labs: Na 134, K 3.0, Cl 112.",abg:{pH:7.33,PaCO2:30,HCO3:15,Na:134,Cl:112,Lactate:1.1},questions:[{q:"Primary disorder?",choices:["Metabolic acidosis","Respiratory alkalosis","Metabolic alkalosis","Respiratory acidosis"],correct:"A"},{q:"Anion gap?",choices:["Normal","High","Low","Not calculable"],correct:"A"},{q:"Etiology?",choices:["Bicarbonate loss","Ketones","Lactic acidosis","Toxin ingestion"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"Chloride?",choices:["Hyperchloremic pattern","Hypochloremia","Metabolic alkalosis","Renal disorder"],correct:"A"}]},
            {examID:"EXM_099",difficulty:3,scenario:"A 49-year-old man with recurrent vomiting from gastric outlet obstruction presents dehydrated, dizzy, and weak. Vitals: BP 96/60, HR 118, RR 18. Labs: Na 140, K 3.0, Cl 84. He is visibly volume depleted.",abg:{pH:7.51,PaCO2:48,HCO3:38,Na:140,Cl:84,Lactate:1.2},questions:[{q:"Primary disorder?",choices:["Metabolic alkalosis","Respiratory alkalosis","Metabolic acidosis","Respiratory acidosis"],correct:"A"},{q:"Chloride finding?",choices:["Hypochloremia","Hyperchloremia","Mixed","Normal"],correct:"A"},{q:"Likely cause?",choices:["Vomiting/NG loss","Renal failure","DKA","Sepsis"],correct:"A"},{q:"Compensation?",choices:["Appropriate","Under","Over","Not applicable"],correct:"A"},{q:"pH?",choices:["Alkalemia","Acidemia","Normal","Mixed"],correct:"A"}]},
            {examID:"EXM_100",difficulty:5,scenario:"A 47-year-old woman presents agitated, hyperventilating, sweating, and vomiting after taking a large amount of aspirin. She is tachypneic and restless. Vitals: BP 118/70, HR 122, RR 36, Temp 38.6¬∞C. Labs show glucose 110 mg/dL.",abg:{pH:7.46,PaCO2:22,HCO3:15,Na:140,Cl:100,Lactate:3.1},questions:[{q:"Pattern?",choices:["Mixed resp alkalosis + met acidosis","Pure resp alkalosis","Pure met acidosis","Metabolic alkalosis"],correct:"A"},{q:"Anion gap?",choices:["High","Normal","Low","Not calculable"],correct:"A"},{q:"Cause?",choices:["Salicylate toxicity","DKA","Sepsis","Renal failure"],correct:"A"},{q:"pH?",choices:["Alkalemia with mixed disorder","Acidemia","Normal","Mixed acidemia"],correct:"A"},{q:"Compensation?",choices:["Not applicable-true mixed","Appropriate","Under","Over"],correct:"A"}]}
        ];
        
        // Mastery Quiz State
        let masteryQuizState = {
            currentCaseIndex: 0,
            currentQuestionIndex: 0,
            userAnswers: [],
            caseScores: [],
            isActive: false,
            startTime: null
        };
        
        // Daily Challenge State
        let dailyChallengeState = {
            lastCompletedDate: null,
            todayCaseIndex: null,
            completed: false
        };
        
        // Load Mastery Quiz progress
        function loadMasteryProgress() {
            const saved = localStorage.getItem('masteryQuizProgress');
            if (saved) {
                masteryQuizState = JSON.parse(saved);
            }
        }
        
        // Save Mastery Quiz progress
        function saveMasteryProgress() {
            localStorage.setItem('masteryQuizProgress', JSON.stringify(masteryQuizState));
        }
        
        // Check if user qualifies for Mastery Quiz (80%+ on all 5 levels)
        function checkMasteryQualification() {
            for (let level = 1; level <= 5; level++) {
                const score = gameState.levelScores[level];
                if (!score || score.total === 0) return false;
                const percentage = (score.correct / score.total) * 100;
                if (percentage < 80) return false;
            }
            return true;
        }
        
        // Update Mastery Quiz UI on home screen
        function updateMasteryQuizUI() {
            const isQualified = checkMasteryQualification();
            const button = document.getElementById('masteryQuizButton');
            const card = document.getElementById('masteryQuizCard');
            const requirements = document.getElementById('masteryRequirements');
            const progress = document.getElementById('masteryProgress');
            
            if (isQualified) {
                button.disabled = false;
                button.innerHTML = 'üèÜ START MASTERY QUIZ';
                card.classList.remove('mastery-quiz-locked');
                requirements.style.display = 'none';
                
                if (masteryQuizState.caseScores.length > 0) {
                    progress.style.display = 'block';
                    const progressPercent = (masteryQuizState.caseScores.length / masteryQuizCases.length) * 100;
                    document.getElementById('masteryProgressFill').style.width = progressPercent + '%';
                    document.getElementById('masteryCaseNumber').textContent = 
                        `${masteryQuizState.caseScores.length}/${masteryQuizCases.length} cases completed`;
                }
            } else {
                button.disabled = true;
                button.innerHTML = '<span class="lock-icon">üîí</span> LOCKED';
                card.classList.add('mastery-quiz-locked');
                requirements.style.display = 'block';
                progress.style.display = 'none';
            }
        }
        
        // Get Daily Challenge case index (rotates daily based on day of year)
        function getDailyCaseIndex() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 0);
            const diff = now - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            return dayOfYear % masteryQuizCases.length;
        }
        
        // Update Daily Challenge UI
        function updateDailyChallengeUI() {
            const today = new Date().toDateString();
            const lastCompleted = localStorage.getItem('dailyChallengeDate');
            const button = document.getElementById('dailyChallengeButton');
            const completedMsg = document.getElementById('dailyCompletedMessage');
            const info = document.getElementById('dailyChallengeInfo');
            
            const todayCaseIndex = getDailyCaseIndex();
            const todayCase = masteryQuizCases[todayCaseIndex];
            
            if (lastCompleted === today) {
                button.style.display = 'none';
                completedMsg.style.display = 'block';
            } else {
                button.style.display = 'block';
                completedMsg.style.display = 'none';
                if (todayCase) {
                    info.textContent = `Today's challenge: Case ${todayCaseIndex + 1} - Difficulty Level ${todayCase.difficulty}`;
                }
            }
        }
        
        // Start Mastery Quiz
        function startMasteryQuiz() {
            if (!checkMasteryQualification()) {
                alert('Please complete all 5 levels with 80%+ accuracy to unlock the Mastery Quiz.');
                return;
            }
            
            // Initialize or resume
            if (masteryQuizState.caseScores.length === 0) {
                masteryQuizState = {
                    currentCaseIndex: 0,
                    currentQuestionIndex: 0,
                    userAnswers: [],
                    caseScores: [],
                    isActive: true,
                    startTime: new Date().toISOString()
                };
            }
            
            saveMasteryProgress();
            showScreen('masteryQuizScreen');
            displayMasteryCase();
        }
        
        // Start Daily Challenge
        function startDailyChallenge() {
            const todayCaseIndex = getDailyCaseIndex();
            const todayCase = masteryQuizCases[todayCaseIndex];
            
            if (!todayCase) {
                alert('Daily challenge not available yet. Check back soon!');
                return;
            }
            
            // Set up as a single-case quiz
            masteryQuizState = {
                currentCaseIndex: todayCaseIndex,
                currentQuestionIndex: 0,
                userAnswers: [],
                caseScores: [],
                isActive: true,
                isDailyChallenge: true,
                startTime: new Date().toISOString()
            };
            
            showScreen('masteryQuizScreen');
            displayDailyChallenge();
        }
        
        // Display Daily Challenge with ALL questions on ONE page
        function displayDailyChallenge() {
            const todayCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            const content = document.getElementById('masteryQuizContent');
            const header = document.querySelector('#masteryQuizScreen h2');
            const subtitle = document.querySelector('#masteryQuizScreen p');
            const caseNumber = document.getElementById('masteryQuizCaseNumber');
            
            // Update header for Daily Challenge
            header.textContent = '‚ö° Daily ABG Challenge';
            subtitle.textContent = 'One challenging case per day';
            caseNumber.textContent = `Challenge for ${new Date().toLocaleDateString()}`;
            
            // Build HTML - Scenario and ABG STAY AT TOP, questions appear below one at a time
            let html = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìã Clinical Scenario</h3>
                    <p style="line-height: 1.6; color: #333;">${todayCase.scenario}</p>
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <h4 style="color: #1976d2; margin-bottom: 10px;">üß™ ABG Results</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        <div><strong>pH:</strong> ${todayCase.abg.pH}</div>
                        <div><strong>PaCO2:</strong> ${todayCase.abg.PaCO2} mmHg</div>
                        <div><strong>HCO3-:</strong> ${todayCase.abg.HCO3} mEq/L</div>
                        <div><strong>Na‚Å∫:</strong> ${todayCase.abg.Na} mEq/L</div>
                        <div><strong>Cl-:</strong> ${todayCase.abg.Cl} mEq/L</div>
                        ${todayCase.abg.Lactate ? `<div><strong>Lactate:</strong> ${todayCase.abg.Lactate} mmol/L</div>` : ''}
                    </div>
                </div>
                
                <div id="dailyQuestionContainer">
                    <!-- Question will appear here -->
                </div>
            `;
            
            content.innerHTML = html;
            
            // Initialize answers array
            masteryQuizState.userAnswers = new Array(todayCase.questions.length).fill(null);
            
            // Show first question
            showDailyQuestion();
        }
        
        function showDailyQuestion() {
            const todayCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            const qIndex = masteryQuizState.currentQuestionIndex;
            const question = todayCase.questions[qIndex];
            const container = document.getElementById('dailyQuestionContainer');
            
            let html = `
                <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #667eea;">
                    <h3 style="color: #333; margin-bottom: 20px;">Question ${qIndex + 1} of ${todayCase.questions.length}</h3>
                    <p style="font-size: 18px; margin-bottom: 20px; color: #555;">${question.q}</p>
                    <div class="daily-question-${qIndex}">
            `;
            
            question.choices.forEach((choice, cIndex) => {
                const optionLetter = String.fromCharCode(65 + cIndex);
                const isSelected = masteryQuizState.userAnswers[qIndex] === optionLetter;
                html += `
                    <div class="mcq-choice daily-q${qIndex} ${isSelected ? 'selected' : ''}" onclick="selectDailyAnswer(${qIndex}, '${optionLetter}')">
                        <span class="choice-letter">${optionLetter}</span>
                        <span class="choice-text">${choice}</span>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: space-between;">
            `;
            
            // Show Previous button if not first question
            if (qIndex > 0) {
                html += `
                    <button onclick="previousDailyQuestion()" class="button" style="flex: 1; padding: 15px; font-size: 16px; background: #999;">
                        ‚Üê Previous Question
                    </button>
                `;
            } else {
                html += `<div style="flex: 1;"></div>`; // Spacer
            }
            
            // Show Next or Submit button
            if (qIndex < todayCase.questions.length - 1) {
                html += `
                    <button onclick="nextDailyQuestion()" class="button" style="flex: 1; padding: 15px; font-size: 16px;">
                        Next Question ‚Üí
                    </button>
                `;
            } else {
                html += `
                    <button onclick="submitDailyChallenge()" class="button" style="flex: 1; padding: 15px; font-size: 16px;">
                        Submit Challenge
                    </button>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function previousDailyQuestion() {
            if (masteryQuizState.currentQuestionIndex > 0) {
                masteryQuizState.currentQuestionIndex--;
                showDailyQuestion();
            }
        }
        
        function nextDailyQuestion() {
            const todayCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            if (masteryQuizState.currentQuestionIndex < todayCase.questions.length - 1) {
                masteryQuizState.currentQuestionIndex++;
                showDailyQuestion();
            }
        }
        
        function selectDailyAnswer(questionIndex, answer) {
            // Store the answer
            masteryQuizState.userAnswers[questionIndex] = answer;
            
            // Refresh the question display to show selection
            showDailyQuestion();
        }
        
        function submitDailyChallenge() {
            const todayCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            
            // Check if all questions are answered
            if (masteryQuizState.userAnswers.includes(null)) {
                alert('Please answer all 5 questions before submitting! Use Previous/Next buttons to navigate.');
                return;
            }
            
            // Calculate score
            let correctCount = 0;
            todayCase.questions.forEach((question, index) => {
                if (masteryQuizState.userAnswers[index] === question.correct) {
                    correctCount++;
                }
            });
            
            const percentage = (correctCount / todayCase.questions.length) * 100;
            
            // Show results
            showDailyChallengeResults(correctCount, todayCase.questions.length, percentage);
        }
        
        function showDailyChallengeResults(correct, total, percentage) {
            const content = document.getElementById('masteryQuizContent');
            const todayCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            
            let html = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üéØ Daily Challenge Complete!</h2>
                    <div style="font-size: 48px; margin: 30px 0;">
                        ${percentage >= 80 ? 'üèÜ' : percentage >= 60 ? '‚≠ê' : 'üí™'}
                    </div>
                    <h3 style="color: #333; margin-bottom: 10px;">Score: ${correct}/${total} (${percentage.toFixed(1)}%)</h3>
                    <p style="color: #666; margin-bottom: 30px;">
                        ${percentage >= 80 ? 'Excellent work!' : percentage >= 60 ? 'Good effort!' : 'Keep practicing!'}
                    </p>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                        <h4 style="color: #667eea; margin-bottom: 15px;">üìä Answer Review</h4>
            `;
            
            todayCase.questions.forEach((question, index) => {
                const userAnswer = masteryQuizState.userAnswers[index];
                const isCorrect = userAnswer === question.correct;
                const correctChoice = question.choices[question.correct.charCodeAt(0) - 65];
                const userChoice = question.choices[userAnswer.charCodeAt(0) - 65];
                
                html += `
                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid ${isCorrect ? '#4caf50' : '#f44336'};">
                        <p style="font-weight: bold; margin-bottom: 5px;">Q${index + 1}: ${question.q}</p>
                        <p style="color: ${isCorrect ? '#4caf50' : '#666'};">
                            ${isCorrect ? '‚úÖ' : '‚ùå'} Your answer: ${userAnswer}. ${userChoice}
                        </p>
                        ${!isCorrect ? `<p style="color: #4caf50;">‚úì Correct: ${question.correct}. ${correctChoice}</p>` : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <button onclick="returnHome()" class="button" style="width: 100%; margin-top: 20px;">
                        Return to Home
                    </button>
                    
                    <p style="color: #999; margin-top: 20px; font-size: 14px;">
                        Come back tomorrow for a new challenge!
                    </p>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        // Display current Mastery Quiz case
        function displayMasteryCase() {
            const currentCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            if (!currentCase) {
                completeMasteryQuiz();
                return;
            }
            
            const content = document.getElementById('masteryQuizContent');
            const progressFill = document.getElementById('masteryQuizProgressFill');
            const caseNumber = document.getElementById('masteryQuizCaseNumber');
            const header = document.querySelector('#masteryQuizScreen h2');
            const subtitle = document.querySelector('#masteryQuizScreen p');
            
            // Restore header for regular Mastery Quiz (in case it was changed by Daily Challenge)
            if (!masteryQuizState.isDailyChallenge) {
                header.textContent = 'üèÜ ABG Mastery Quiz';
                subtitle.textContent = '100 Professional Certification Cases';
            }
            
            // Update progress
            const progress = masteryQuizState.isDailyChallenge ? 
                (masteryQuizState.currentQuestionIndex + 1) / currentCase.questions.length * 100 :
                (masteryQuizState.caseScores.length / masteryQuizCases.length) * 100;
            progressFill.style.width = progress + '%';
            
            if (masteryQuizState.isDailyChallenge) {
                caseNumber.textContent = `Daily Challenge - Question ${masteryQuizState.currentQuestionIndex + 1}/${currentCase.questions.length}`;
            } else {
                caseNumber.textContent = `Case ${masteryQuizState.currentCaseIndex + 1}/${masteryQuizCases.length} - Question ${masteryQuizState.currentQuestionIndex + 1}/${currentCase.questions.length}`;
            }
            
            const currentQuestion = currentCase.questions[masteryQuizState.currentQuestionIndex];
            
            // Show scenario only on first question
            let html = '';
            if (masteryQuizState.currentQuestionIndex === 0) {
                html += `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìã Clinical Scenario</h3>
                        <p style="line-height: 1.6; color: #333;">${currentCase.scenario}</p>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">üß™ ABG Results</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <div><strong>pH:</strong> ${currentCase.abg.pH}</div>
                            <div><strong>PaCO2:</strong> ${currentCase.abg.PaCO2} mmHg</div>
                            <div><strong>HCO3-:</strong> ${currentCase.abg.HCO3} mEq/L</div>
                            <div><strong>Na‚Å∫:</strong> ${currentCase.abg.Na} mEq/L</div>
                            <div><strong>Cl-:</strong> ${currentCase.abg.Cl} mEq/L</div>
                            ${currentCase.abg.Lactate ? `<div><strong>Lactate:</strong> ${currentCase.abg.Lactate} mmol/L</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #667eea;">
                    <h3 style="color: #333; margin-bottom: 20px;">Question ${masteryQuizState.currentQuestionIndex + 1}</h3>
                    <p style="font-size: 18px; margin-bottom: 25px; color: #333;">${currentQuestion.q}</p>
                    
                    <div id="masteryChoices" style="display: grid; gap: 15px;">
                        ${currentQuestion.choices.map((choice, index) => `
                            <button class="choice-btn" onclick="selectMasteryAnswer('${String.fromCharCode(65 + index)}')" 
                                    style="text-align: left; padding: 15px; background: #f8f9fa; border: 2px solid #ddd; 
                                           border-radius: 8px; cursor: pointer; transition: all 0.2s; font-size: 16px;">
                                <strong>${String.fromCharCode(65 + index)}.</strong> ${choice}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        // Select answer in Mastery Quiz
        function selectMasteryAnswer(answer) {
            const currentCase = masteryQuizCases[masteryQuizState.currentCaseIndex];
            const currentQuestion = currentCase.questions[masteryQuizState.currentQuestionIndex];
            
            masteryQuizState.userAnswers.push({
                caseIndex: masteryQuizState.currentCaseIndex,
                questionIndex: masteryQuizState.currentQuestionIndex,
                answer: answer,
                correct: answer === currentQuestion.correct
            });
            
            // Move to next question
            masteryQuizState.currentQuestionIndex++;
            
            // Check if case is complete
            if (masteryQuizState.currentQuestionIndex >= currentCase.questions.length) {
                // Calculate case score
                const caseAnswers = masteryQuizState.userAnswers.filter(a => a.caseIndex === masteryQuizState.currentCaseIndex);
                const correct = caseAnswers.filter(a => a.correct).length;
                const total = caseAnswers.length;
                const percentage = (correct / total) * 100;
                
                masteryQuizState.caseScores.push({
                    caseIndex: masteryQuizState.currentCaseIndex,
                    correct: correct,
                    total: total,
                    percentage: percentage
                });
                
                // If daily challenge, mark as complete
                if (masteryQuizState.isDailyChallenge) {
                    localStorage.setItem('dailyChallengeDate', new Date().toDateString());
                    alert(`Daily Challenge Complete!\n\nScore: ${correct}/${total} (${percentage.toFixed(1)}%)`);
                    goHome();
                    return;
                }
                
                // Move to next case
                masteryQuizState.currentCaseIndex++;
                masteryQuizState.currentQuestionIndex = 0;
            }
            
            saveMasteryProgress();
            displayMasteryCase();
        }
        
        // Complete Mastery Quiz
        function completeMasteryQuiz() {
            const totalCorrect = masteryQuizState.caseScores.reduce((sum, score) => sum + score.correct, 0);
            const totalQuestions = masteryQuizState.caseScores.reduce((sum, score) => sum + score.total, 0);
            const finalPercentage = (totalCorrect / totalQuestions) * 100;
            
            document.getElementById('masteryFinalScore').textContent = 
                `${totalCorrect}/${totalQuestions} (${finalPercentage.toFixed(1)}%)`;
            
            // Show email collection form
            document.getElementById('emailCollectionForm').style.display = 'block';
            
            showScreen('masteryCompletionScreen');
        }
        
        // Download Certificate
        function downloadCertificate() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const totalCorrect = masteryQuizState.caseScores.reduce((sum, score) => sum + score.correct, 0);
            const totalQuestions = masteryQuizState.caseScores.reduce((sum, score) => sum + score.total, 0);
            const finalPercentage = (totalCorrect / totalQuestions) * 100;
            
            // Certificate design (simple for now - will enhance)
            doc.setFontSize(24);
            doc.text('ACHIEVEMENT UNLOCKED', 105, 30, { align: 'center' });
            
            doc.setFontSize(20);
            doc.text('ABG MASTERY CERTIFICATION', 105, 50, { align: 'center' });
            
            doc.setFontSize(14);
            doc.text('Awarded to', 105, 80, { align: 'center' });
            
            doc.setFontSize(18);
            doc.text(userData.fullName || 'ABG Master', 105, 100, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text('Congratulations! You have conquered 100 challenging ABG cases', 105, 120, { align: 'center' });
            doc.text('and proven your mastery of acid-base disorders.', 105, 130, { align: 'center' });
            
            doc.text(`Final Score: ${totalCorrect}/${totalQuestions} (${finalPercentage.toFixed(1)}%)`, 105, 150, { align: 'center' });
            doc.text(`Date of Completion: ${new Date().toLocaleDateString()}`, 105, 160, { align: 'center' });
            
            doc.setFontSize(10);
            doc.text('Dr. Amir Fadhel, FICMS-AIC, MBChB', 105, 200, { align: 'center' });
            doc.text('Specialist in Anesthesiology & Critical Care', 105, 208, { align: 'center' });
            doc.text('Medical Educator | Iraq', 105, 216, { align: 'center' });
            
            doc.text(`Certificate ID: ABG-${Date.now()}`, 105, 240, { align: 'center' });
            doc.text('The Impossible ABG Tutor | 2024', 105, 248, { align: 'center' });
            
            doc.save('ABG-Mastery-Certificate.pdf');
        }
        
        // Submit certificate email
        function submitCertificateEmail() {
            const email = document.getElementById('certificateEmail').value;
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address.');
                return;
            }
            
            // Save to Google Sheets (optional tracking)
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'certificate',
                    data: {
                        timestamp: new Date().toISOString(),
                        userId: userData.userId,
                        userName: userData.fullName,
                        email: email,
                        score: document.getElementById('masteryFinalScore').textContent
                    }
                })
            }).catch(err => console.error('Email logging failed:', err));
            
            alert('Thank you! Your certificate is ready to download.');
            document.getElementById('emailCollectionForm').style.display = 'none';
        }
        
        // Skip certificate email
        function skipCertificateEmail() {
            document.getElementById('emailCollectionForm').style.display = 'none';
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ABG Tutor initializing...');
            
            // Validate data structure
            if (!allCases || !allCases[1]) {
                console.error('ERROR: allCases not properly defined');
                alert('Application error: Data structure not loaded. Please refresh the page.');
                return;
            }
            
            console.log('Level 1 cases:', allCases[1].length);
            console.log('Level 2 cases:', allCases[2].length);
            console.log('Mastery Quiz cases:', masteryQuizCases.length);
            console.log('All functions loaded successfully');
            
            // Load Mastery Quiz progress
            loadMasteryProgress();
            
            // Check registration status
            checkRegistration();
            
            // Initialize the app
            goHome();
            
            // Update Mastery Quiz and Daily Challenge UI
            updateMasteryQuizUI();
            updateDailyChallengeUI();
        });
    </script>
</body>
</html>