<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Impossible ABG Tutor - Master Edition</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Master arterial blood gas interpretation through 75 progressive cases across 5 difficulty levels. Systematic ABG training by Dr. Amir Fadhel, Specialist in Anesthesiology & Critical Care.">
    <meta name="keywords" content="ABG, arterial blood gas, medical education, anesthesiology, critical care, ABG interpretation, medical training, Dr. Amir Fadhel">
    <meta name="author" content="Dr. Amir Fadhel">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="The Impossible ABG Tutor - Master Edition">
    <meta property="og:description" content="Master arterial blood gas interpretation through 75 progressive cases. Systematic ABG training by Dr. Amir Fadhel, Specialist in Anesthesiology & Critical Care.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dramir0078.github.io/abg-tutor/">
    <meta property="og:image" content="https://dramir0078.github.io/abg-tutor/preview.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="The Impossible ABG Tutor">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The Impossible ABG Tutor - Master Edition">
    <meta name="twitter:description" content="Master arterial blood gas interpretation through 75 progressive cases. Systematic ABG training by Dr. Amir Fadhel.">
    <meta name="twitter:image" content="https://dramir0078.github.io/abg-tutor/preview.png">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ü©∫</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .home-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .home-btn:hover {
            background: white;
            color: #667eea;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            padding-top: 60px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .bio-link {
            color: white;
            text-decoration: underline;
            margin-top: 10px;
            display: inline-block;
        }
        
        .progress-section {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-item strong {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }
        
        .stat-item span {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-full {
            width: 100%;
            margin-top: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .level-btn {
            background: white;
            border: 3px solid #ddd;
            padding: 20px;
            margin: 10px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .level-btn:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .level-btn.unlocked {
            border-color: #4CAF50;
        }
        
        .level-btn.locked {
            background: #f5f5f5;
            border-color: #ddd;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .level-btn.locked:hover {
            transform: none;
        }
        
        .lock-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }
        
        .scenario-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
        
        .abg-values {
            background: #fff9e6;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        
        .abg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .abg-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .abg-item strong {
            display: block;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .abg-item span {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .equation-box {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .equation-box h4 {
            color: #667eea;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        
        .equation-box strong {
            color: #333;
        }
        
        .question-box {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .mcq-choice {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .mcq-choice:hover {
            border-color: #667eea;
            background: #f5f8ff;
        }
        
        .mcq-choice.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }
        
        .mcq-choice.correct {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        
        .mcq-choice.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .mcq-choice.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .choice-letter {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .choice-text {
            flex: 1;
            font-size: 16px;
        }
        
        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .feedback-correct {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        
        .feedback-incorrect {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        .compendium-box {
            background: #fff3e0;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .compendium-box h3 {
            color: #e65100;
            margin-bottom: 20px;
        }
        
        .equation-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ffe0b2;
        }
        
        .equation-section:last-child {
            border-bottom: none;
        }
        
        .equation-section h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        .level-select {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Portfolio Card Styles */
        .portfolio-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            display: block;
            position: relative;
            overflow: hidden;
        }
        
        .portfolio-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.6);
        }
        
        .portfolio-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: all 0.5s ease;
        }
        
        .portfolio-card:hover::before {
            top: -60%;
            right: -60%;
        }
        
        .portfolio-card-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        
        .portfolio-card-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .portfolio-card h3 {
            color: white;
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .portfolio-card-subtitle {
            color: rgba(255, 255, 255, 1);
            font-size: 20px;
            font-style: normal;
            font-weight: 700;
            margin-bottom: 12px !important;
        }
        
        .portfolio-card p {
            color: rgba(255, 255, 255, 0.95);
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.6;
            font-weight: 700;
        }
        
        .portfolio-card-button {
            background: white;
            color: #667eea;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .portfolio-card:hover .portfolio-card-button {
            background: #f0f0f0;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header (always visible) -->
        <div class="header">
            <button class="home-btn" onclick="goHome()">üè† Home</button>
            <h1>The Impossible ABG Tutor</h1>
            <p><strong>Master Edition</strong></p>
            <p>Systematic ABG Interpretation Training</p>
            <p>Dr. Amir Fadhel | Specialist in Anesthesiology & Critical Care</p>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 20px;">üéØ Welcome to Your ABG Journey</h2>
                
                <p style="text-align: center; margin-bottom: 30px; color: #666; line-height: 1.6;">
                    Master arterial blood gas interpretation through 75 progressive cases across 5 difficulty levels.
                    Each level requires 80% accuracy to advance.
                </p>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-primary" onclick="showPlacementTest()">üìù Take Placement Test</button>
                    <button class="btn btn-secondary" onclick="showLevelSelect()">üìö Select Level</button>
                    <button class="btn btn-secondary" onclick="resetProgress()">üîÑ Reset Progress</button>
                </div>
            </div>
            
            <div class="card">
                <h3>üìñ Level Overview</h3>
                <div style="line-height: 2;">
                    <strong>Level 1:</strong> Basic pH status, primary disorders, compensation<br>
                    <strong>Level 2:</strong> Anion gap calculation and interpretation<br>
                    <strong>Level 3:</strong> Winter's formula and respiratory compensation<br>
                    <strong>Level 4:</strong> Adjusted bicarbonate and hidden disorders<br>
                    <strong>Level 5:</strong> Delta ratio and complex mixed disorders
                </div>
            </div>
            
            <div class="card">
                <button class="btn btn-full btn-secondary" onclick="showCompendium()">üìê View Full Equation Compendium</button>
            </div>
            
            <div class="card" style="background: #fff3cd; border-left: 4px solid #ff9800;">
                <h3 style="color: #e65100;">üîß Debug Tools</h3>
                <p style="margin: 10px 0; color: #666;">Use these if you're experiencing issues:</p>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="showDebugInfo()" style="flex: 1;">üìä Show State</button>
                    <button class="btn btn-secondary" onclick="clearAndReload()" style="flex: 1;">üóëÔ∏è Clear Storage</button>
                </div>
            </div>
            
            <!-- My Portfolio Card -->
            <a href="https://linktr.ee/dramir0078" target="_blank" class="portfolio-card">
                <div class="portfolio-card-content">
                    <span class="portfolio-card-icon">üë®‚Äç‚öïÔ∏è</span>
                    <h3>My Portfolio Card</h3>
                    <p class="portfolio-card-subtitle">Dr. Amir Fadhel</p>
                    <p>Specialist in Anesthesiology & Critical Care | Medical Educator | Iraq</p>
                    <span class="portfolio-card-button">üîó Visit My LinkTree</span>
                </div>
            </a>
        </div>

        <!-- Full Compendium Screen -->
        <div id="compendiumScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 20px;">üìê ABG Equation Compendium (Textbook Standard)</h2>
                <div class="compendium-box">
                    <div class="equation-section">
                        <h4>ANION GAP (AG)</h4>
                        <p><strong>Equation:</strong> AG = Na ‚àí (Cl + HCO‚ÇÉ)</p>
                        <p><strong>Corrected AG:</strong> AG + 2.5 √ó (4 ‚àí albumin)</p>
                        <p><strong>Normal:</strong> 8-12 mEq/L (albumin 4 g/dL)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>High AG ‚Üí added acids present (HAGMA)</li>
                            <li>Normal AG ‚Üí bicarbonate loss or impaired renal acid secretion (NAGMA)</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>WINTER'S FORMULA (Metabolic Acidosis Compensation)</h4>
                        <p><strong>Equation:</strong> Expected PaCO‚ÇÇ = 1.5 √ó HCO‚ÇÉ + 8 ¬± 2</p>
                        <p><strong>Use:</strong> Only when HCO‚ÇÉ is low (metabolic acidosis)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Actual PaCO‚ÇÇ > expected ‚Üí concomitant respiratory acidosis</li>
                            <li>Actual PaCO‚ÇÇ < expected ‚Üí concomitant respiratory alkalosis</li>
                            <li>Within ¬±2 ‚Üí appropriate compensation</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>METABOLIC ALKALOSIS RESPIRATORY COMPENSATION</h4>
                        <p><strong>Equation:</strong> Expected PaCO‚ÇÇ = 40 + 0.7 √ó (HCO‚ÇÉ ‚àí 24) ¬± 5</p>
                        <p><strong>Use:</strong> Only when HCO‚ÇÉ is elevated (metabolic alkalosis)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Actual PaCO‚ÇÇ > expected +5 ‚Üí superimposed respiratory acidosis</li>
                            <li>Actual PaCO‚ÇÇ < expected ‚àí5 ‚Üí superimposed respiratory alkalosis</li>
                            <li>Within ¬±5 ‚Üí appropriate compensation</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>ADJUSTED BICARBONATE</h4>
                        <p><strong>Equation:</strong> Adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)</p>
                        <p><strong>Use:</strong> Every time AG is high (HAGMA)</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Adjusted HCO‚ÇÉ < 18 ‚Üí additional NAGMA</li>
                            <li>Adjusted HCO‚ÇÉ 18-30 ‚Üí pure HAGMA</li>
                            <li>Adjusted HCO‚ÇÉ > 30 ‚Üí concurrent metabolic alkalosis</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>DELTA RATIO (HAGMA Pattern Analysis)</h4>
                        <p><strong>Equation:</strong> Delta Ratio = (AG ‚àí 12) √∑ (24 ‚àí HCO‚ÇÉ)</p>
                        <p><strong>Use:</strong> Only in high anion gap metabolic acidosis</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Delta < 1 ‚Üí HAGMA + NAGMA</li>
                            <li>Delta 1-2 ‚Üí pure HAGMA</li>
                            <li>Delta > 2 ‚Üí metabolic alkalosis or chronic hypercapnia</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>RESPIRATORY ACIDOSIS COMPENSATION</h4>
                        <p><strong>Acute:</strong> PaCO‚ÇÇ ‚Üë10 ‚Üí HCO‚ÇÉ ‚Üë1</p>
                        <p><strong>Chronic:</strong> PaCO‚ÇÇ ‚Üë10 ‚Üí HCO‚ÇÉ ‚Üë3-4</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Matches acute pattern ‚Üí acute respiratory acidosis</li>
                            <li>Matches chronic ‚Üí chronic respiratory acidosis</li>
                            <li>Exceeds expected ‚Üí coexisting metabolic alkalosis</li>
                            <li>Less than expected ‚Üí coexisting metabolic acidosis</li>
                        </ul>
                    </div>
                    
                    <div class="equation-section">
                        <h4>RESPIRATORY ALKALOSIS COMPENSATION</h4>
                        <p><strong>Acute:</strong> PaCO‚ÇÇ ‚Üì10 ‚Üí HCO‚ÇÉ ‚Üì2</p>
                        <p><strong>Chronic:</strong> PaCO‚ÇÇ ‚Üì10 ‚Üí HCO‚ÇÉ ‚Üì4-5</p>
                        <p><strong>Interpretation:</strong></p>
                        <ul>
                            <li>Matches acute ‚Üí acute respiratory alkalosis</li>
                            <li>Matches chronic ‚Üí chronic respiratory alkalosis</li>
                            <li>Less than expected ‚Üí concurrent metabolic alkalosis</li>
                            <li>More than expected ‚Üí concurrent metabolic acidosis</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-full btn-secondary" onclick="hideCompendium()" style="margin-top: 20px;">‚Üê Back</button>
            </div>
        </div>

        <!-- Placement Test Screen -->
        <div id="placementScreen" class="hidden">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 10px;">üìù Placement Test</h2>
                <p style="margin: 15px 0; color: #666; text-align: center;">
                    Answer 5 questions to assess your ABG interpretation skills.<br>
                    We'll unlock the appropriate levels based on your performance.
                </p>
                <div id="placementQuestionContainer" style="margin-top: 30px;"></div>
            </div>
        </div>

        <!-- Level Selection Screen -->
        <div id="levelSelectScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Select Your Level</h2>
                <div class="level-select" id="levelButtons"></div>
            </div>
        </div>

        <!-- Progress Screen -->
        <div id="progressScreen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 15px;">Level <span id="currentLevelDisplay">1</span> Progress</h2>
                
                <div class="progress-section">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span><strong>Case <span id="caseNumber">1</span>/15</strong></span>
                        <span><strong>Question <span id="questionNumber">-</span>/5</strong></span>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%">
                            <span id="progressText">0%</span>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <strong>Score</strong><br><span id="score">0/0</span>
                        </div>
                        <div class="stat-item">
                            <strong>Accuracy</strong><br><span id="accuracy">0%</span>
                        </div>
                        <div class="stat-item" id="passStatus" style="color: #ff9800;">
                            <strong>Required</strong><br>80%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Case Start Screen -->
        <div id="startCaseScreen" class="hidden">
            <div class="card">
                <div style="text-align: center; padding: 20px;">
                    <h2 style="margin-bottom: 20px;">Ready for Case <span id="startCaseNum">1</span>?</h2>
                    <p style="margin-bottom: 25px; color: #666;">Click below to begin the case presentation</p>
                    <button class="btn btn-primary" onclick="startCase()">Start Case</button>
                </div>
            </div>
        </div>

        <!-- Active Case Screen -->
        <div id="caseScreen" class="hidden">
            <div class="card">
                <div class="scenario-box">
                    <h3 style="margin-bottom: 15px;">üìã Scenario</h3>
                    <p id="scenarioText"></p>
                </div>

                <div class="abg-values" id="abgValues"></div>

                <div class="equation-box" id="relevantEquations">
                    <h4>üìê Relevant Equations for This Level</h4>
                    <div id="equationContent"></div>
                </div>

                <div class="question-box">
                    <h3>Question <span id="currentQ"></span>/5</h3>
                    <p id="questionText" style="font-size: 18px; margin: 15px 0; font-weight: bold;"></p>
                    
                    <div id="mcqChoices"></div>
                    
                    <div id="feedback" class="hidden"></div>
                    
                    <button class="btn btn-secondary btn-full hidden" id="nextBtn" onclick="nextQuestion()">Next Question ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Case Summary Screen -->
        <div id="caseSummaryScreen" class="hidden">
            <div id="caseSummaryContent"></div>
        </div>

        <!-- Level Complete Screen -->
        <div id="levelCompleteScreen" class="hidden">
            <div class="card">
                <div id="levelCompleteContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let gameState = {
            unlockedLevels: [1],
            currentLevel: 1,
            currentCase: 0,
            currentQuestion: 0,
            levelScores: {},
            totalScore: { correct: 0, total: 0 },
            weaknesses: [],
            selectedChoice: null
        };

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('abgTutorProgress');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        // Save progress
        function saveProgress() {
            localStorage.setItem('abgTutorProgress', JSON.stringify(gameState));
        }

        // Initialize
        loadProgress();

        // Complete ABG Case Database - MCQ Format
        // Each question has: q (question text), choices (array), correct (letter A-D), category
        const allCases = {
            1: [ // Level 1 - Basic ABG Interpretation (15 cases)
                {
                    scenario: "A 22-year-old man presents with hyperventilation during a panic episode.",
                    abg: { pH: 7.52, PaCO2: 28, HCO3: 23, Na: 140, Cl: 102, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, over-compensated", "No, under-compensated"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 55-year-old woman with severe vomiting for 2 days arrives weak and dehydrated.",
                    abg: { pH: 7.49, PaCO2: 47, HCO3: 31, Na: 138, Cl: 92, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 71-year-old COPD patient presents with drowsiness and shallow breathing.",
                    abg: { pH: 7.29, PaCO2: 60, HCO3: 28, Na: 140, Cl: 100, Lactate: 1.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A young man with severe diarrhea for 24 hours arrives lethargic.",
                    abg: { pH: 7.31, PaCO2: 33, HCO3: 16, Na: 136, Cl: 108, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 28-year-old woman presents after intense exercise and hyperventilation.",
                    abg: { pH: 7.48, PaCO2: 30, HCO3: 22, Na: 141, Cl: 103, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 60-year-old man with renal failure arrives confused.",
                    abg: { pH: 7.30, PaCO2: 38, HCO3: 19, Na: 138, Cl: 102, Lactate: 1.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "B", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 45-year-old patient overdosed on opioids with shallow breathing.",
                    abg: { pH: 7.25, PaCO2: 58, HCO3: 24, Na: 139, Cl: 100, Lactate: 0.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "C", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 19-year-old woman presents with panic-induced rapid breathing.",
                    abg: { pH: 7.55, PaCO2: 26, HCO3: 22, Na: 142, Cl: 104, Lactate: 0.6 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "C", category: "compensation" }
                    ]
                },
                {
                    scenario: "A patient with uncontrolled diabetes arrives tachypneic.",
                    abg: { pH: 7.33, PaCO2: 29, HCO3: 14, Na: 137, Cl: 100, Lactate: 3.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 70-year-old heart failure patient presents with fatigue and CO‚ÇÇ retention.",
                    abg: { pH: 7.32, PaCO2: 52, HCO3: 26, Na: 140, Cl: 101, Lactate: 1.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "Partial compensation", "Acute, no compensation"], correct: "B", category: "compensation" }
                    ]
                },
                {
                    scenario: "A young adult after prolonged vomiting feels dizzy and weak.",
                    abg: { pH: 7.47, PaCO2: 46, HCO3: 29, Na: 138, Cl: 94, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "B", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 36-year-old man presents with diarrhea and dehydration.",
                    abg: { pH: 7.30, PaCO2: 32, HCO3: 15, Na: 136, Cl: 109, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "B", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A patient with pneumonia arrives hypoventilating.",
                    abg: { pH: 7.28, PaCO2: 55, HCO3: 26, Na: 138, Cl: 101, Lactate: 1.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "Partial compensation", "Acute, no compensation"], correct: "B", category: "compensation" }
                    ]
                },
                {
                    scenario: "A marathon runner collapses with rapid breathing and lightheadedness.",
                    abg: { pH: 7.51, PaCO2: 27, HCO3: 21, Na: 141, Cl: 104, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "Which component is abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "A", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate compensation", "No, mixed disorder present", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                },
                {
                    scenario: "A 65-year-old man with advanced COPD arrives exhausted and retaining CO‚ÇÇ.",
                    abg: { pH: 7.34, PaCO2: 58, HCO3: 31, Na: 139, Cl: 100, Lactate: 1.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "Which components are abnormal?", choices: ["PaCO‚ÇÇ only", "HCO‚ÇÉ only", "Both PaCO‚ÇÇ and HCO‚ÇÉ", "Neither"], correct: "C", category: "driver identification" },
                        { q: "Which component matches the pH direction?", choices: ["PaCO‚ÇÇ", "HCO‚ÇÉ", "Both", "Neither"], correct: "A", category: "driver identification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "A", category: "primary disorder" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, chronic compensation", "Partial compensation", "Acute, no compensation"], correct: "A", category: "compensation" }
                    ]
                }
            ],
            2: [ // Level 2 - Anion Gap Calculation (15 cases)
                {
                    scenario: "A 54-year-old man with alcohol binge presents confused and tachypneic.",
                    abg: { pH: 7.28, PaCO2: 29, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap (AG = Na ‚àí (Cl + HCO‚ÇÉ))", choices: ["15 mEq/L", "20 mEq/L", "27 mEq/L", "32 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal range", "Cannot determine"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (high anion gap)", "NAGMA (normal anion gap)", "Neither", "Mixed picture"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A young woman with severe diarrhea for 2 days arrives lethargic.",
                    abg: { pH: 7.29, PaCO2: 31, HCO3: 15, Na: 137, Cl: 108, Lactate: 1.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "14 mEq/L", "18 mEq/L", "22 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Borderline/Mildly elevated", "Normal range", "Low"], correct: "B", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (bicarbonate loss)", "Mixed", "Respiratory only"], correct: "B", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A diabetic patient arrives with Kussmaul breathing.",
                    abg: { pH: 7.21, PaCO2: 24, HCO3: 10, Na: 138, Cl: 98, Lactate: 6.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "25 mEq/L", "30 mEq/L", "35 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, severely elevated", "Mildly elevated", "Normal range", "Cannot determine"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (likely DKA)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A septic patient develops sudden hypotension.",
                    abg: { pH: 7.25, PaCO2: 30, HCO3: 12, Na: 140, Cl: 102, Lactate: 5.1 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "22 mEq/L", "26 mEq/L", "30 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal range", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Neither", "Respiratory"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A patient with profuse vomiting has mild dehydration.",
                    abg: { pH: 7.46, PaCO2: 47, HCO3: 30, Na: 139, Cl: 95, Lactate: 0.7 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "C", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "D", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "14 mEq/L", "18 mEq/L", "22 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "No, normal range", "Low", "Cannot determine"], correct: "B", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA", "Neither (no acidosis present)", "Mixed"], correct: "C", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "An elderly man with renal failure presents confused.",
                    abg: { pH: 7.26, PaCO2: 36, HCO3: 15, Na: 138, Cl: 100, Lactate: 2.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["15 mEq/L", "19 mEq/L", "23 mEq/L", "27 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal range", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (uremic acidosis)", "NAGMA", "Mixed", "Neither"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A young adult overdosed on salicylates is tachypneic and nauseated.",
                    abg: { pH: 7.39, PaCO2: 25, HCO3: 15, Na: 140, Cl: 102, Lactate: 3.5 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal/Borderline", "Alkalemia"], correct: "B", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Mixed disorder", "Metabolic acidosis", "Metabolic alkalosis"], correct: "B", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["15 mEq/L", "19 mEq/L", "23 mEq/L", "27 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (salicylate toxicity)", "NAGMA", "Neither", "Pure respiratory"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A 65-year-old man with CHF arrives in mild shock.",
                    abg: { pH: 7.31, PaCO2: 32, HCO3: 16, Na: 137, Cl: 101, Lactate: 2.2 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "20 mEq/L", "24 mEq/L", "28 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "Normal", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Mixed", "Neither"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A patient with ileostomy output >2 L/day arrives fatigued.",
                    abg: { pH: 7.33, PaCO2: 34, HCO3: 17, Na: 139, Cl: 110, Lactate: 0.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal range", "Low"], correct: "C", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (GI bicarbonate loss)", "Neither", "Mixed"], correct: "B", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A trauma patient arrives with tissue hypoperfusion.",
                    abg: { pH: 7.22, PaCO2: 28, HCO3: 12, Na: 138, Cl: 100, Lactate: 5.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "22 mEq/L", "26 mEq/L", "30 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A 72-year-old patient with chronic diarrhea arrives weak.",
                    abg: { pH: 7.30, PaCO2: 33, HCO3: 18, Na: 140, Cl: 112, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["6 mEq/L", "10 mEq/L", "14 mEq/L", "18 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal range", "Low"], correct: "C", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (chronic diarrhea)", "Neither", "Mixed"], correct: "B", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A patient with metformin toxicity and vomiting arrives drowsy.",
                    abg: { pH: 7.18, PaCO2: 26, HCO3: 11, Na: 137, Cl: 99, Lactate: 6.4 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, severely elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (metformin toxicity)", "NAGMA", "Neither", "Mixed"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A dehydrated elderly woman presents with dizziness and low intake.",
                    abg: { pH: 7.36, PaCO2: 38, HCO3: 21, Na: 142, Cl: 104, Lactate: 0.8 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "B", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Normal ABG"], correct: "D", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["13 mEq/L", "17 mEq/L", "21 mEq/L", "25 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline/Mildly elevated", "Normal", "Low"], correct: "B", category: "AG interpretation" },
                        { q: "Classification?", choices: ["HAGMA", "NAGMA", "Neither (pH normal)", "Mixed"], correct: "C", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A patient with AKI following sepsis deterioration arrives hypotensive.",
                    abg: { pH: 7.24, PaCO2: 30, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.9 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, significantly elevated", "Mildly elevated", "Normal", "Low"], correct: "A", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA (lactic acidosis + AKI)", "NAGMA", "Neither", "Pure respiratory"], correct: "A", category: "AG interpretation" }
                    ]
                },
                {
                    scenario: "A young man with cholera-like diarrhea arrives exhausted.",
                    abg: { pH: 7.32, PaCO2: 35, HCO3: 18, Na: 136, Cl: 113, Lactate: 1.0 },
                    questions: [
                        { q: "What is the pH status?", choices: ["Acidemia", "Normal", "Alkalemia"], correct: "A", category: "pH classification" },
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["3 mEq/L", "5 mEq/L", "9 mEq/L", "13 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Is the anion gap elevated?", choices: ["Yes, elevated", "Borderline", "No, normal/low", "Cannot determine"], correct: "C", category: "AG interpretation" },
                        { q: "Is this HAGMA or NAGMA?", choices: ["HAGMA", "NAGMA (severe diarrhea)", "Neither", "Mixed"], correct: "B", category: "AG interpretation" }
                    ]
                }
            ],  
            3: [ // Level 3 - Winter's Formula (15 cases)
                {
                    scenario: "A diabetic patient presents with deep, rapid breathing and dehydration.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 10, Na: 138, Cl: 100, Lactate: 5.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula: 1.5 √ó HCO‚ÇÉ + 8 ¬± 2", choices: ["17-21 mmHg", "19-23 mmHg", "21-25 mmHg", "23-27 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 22 mmHg. Does this fall within the expected range?", choices: ["Yes, within expected range", "No, below expected range", "No, above expected range"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate compensation", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A septic shock patient arrives tachypneic with cold extremities.",
                    abg: { pH: 7.24, PaCO2: 25, HCO3: 11, Na: 140, Cl: 102, Lactate: 6.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["19.5-23.5 mmHg", "22.5-26.5 mmHg", "24.5-28.5 mmHg", "26.5-30.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 25 mmHg. Is this within range?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A 70-year-old with renal failure arrives lethargic.",
                    abg: { pH: 7.26, PaCO2: 28, HCO3: 12, Na: 138, Cl: 100, Lactate: 3.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["22-26 mmHg", "24-28 mmHg", "26-30 mmHg", "28-32 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 28 mmHg. Is this adequate?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation appropriate?", choices: ["Yes, appropriate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No hidden disorder", "Yes, coexisting respiratory acidosis", "Yes, coexisting respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A metformin toxicity case presents with vomiting and altered mentation.",
                    abg: { pH: 7.20, PaCO2: 23, HCO3: 10, Na: 137, Cl: 99, Lactate: 7.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["17-21 mmHg", "19-23 mmHg", "21-25 mmHg", "23-27 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 23 mmHg. Assessment?", choices: ["Within expected range", "Below expected", "Above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, appropriate compensation", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis present", "Yes, respiratory alkalosis present"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A trauma patient with blood loss arrives pale and hypotensive.",
                    abg: { pH: 7.29, PaCO2: 30, HCO3: 14, Na: 139, Cl: 101, Lactate: 3.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["25-29 mmHg", "27-31 mmHg", "29-33 mmHg", "31-35 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 30 mmHg. Is this appropriate?", choices: ["Yes, within expected range", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation adequate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a concomitant respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A malnourished alcoholic arrives confused and tachypneic.",
                    abg: { pH: 7.31, PaCO2: 28, HCO3: 14, Na: 140, Cl: 102, Lactate: 4.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["25-29 mmHg", "27-31 mmHg", "29-33 mmHg", "31-35 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 28 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the respiratory compensation appropriate?", choices: ["Yes", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A young adult with prolonged seizures arrives acidotic.",
                    abg: { pH: 7.27, PaCO2: 32, HCO3: 15, Na: 138, Cl: 100, Lactate: 5.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["26.5-30.5 mmHg", "28.5-32.5 mmHg", "30.5-34.5 mmHg", "32.5-36.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 32 mmHg. Is this within range?", choices: ["Yes, appropriate", "No, below range", "No, above range"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A dehydrated patient with diarrhea appears weak and tachypneic.",
                    abg: { pH: 7.33, PaCO2: 30, HCO3: 16, Na: 140, Cl: 108, Lactate: 1.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["28-32 mmHg", "30-34 mmHg", "32-36 mmHg", "34-38 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 30 mmHg. Assessment?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with early septic shock is hyperventilating.",
                    abg: { pH: 7.36, PaCO2: 29, HCO3: 17, Na: 139, Cl: 101, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Mixed disorder"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["31.5-35.5 mmHg", "33.5-37.5 mmHg", "35.5-39.5 mmHg", "37.5-41.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 29 mmHg. Is this appropriate?", choices: ["No, below expected (over-compensated)", "Yes, within expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate or excessive?", choices: ["Excessive/Over-compensated", "Adequate", "Insufficient"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["Yes, concomitant respiratory alkalosis", "No", "Yes, respiratory acidosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "An elderly woman with uremia presents with Kussmaul breathing.",
                    abg: { pH: 7.25, PaCO2: 27, HCO3: 12, Na: 138, Cl: 102, Lactate: 4.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["22-26 mmHg", "24-28 mmHg", "26-30 mmHg", "28-32 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 27 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with lactic acidosis due to hypoperfusion arrives cold and sweaty.",
                    abg: { pH: 7.21, PaCO2: 26, HCO3: 10, Na: 140, Cl: 100, Lactate: 6.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["19-23 mmHg", "21-25 mmHg", "23-27 mmHg", "25-29 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 26 mmHg. Is this within range?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, appropriate", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with pancreatitis presents with rapid breathing.",
                    abg: { pH: 7.28, PaCO2: 31, HCO3: 15, Na: 137, Cl: 100, Lactate: 2.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["26.5-30.5 mmHg", "28.5-32.5 mmHg", "30.5-34.5 mmHg", "32.5-36.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 31 mmHg. Is this appropriate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "An elderly man with chronic kidney disease presents fatigued and dyspneic.",
                    abg: { pH: 7.32, PaCO2: 33, HCO3: 17, Na: 138, Cl: 102, Lactate: 1.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["29.5-33.5 mmHg", "31.5-35.5 mmHg", "33.5-37.5 mmHg", "35.5-39.5 mmHg"], correct: "C", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 33 mmHg. Is this adequate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation appropriate?", choices: ["Yes, appropriate", "No, insufficient", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A patient with toxic alcohol ingestion arrives disoriented.",
                    abg: { pH: 7.19, PaCO2: 20, HCO3: 9, Na: 140, Cl: 98, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["17.5-21.5 mmHg", "19.5-23.5 mmHg", "21.5-25.5 mmHg", "23.5-27.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 20 mmHg. Is this within range?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, under-compensated", "No, over-compensated"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                },
                {
                    scenario: "A post-arrest patient has poor perfusion and deep acidosis.",
                    abg: { pH: 7.17, PaCO2: 24, HCO3: 9, Na: 138, Cl: 100, Lactate: 7.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate expected PaCO‚ÇÇ using Winter's formula", choices: ["17.5-21.5 mmHg", "19.5-23.5 mmHg", "21.5-25.5 mmHg", "23.5-27.5 mmHg"], correct: "B", category: "Winter formula" },
                        { q: "The actual PaCO‚ÇÇ is 24 mmHg. Is this appropriate?", choices: ["Yes, within expected", "No, below expected", "No, above expected"], correct: "A", category: "respiratory compensation" },
                        { q: "Is the compensation adequate?", choices: ["Yes, adequate", "No, inadequate", "No, excessive"], correct: "A", category: "respiratory compensation" },
                        { q: "Is there a hidden respiratory disorder?", choices: ["No", "Yes, respiratory acidosis", "Yes, respiratory alkalosis"], correct: "A", category: "respiratory compensation" }
                    ]
                }
            ],  
            4: [ // Level 4 - Adjusted Bicarbonate (15 cases)
                {
                    scenario: "A metformin toxicity patient presents severely acidotic and tachypneic.",
                    abg: { pH: 7.18, PaCO2: 24, HCO3: 11, Na: 138, Cl: 100, Lactate: 7.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap: AG = Na ‚àí (Cl + HCO‚ÇÉ)", choices: ["20 mEq/L", "23 mEq/L", "27 mEq/L", "31 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "How do you classify the adjusted HCO‚ÇÉ?", choices: ["<18 (NAGMA present)", "18-30 (Pure HAGMA)", ">30 (Hidden metabolic alkalosis)", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, concurrent NAGMA", "Yes, concurrent metabolic alkalosis", "Mixed picture"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A vomiting diabetic patient arrives dehydrated with abdominal pain.",
                    abg: { pH: 7.29, PaCO2: 28, HCO3: 14, Na: 139, Cl: 97, Lactate: 3.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "How do you classify the adjusted HCO‚ÇÉ?", choices: ["<18 (NAGMA present)", "18-30 (Pure HAGMA)", ">30 (Hidden metabolic alkalosis)", "Normal"], correct: "C", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, concurrent NAGMA", "Yes, concurrent metabolic alkalosis (from vomiting)", "Cannot determine"], correct: "C", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A CKD patient with missed dialysis presents weak and dyspneic.",
                    abg: { pH: 7.24, PaCO2: 29, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18 (additional NAGMA)", "18-30 (Pure HAGMA)", ">30 (metabolic alkalosis)", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA (uremic acidosis)", "Yes, NAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A sepsis patient becomes acidotic despite IV fluids.",
                    abg: { pH: 7.20, PaCO2: 26, HCO3: 11, Na: 138, Cl: 102, Lactate: 6.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis (HAGMA)", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A dehydrated alcoholic arrives tachypneic and confused.",
                    abg: { pH: 7.33, PaCO2: 27, HCO3: 15, Na: 140, Cl: 102, Lactate: 3.9 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["17 mEq/L", "20 mEq/L", "23 mEq/L", "26 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Normal"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure alcoholic ketoacidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed disorder"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A patient with prolonged diarrhea presents acidotic and tired.",
                    abg: { pH: 7.30, PaCO2: 32, HCO3: 16, Na: 136, Cl: 112, Lactate: 1.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["4 mEq/L", "8 mEq/L", "12 mEq/L", "16 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18 (Low - pure NAGMA)", "18-30", ">30", "Normal"], correct: "A", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure NAGMA from GI losses", "Yes, HAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives with visual disturbances.",
                    abg: { pH: 7.12, PaCO2: 22, HCO3: 9, Na: 139, Cl: 98, Lactate: 10.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "28 mEq/L", "32 mEq/L", "36 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure toxic alcohol HAGMA", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A patient in early renal shutdown becomes progressively acidotic.",
                    abg: { pH: 7.26, PaCO2: 31, HCO3: 15, Na: 140, Cl: 103, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "19 mEq/L", "22 mEq/L", "25 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure HAGMA", "Yes, NAGMA", "Yes, metabolic alkalosis", "Cannot determine"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A lactic acidosis patient deteriorates during septic shock.",
                    abg: { pH: 7.19, PaCO2: 27, HCO3: 12, Na: 138, Cl: 101, Lactate: 7.3 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Normal"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A vomiting patient with starvation ketosis presents fatigued.",
                    abg: { pH: 7.38, PaCO2: 30, HCO3: 17, Na: 139, Cl: 98, Lactate: 2.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Normal/Compensated", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Borderline high"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, compensated ketoacidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Yes, mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A pancreatitis patient becomes acidotic and tachypneic.",
                    abg: { pH: 7.25, PaCO2: 28, HCO3: 13, Na: 138, Cl: 100, Lactate: 5.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["19 mEq/L", "22 mEq/L", "25 mEq/L", "28 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure lactic acidosis from pancreatitis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A severe hypoperfusion patient with cool extremities arrives.",
                    abg: { pH: 7.16, PaCO2: 24, HCO3: 10, Na: 140, Cl: 101, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure severe lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A DKA patient partially treated arrives still acidotic.",
                    abg: { pH: 7.24, PaCO2: 31, HCO3: 14, Na: 137, Cl: 101, Lactate: 4.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["16 mEq/L", "19 mEq/L", "22 mEq/L", "25 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Low"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, resolving DKA (pure HAGMA)", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A renal tubular acidosis patient presents with fatigue.",
                    abg: { pH: 7.30, PaCO2: 33, HCO3: 17, Na: 138, Cl: 112, Lactate: 0.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["5 mEq/L", "9 mEq/L", "13 mEq/L", "17 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)", choices: ["11 mEq/L", "14 mEq/L", "17 mEq/L", "20 mEq/L"], correct: "B", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18 (Low - pure NAGMA)", "18-30", ">30", "Normal"], correct: "A", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure RTA (NAGMA)", "Yes, HAGMA present", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                },
                {
                    scenario: "A post-arrest patient presents with severe global hypoxia.",
                    abg: { pH: 7.15, PaCO2: 23, HCO3: 9, Na: 139, Cl: 100, Lactate: 9.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate adjusted HCO‚ÇÉ", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "adjusted bicarbonate" },
                        { q: "Classification of adjusted HCO‚ÇÉ?", choices: ["<18", "18-30 (Pure HAGMA)", ">30", "Cannot determine"], correct: "B", category: "adjusted bicarbonate interpretation" },
                        { q: "Is there a hidden metabolic disorder?", choices: ["No, pure post-arrest lactic acidosis", "Yes, NAGMA", "Yes, metabolic alkalosis", "Mixed"], correct: "A", category: "hidden metabolic disorder" }
                    ]
                }
            ],
            5: [ // Level 5 - Delta Ratio & Mixed Disorders (15 cases)
                {
                    scenario: "A DKA patient with vomiting arrives dehydrated and tachypneic.",
                    abg: { pH: 7.22, PaCO2: 26, HCO3: 12, Na: 138, Cl: 99, Lactate: 6.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio = (AG ‚àí 12) √∑ (24 ‚àí HCO‚ÇÉ)", choices: ["0.8", "1.25", "1.8", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "How do you interpret the delta ratio?", choices: ["<1 (HAGMA + NAGMA)", "1-2 (Pure HAGMA)", ">2 (HAGMA + metabolic alkalosis)", "Cannot determine"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (DKA)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives severely confused.",
                    abg: { pH: 7.09, PaCO2: 18, HCO3: 6, Na: 140, Cl: 100, Lactate: 12.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["28 mEq/L", "31 mEq/L", "34 mEq/L", "37 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.22", "1.7", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "How do you interpret the delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (toxic alcohol)", "HAGMA + NAGMA", "HAGMA + respiratory alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with septic shock hyperventilates rapidly.",
                    abg: { pH: 7.28, PaCO2: 20, HCO3: 9, Na: 138, Cl: 101, Lactate: 8.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Mixed disorder", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["22 mEq/L", "25 mEq/L", "28 mEq/L", "31 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.07", "1.5", "2.1"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "HAGMA + concurrent respiratory alkalosis", "HAGMA + NAGMA", "Triple disorder"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A vomiting diabetic arrives with mixed ketoacidosis and dehydration.",
                    abg: { pH: 7.31, PaCO2: 28, HCO3: 14, Na: 139, Cl: 96, Lactate: 4.2 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["1.2", "1.7", "2.2", "2.7"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "High"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (DKA)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A renal failure patient presents with acidosis and vomiting.",
                    abg: { pH: 7.27, PaCO2: 30, HCO3: 13, Na: 140, Cl: 100, Lactate: 4.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["21 mEq/L", "24 mEq/L", "27 mEq/L", "30 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.36", "1.8", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (uremic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A COPD patient with lactic acidosis presents hypoventilating.",
                    abg: { pH: 7.25, PaCO2: 54, HCO3: 24, Na: 138, Cl: 98, Lactate: 5.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Pure respiratory acidosis", "Pure metabolic acidosis", "Mixed: Respiratory + Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["10 mEq/L", "13 mEq/L", "16 mEq/L", "19 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.5", "1.0", "1.5", "2.0"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (borderline)", ">2", "Very low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure respiratory acidosis", "HAGMA with concurrent respiratory acidosis", "Pure HAGMA", "NAGMA"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A starvation ketosis patient also has severe diarrhea.",
                    abg: { pH: 7.33, PaCO2: 30, HCO3: 16, Na: 139, Cl: 111, Lactate: 2.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (AG normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure NAGMA (GI losses)", "HAGMA + NAGMA", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A hypothermic shock patient arrives with severe AG elevation.",
                    abg: { pH: 7.14, PaCO2: 26, HCO3: 10, Na: 140, Cl: 100, Lactate: 10.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.9", "1.29", "1.8", "2.3"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with alcoholic ketoacidosis and vomiting arrives tachypneic.",
                    abg: { pH: 7.30, PaCO2: 28, HCO3: 14, Na: 138, Cl: 98, Lactate: 5.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["20 mEq/L", "23 mEq/L", "26 mEq/L", "29 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["1.0", "1.4", "1.9", "2.4"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (alcoholic ketoacidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A multi-organ failure patient has profound acidemia.",
                    abg: { pH: 7.11, PaCO2: 24, HCO3: 8, Na: 139, Cl: 100, Lactate: 11.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["25 mEq/L", "28 mEq/L", "31 mEq/L", "34 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.19", "1.6", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (multi-organ lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with DKA + diarrhea is severely dehydrated.",
                    abg: { pH: 7.25, PaCO2: 27, HCO3: 12, Na: 136, Cl: 112, Lactate: 4.4 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (AG normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure NAGMA (hyperchloremic acidosis)", "HAGMA + NAGMA", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A toxic alcohol ingestion patient arrives hyperventilating.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 9, Na: 140, Cl: 102, Lactate: 9.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["23 mEq/L", "26 mEq/L", "29 mEq/L", "32 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.13", "1.6", "2.1"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Borderline"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (toxic alcohol + lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Triple disorder"], correct: "A", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A chronic CO2 retainer develops lactic acidosis from hypoperfusion.",
                    abg: { pH: 7.29, PaCO2: 60, HCO3: 28, Na: 138, Cl: 98, Lactate: 4.8 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Pure respiratory acidosis", "Pure metabolic acidosis", "Chronic respiratory acidosis (compensated)", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["8 mEq/L", "12 mEq/L", "16 mEq/L", "20 mEq/L"], correct: "B", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0 (AG normal)", "1.0", "1.5", "2.0"], correct: "A", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1 or N/A (normal AG)", "1-2", ">2", "Cannot calculate"], correct: "A", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Chronic respiratory acidosis (COPD)", "HAGMA + respiratory acidosis", "Metabolic alkalosis"], correct: "B", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A patient with metabolic alkalosis from vomiting develops sepsis.",
                    abg: { pH: 7.41, PaCO2: 30, HCO3: 19, Na: 140, Cl: 97, Lactate: 3.0 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory alkalosis", "Metabolic acidosis", "Mixed: metabolic alkalosis + acidosis", "Normal"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["18 mEq/L", "21 mEq/L", "24 mEq/L", "27 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["1.2", "1.8", "2.4", "3.0"], correct: "C", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2", ">2 (hidden metabolic alkalosis)", "Very high"], correct: "C", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA", "Pure metabolic alkalosis", "HAGMA + concurrent metabolic alkalosis", "Triple disorder"], correct: "C", category: "final mixed disorder" }
                    ]
                },
                {
                    scenario: "A cardiac arrest survivor arrives profoundly acidotic.",
                    abg: { pH: 7.08, PaCO2: 26, HCO3: 7, Na: 138, Cl: 100, Lactate: 12.5 },
                    questions: [
                        { q: "What is the primary disorder?", choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"], correct: "C", category: "primary disorder" },
                        { q: "Calculate the anion gap", choices: ["25 mEq/L", "28 mEq/L", "31 mEq/L", "34 mEq/L"], correct: "C", category: "AG calculation" },
                        { q: "Calculate delta ratio", choices: ["0.8", "1.12", "1.6", "2.2"], correct: "B", category: "delta ratio" },
                        { q: "Interpretation of delta ratio?", choices: ["<1", "1-2 (Pure HAGMA)", ">2", "Low"], correct: "B", category: "delta ratio interpretation" },
                        { q: "What is the final diagnosis?", choices: ["Pure HAGMA (post-arrest lactic acidosis)", "HAGMA + NAGMA", "HAGMA + metabolic alkalosis", "Mixed"], correct: "A", category: "final mixed disorder" }
                    ]
                }
            ]
        };

        // Track answers for each case
        let caseAnswers = [];

        // Show/hide screens
        function showScreen(screenId) {
            const screens = ['homeScreen', 'compendiumScreen', 'placementScreen', 'levelSelectScreen', 
                            'progressScreen', 'startCaseScreen', 'caseScreen', 'caseSummaryScreen', 'levelCompleteScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function goHome() {
            showScreen('homeScreen');
        }

        function showCompendium() {
            showScreen('compendiumScreen');
        }

        function hideCompendium() {
            showScreen('homeScreen');
        }

        // Placement Test State
        let placementTest = {
            questions: [],
            currentQuestion: 0,
            answers: [],
            score: 0
        };

        function showPlacementTest() {
            // Select one representative question from each level
            placementTest.questions = [
                // Level 1 question - Basic pH
                {
                    level: 1,
                    scenario: "A COPD patient arrives confused and somnolent.",
                    abg: { pH: 7.28, PaCO2: 65, HCO3: 30 },
                    question: "What is the primary disorder?",
                    choices: ["Respiratory acidosis", "Respiratory alkalosis", "Metabolic acidosis", "Metabolic alkalosis"],
                    correct: "A"
                },
                // Level 2 question - Anion Gap
                {
                    level: 2,
                    scenario: "A patient with severe diarrhea for 3 days presents weak.",
                    abg: { pH: 7.32, PaCO2: 34, HCO3: 18, Na: 138, Cl: 110 },
                    question: "Calculate the anion gap: AG = Na ‚àí (Cl + HCO‚ÇÉ)",
                    choices: ["6 mEq/L", "10 mEq/L", "14 mEq/L", "18 mEq/L"],
                    correct: "B"
                },
                // Level 3 question - Winter's Formula
                {
                    level: 3,
                    scenario: "A DKA patient arrives tachypneic with fruity breath.",
                    abg: { pH: 7.18, PaCO2: 22, HCO3: 10 },
                    question: "Calculate expected PaCO‚ÇÇ using Winter's formula: 1.5 √ó HCO‚ÇÉ + 8 ¬± 2",
                    choices: ["15-19 mmHg", "19-23 mmHg", "23-27 mmHg", "27-31 mmHg"],
                    correct: "B"
                },
                // Level 4 question - Adjusted Bicarbonate
                {
                    level: 4,
                    scenario: "A vomiting diabetic patient with DKA arrives dehydrated.",
                    abg: { pH: 7.29, PaCO2: 28, HCO3: 14, Na: 139, Cl: 97 },
                    question: "Calculate adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12). First, AG = 139 - (97 + 14) = 28. Then adjusted HCO‚ÇÉ = ?",
                    choices: ["24 mEq/L", "27 mEq/L", "30 mEq/L", "33 mEq/L"],
                    correct: "C"
                },
                // Level 5 question - Delta Ratio
                {
                    level: 5,
                    scenario: "A patient with metabolic alkalosis from vomiting develops sepsis.",
                    abg: { pH: 7.41, PaCO2: 30, HCO3: 19, Na: 140, Cl: 97 },
                    question: "Calculate delta ratio = (AG ‚àí 12) √∑ (24 ‚àí HCO‚ÇÉ). AG = 140 - (97 + 19) = 24. Delta ratio = ?",
                    choices: ["1.2", "1.8", "2.4", "3.0"],
                    correct: "C"
                }
            ];
            
            placementTest.currentQuestion = 0;
            placementTest.answers = [];
            placementTest.score = 0;
            
            showScreen('placementScreen');
            loadPlacementQuestion();
        }
        
        function loadPlacementQuestion() {
            const q = placementTest.questions[placementTest.currentQuestion];
            const container = document.getElementById('placementQuestionContainer');
            
            const progress = Math.round(((placementTest.currentQuestion) / placementTest.questions.length) * 100);
            
            container.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; font-size: 18px;">üìù Placement Test</h3>
                        <span style="background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold;">
                            Question ${placementTest.currentQuestion + 1}/5
                        </span>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 15px;">
                        <div style="background: white; height: 100%; width: ${progress}%; transition: width 0.3s;"></div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px; font-size: 13px; font-weight: 600;">
                        Level ${q.level} Assessment
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; border-left: 5px solid #667eea;">
                    <h3 style="color: #333; margin: 0 0 15px 0; font-size: 16px; line-height: 1.6;">
                        üìã ${q.scenario}
                    </h3>
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="color: #667eea; font-weight: bold; margin-bottom: 10px; font-size: 15px;">
                            üî¨ ABG Values:
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 14px;">
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>pH:</strong> ${q.abg.pH}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>PaCO‚ÇÇ:</strong> ${q.abg.PaCO2}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>HCO‚ÇÉ:</strong> ${q.abg.HCO3}
                            </div>
                            ${q.abg.Na ? `
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>Na:</strong> ${q.abg.Na}
                            </div>
                            <div style="background: #f0f4ff; padding: 10px; border-radius: 8px; text-align: center;">
                                <strong>Cl:</strong> ${q.abg.Cl}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <div style="color: #667eea; font-weight: bold; margin-bottom: 15px; font-size: 16px;">
                        ‚ùì Question:
                    </div>
                    <p style="font-size: 16px; font-weight: 600; color: #333; line-height: 1.6; margin: 0;">
                        ${q.question}
                    </p>
                </div>
                
                <div id="placementChoices" style="display: flex; flex-direction: column; gap: 12px;"></div>
            `;
            
            const choicesDiv = document.getElementById('placementChoices');
            q.choices.forEach((choice, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.style.cssText = 'background: white; border: 3px solid #e0e0e0; padding: 18px 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; font-size: 15px; text-align: left; display: flex; align-items: center; gap: 15px;';
                btn.innerHTML = `
                    <span style="background: #667eea; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; flex-shrink: 0;">${letter}</span>
                    <span style="flex: 1; font-weight: 500; color: #333;">${choice}</span>
                `;
                btn.onmouseover = () => {
                    btn.style.borderColor = '#667eea';
                    btn.style.transform = 'translateX(5px)';
                    btn.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                };
                btn.onmouseout = () => {
                    btn.style.borderColor = '#e0e0e0';
                    btn.style.transform = 'translateX(0)';
                    btn.style.boxShadow = 'none';
                };
                btn.onclick = () => selectPlacementAnswer(letter);
                choicesDiv.appendChild(btn);
            });
        }
        
        function selectPlacementAnswer(answer) {
            const q = placementTest.questions[placementTest.currentQuestion];
            placementTest.answers.push(answer);
            
            if (answer === q.correct) {
                placementTest.score++;
            }
            
            placementTest.currentQuestion++;
            
            if (placementTest.currentQuestion < placementTest.questions.length) {
                loadPlacementQuestion();
            } else {
                showPlacementResults();
            }
        }
        
        function showPlacementResults() {
            const score = placementTest.score;
            const total = placementTest.questions.length;
            const percentage = (score / total) * 100;
            
            let startLevel = 1;
            let message = '';
            let unlockedText = '';
            
            if (percentage >= 80) {
                startLevel = 5;
                message = 'Outstanding! You have mastered all concepts.';
                unlockedText = 'All levels unlocked!';
                for (let i = 1; i <= 5; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 60) {
                startLevel = 4;
                message = 'Excellent! You have strong ABG interpretation skills.';
                unlockedText = 'Levels 1-4 unlocked!';
                for (let i = 1; i <= 4; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 40) {
                startLevel = 3;
                message = 'Good foundation! You understand basic concepts well.';
                unlockedText = 'Levels 1-3 unlocked!';
                for (let i = 1; i <= 3; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else if (percentage >= 20) {
                startLevel = 2;
                message = 'Decent start! You have basic knowledge.';
                unlockedText = 'Levels 1-2 unlocked!';
                for (let i = 1; i <= 2; i++) {
                    if (!gameState.unlockedLevels.includes(i)) {
                        gameState.unlockedLevels.push(i);
                    }
                }
            } else {
                startLevel = 1;
                message = 'Welcome! Let\'s build your foundation from the ground up.';
                unlockedText = 'Level 1 unlocked!';
                if (!gameState.unlockedLevels.includes(1)) {
                    gameState.unlockedLevels.push(1);
                }
            }
            
            saveProgress();
            
            const container = document.getElementById('placementQuestionContainer');
            container.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s ease;">
                        ${percentage >= 80 ? 'üèÜ' : percentage >= 60 ? 'üåü' : percentage >= 40 ? 'üëç' : percentage >= 20 ? 'üìö' : 'üéØ'}
                    </div>
                    
                    <h2 style="color: #667eea; margin-bottom: 30px; font-size: 28px;">Placement Test Complete!</h2>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 20px; margin-bottom: 30px; color: white; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
                        <div style="font-size: 16px; margin-bottom: 15px; opacity: 0.9;">Your Score</div>
                        <div style="font-size: 64px; font-weight: bold; margin-bottom: 10px;">
                            ${score}/${total}
                        </div>
                        <div style="font-size: 28px; font-weight: 600; margin-bottom: 20px;">
                            ${percentage.toFixed(0)}%
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 4px; border-radius: 2px; margin: 0 auto; max-width: 200px;">
                            <div style="background: white; height: 100%; width: ${percentage}%; border-radius: 2px;"></div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #667eea;">
                        <p style="font-size: 18px; line-height: 1.8; color: #333; margin-bottom: 20px;">
                            ${message}
                        </p>
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="color: #667eea; font-weight: bold; margin-bottom: 15px; font-size: 16px;">
                                ‚úÖ ${unlockedText}
                            </div>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
                                <div style="font-size: 15px; margin-bottom: 8px; opacity: 0.9;">You will start at:</div>
                                <div style="font-size: 42px; font-weight: bold;">
                                    Level ${startLevel}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startLevel(${startLevel})" style="font-size: 20px; padding: 18px 50px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        üöÄ Start Level ${startLevel}
                    </button>
                </div>
                
                <style>
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-20px); }
                    }
                </style>
            `;
        }

        function showLevelSelect() {
            showScreen('levelSelectScreen');
            renderLevelButtons();
        }

        function renderLevelButtons() {
            const container = document.getElementById('levelButtons');
            container.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const isUnlocked = gameState.unlockedLevels.includes(i);
                const score = gameState.levelScores[i] || { correct: 0, total: 0 };
                const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
                
                const btn = document.createElement('div');
                btn.className = `level-btn ${isUnlocked ? 'unlocked' : 'locked'}`;
                btn.innerHTML = `
                    <div>
                        <h3>Level ${i}</h3>
                        <p style="color: #666; margin-top: 5px;">
                            ${getLevelDescription(i)}
                        </p>
                        ${score.total > 0 ? `<p style="color: #4CAF50; margin-top: 5px;">Progress: ${percentage}%</p>` : ''}
                    </div>
                    ${isUnlocked ? '' : '<span class="lock-icon">üîí</span>'}
                `;
                
                if (isUnlocked) {
                    btn.onclick = () => startLevel(i);
                }
                
                container.appendChild(btn);
            }
        }

        function getLevelDescription(level) {
            const descriptions = {
                1: "Basic pH status, primary disorders, compensation",
                2: "Anion gap calculation and interpretation",
                3: "Winter's formula and respiratory compensation",
                4: "Adjusted bicarbonate and hidden disorders",
                5: "Delta ratio and complex mixed disorders"
            };
            return descriptions[level];
        }

        function startLevel(level) {
            // Check if level has cases
            if (allCases[level].length === 0) {
                alert(`Level ${level} is currently under development. Please select Level 1 for now.`);
                return;
            }
            
            // Reset to beginning of this level
            gameState.currentLevel = level;
            gameState.currentCase = 0;
            gameState.currentQuestion = 0;
            
            // Initialize level score if not exists
            if (!gameState.levelScores[level]) {
                gameState.levelScores[level] = { correct: 0, total: 0 };
            }
            
            saveProgress();
            showLevelProgress();
        }

        function showLevelProgress() {
            showScreen('progressScreen');
            updateProgress();
            setTimeout(() => {
                document.getElementById('startCaseNum').textContent = gameState.currentCase + 1;
                showScreen('startCaseScreen');
            }, 1500);
        }

        function startCase() {
            caseAnswers = [];
            gameState.currentQuestion = 0;
            
            console.log('=== Starting Case ===');
            console.log('Level:', gameState.currentLevel);
            console.log('Case:', gameState.currentCase);
            console.log('Total cases in level:', allCases[gameState.currentLevel].length);
            
            showScreen('caseScreen');
            loadCase();
            loadEquations();
            loadQuestion();
        }

        function loadCase() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            document.getElementById('scenarioText').textContent = caseData.scenario;
            document.getElementById('caseNumber').textContent = gameState.currentCase + 1;
            
            // Load ABG values
            const abgHTML = `
                <h3 style="margin-bottom: 15px;">üî¨ Laboratory Values</h3>
                <div class="abg-grid">
                    ${Object.entries(caseData.abg).map(([key, value]) => `
                        <div class="abg-item">
                            <strong>${key}</strong>
                            <span>${value}${getUnit(key)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('abgValues').innerHTML = abgHTML;
        }

        function getUnit(key) {
            const units = {
                'pH': '',
                'PaCO2': ' mmHg',
                'HCO3': ' mEq/L',
                'Na': ' mEq/L',
                'Cl': ' mEq/L',
                'Lactate': ' mmol/L'
            };
            return units[key] || '';
        }

        function loadEquations() {
            const level = gameState.currentLevel;
            let equations = '<div style="line-height: 1.8;"><strong>Normal Ranges:</strong> pH 7.35-7.45 | PaCO‚ÇÇ 35-45 | HCO‚ÇÉ 22-26</div>';
            
            if (level >= 2) {
                equations += '<h4>Anion Gap</h4><strong>AG = Na ‚àí (Cl + HCO‚ÇÉ)</strong><br>Corrected AG = AG + 2.5 √ó (4 ‚àí albumin)<br>Normal: 8-12 mEq/L';
            }
            if (level >= 3) {
                equations += '<h4>Winter\'s Formula</h4><strong>Expected PaCO‚ÇÇ = 1.5 √ó HCO‚ÇÉ + 8 ¬± 2</strong><br>(Use only for metabolic acidosis)';
            }
            if (level >= 3) {
                equations += '<h4>Metabolic Alkalosis Compensation</h4><strong>Expected PaCO‚ÇÇ = 40 + 0.7 √ó (HCO‚ÇÉ ‚àí 24) ¬± 5</strong>';
            }
            if (level >= 4) {
                equations += '<h4>Adjusted HCO‚ÇÉ</h4><strong>Adjusted HCO‚ÇÉ = HCO‚ÇÉ + (AG ‚àí 12)</strong><br>Interpretation: <18 (additional NAGMA), 18-30 (pure HAGMA), >30 (concurrent alkalosis)';
            }
            if (level >= 5) {
                equations += '<h4>Delta Ratio</h4><strong>ŒîRatio = (AG ‚àí 12) √∑ (24 ‚àí HCO‚ÇÉ)</strong><br>Interpretation: <1 (HAGMA+NAGMA), 1-2 (pure HAGMA), >2 (metabolic alkalosis)';
            }
            
            document.getElementById('equationContent').innerHTML = equations;
        }

        function loadQuestion() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            const question = caseData.questions[gameState.currentQuestion];
            
            document.getElementById('questionNumber').textContent = gameState.currentQuestion + 1;
            document.getElementById('currentQ').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionText').textContent = question.q;
            
            // Load MCQ choices
            const choicesHTML = question.choices.map((choice, index) => {
                const letter = String.fromCharCode(65 + index); // A, B, C, D
                return `
                    <div class="mcq-choice" onclick="selectChoice('${letter}')">
                        <div class="choice-letter">${letter}</div>
                        <div class="choice-text">${choice}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('mcqChoices').innerHTML = choicesHTML;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            gameState.selectedChoice = null;
        }

        function selectChoice(letter) {
            if (gameState.selectedChoice !== null) return; // Already answered
            
            gameState.selectedChoice = letter;
            
            // Highlight selected choice
            const choices = document.querySelectorAll('.mcq-choice');
            choices.forEach((choice, index) => {
                const choiceLetter = String.fromCharCode(65 + index);
                if (choiceLetter === letter) {
                    choice.classList.add('selected');
                }
            });
            
            // Submit answer automatically after selection
            setTimeout(() => submitAnswer(), 300);
        }

        function submitAnswer() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            const question = caseData.questions[gameState.currentQuestion];
            
            const correct = gameState.selectedChoice === question.correct;
            
            // Track this answer for case summary
            caseAnswers.push({
                correct: correct,
                userAnswer: gameState.selectedChoice,
                correctAnswer: question.correct,
                question: question.q
            });
            
            gameState.totalScore.total++;
            
            const feedback = document.getElementById('feedback');
            const choices = document.querySelectorAll('.mcq-choice');
            
            // Disable all choices
            choices.forEach(choice => choice.classList.add('disabled'));
            
            // Mark correct and incorrect
            choices.forEach((choice, index) => {
                const choiceLetter = String.fromCharCode(65 + index);
                if (choiceLetter === question.correct) {
                    choice.classList.add('correct');
                } else if (choiceLetter === gameState.selectedChoice) {
                    choice.classList.add('incorrect');
                }
            });
            
            if (correct) {
                gameState.totalScore.correct++;
                feedback.className = 'feedback feedback-correct';
                feedback.textContent = '‚úì Correct.';
            } else {
                feedback.className = 'feedback feedback-incorrect';
                feedback.textContent = `‚úó Incorrect. The correct answer is: ${question.correct}.`;
                gameState.weaknesses.push(question.category);
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');
            
            updateProgress();
            saveProgress();
        }

        function nextQuestion() {
            gameState.currentQuestion++;
            
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            if (gameState.currentQuestion < caseData.questions.length) {
                loadQuestion();
            } else {
                // Show case summary before moving to next case
                showCaseSummary();
            }
        }

        function showCaseSummary() {
            const cases = allCases[gameState.currentLevel];
            const caseData = cases[gameState.currentCase];
            
            const caseCorrect = caseAnswers.filter(a => a.correct).length;
            const caseTotal = caseAnswers.length;
            const casePercentage = Math.round((caseCorrect / caseTotal) * 100);
            
            // Initialize level score if needed
            if (!gameState.levelScores[gameState.currentLevel]) {
                gameState.levelScores[gameState.currentLevel] = { correct: 0, total: 0 };
            }
            
            gameState.levelScores[gameState.currentLevel].correct += caseCorrect;
            gameState.levelScores[gameState.currentLevel].total += caseTotal;
            
            const summaryHTML = `
                <div class="card">
                    <h2>Case ${gameState.currentCase + 1} Complete</h2>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 48px; font-weight: bold; color: ${casePercentage >= 80 ? '#4CAF50' : '#ff9800'};">
                            ${casePercentage}%
                        </div>
                        <p style="color: #666; margin-top: 10px;">
                            ${caseCorrect} out of ${caseTotal} correct
                        </p>
                    </div>
                    
                    <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3 style="margin-bottom: 15px;">Review:</h3>
                        ${caseAnswers.map((answer, index) => `
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                                <strong>Q${index + 1}:</strong> ${answer.correct ? '‚úì' : '‚úó'}
                                ${!answer.correct ? `<span style="color: #666;"> (Your answer: ${answer.userAnswer}, Correct: ${answer.correctAnswer})</span>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="continueToNextCase()">
                        ${gameState.currentCase < 14 ? 'Continue to Next Case ‚Üí' : 'Complete Level'}
                    </button>
                </div>
            `;
            
            document.getElementById('caseSummaryContent').innerHTML = summaryHTML;
            showScreen('caseSummaryScreen');
            saveProgress();
        }

        function continueToNextCase() {
            gameState.currentCase++;
            
            console.log('=== Continue to Next Case ===');
            console.log('New case number:', gameState.currentCase);
            
            const cases = allCases[gameState.currentLevel];
            console.log('Total cases available:', cases.length);
            
            if (gameState.currentCase < cases.length) {
                // More cases in this level
                console.log('Moving to case', gameState.currentCase + 1);
                document.getElementById('startCaseNum').textContent = gameState.currentCase + 1;
                showScreen('progressScreen');
                updateProgress();
                setTimeout(() => {
                    showScreen('startCaseScreen');
                }, 1500);
            } else {
                // Level complete
                console.log('Level complete!');
                showLevelComplete();
            }
        }

        function showLevelComplete() {
            const score = gameState.levelScores[gameState.currentLevel];
            const percentage = Math.round((score.correct / score.total) * 100);
            const passed = percentage >= 80;
            
            if (passed && !gameState.unlockedLevels.includes(gameState.currentLevel + 1) && gameState.currentLevel < 5) {
                gameState.unlockedLevels.push(gameState.currentLevel + 1);
            }
            
            const completeHTML = `
                <h2 style="text-align: center;">Level ${gameState.currentLevel} Complete!</h2>
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 60px; font-weight: bold; color: ${passed ? '#4CAF50' : '#f44336'};">
                        ${percentage}%
                    </div>
                    <p style="font-size: 20px; color: #666; margin-top: 10px;">
                        ${score.correct} out of ${score.total} correct
                    </p>
                    <p style="font-size: 24px; font-weight: bold; margin-top: 20px; color: ${passed ? '#4CAF50' : '#f44336'};">
                        ${passed ? '‚úì PASSED' : '‚úó FAILED'}
                    </p>
                    <p style="color: #666; margin-top: 10px;">
                        ${passed ? 'You have unlocked the next level!' : 'You need 80% to advance. Try again!'}
                    </p>
                </div>
                
                ${gameState.weaknesses.length > 0 ? `
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3 style="margin-bottom: 10px;">Areas to Review:</h3>
                        <ul style="margin-left: 20px;">
                            ${[...new Set(gameState.weaknesses)].map(w => `<li>${w}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="goHome()" style="flex: 1;">üè† Home</button>
                    ${passed && gameState.currentLevel < 5 ? 
                        `<button class="btn btn-primary" onclick="startLevel(${gameState.currentLevel + 1})" style="flex: 1;">Next Level ‚Üí</button>` :
                        `<button class="btn btn-primary" onclick="startLevel(${gameState.currentLevel})" style="flex: 1;">Retry Level</button>`
                    }
                </div>
            `;
            
            document.getElementById('levelCompleteContent').innerHTML = completeHTML;
            showScreen('levelCompleteScreen');
            saveProgress();
        }

        function updateProgress() {
            document.getElementById('currentLevelDisplay').textContent = gameState.currentLevel;
            
            const score = gameState.levelScores[gameState.currentLevel] || { correct: 0, total: 0 };
            const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
            
            document.getElementById('score').textContent = `${score.correct}/${score.total}`;
            document.getElementById('accuracy').textContent = `${percentage}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}%`;
            
            const passStatus = document.getElementById('passStatus');
            if (percentage >= 80) {
                passStatus.style.color = '#4CAF50';
                passStatus.innerHTML = '<strong>Status</strong><br>PASSING';
            } else {
                passStatus.style.color = '#ff9800';
                passStatus.innerHTML = '<strong>Required</strong><br>80%';
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('abgTutorProgress');
                gameState = {
                    unlockedLevels: [1],
                    currentLevel: 1,
                    currentCase: 0,
                    currentQuestion: 0,
                    levelScores: {},
                    totalScore: { correct: 0, total: 0 },
                    weaknesses: [],
                    selectedChoice: null
                };
                saveProgress();
                alert('Progress reset! Refreshing page...');
                location.reload();
            }
        }
        
        // Debug functions
        function showDebugInfo() {
            const info = `
=== ABG Tutor State ===
Current Level: ${gameState.currentLevel}
Current Case: ${gameState.currentCase} (Display: Case ${gameState.currentCase + 1})
Current Question: ${gameState.currentQuestion}
Unlocked Levels: ${gameState.unlockedLevels.join(', ')}

Cases in Level ${gameState.currentLevel}: ${allCases[gameState.currentLevel].length}

Level Scores:
${Object.entries(gameState.levelScores).map(([level, score]) => 
    `  Level ${level}: ${score.correct}/${score.total} (${Math.round(score.correct/score.total*100)}%)`
).join('\n') || '  None yet'}

Total Score: ${gameState.totalScore.correct}/${gameState.totalScore.total}
            `.trim();
            
            console.log(info);
            alert(info);
        }
        
        function clearAndReload() {
            if (confirm('This will clear all saved progress and reload the page. Continue?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ABG Tutor initializing...');
            
            // Validate data structure
            if (!allCases || !allCases[1]) {
                console.error('ERROR: allCases not properly defined');
                alert('Application error: Data structure not loaded. Please refresh the page.');
                return;
            }
            
            console.log('Level 1 cases:', allCases[1].length);
            console.log('Level 2 cases:', allCases[2].length);
            console.log('All functions loaded successfully');
            
            // Initialize the app
            goHome();
        });
    </script>
</body>
</html>